import{g as t,f as i,h as o,r as e,c as n,H as s,a as r,F as a}from"./p-ec54acae.js";import{h as l,b as h,d as c,u as d,o as u,i as f,a as p,e as v,D as g,k as b,l as y,m,n as w,p as x,q as k,c as C,r as M,s as P,v as L,w as A,x as R,y as z,z as O,A as T,B as _,C as S,E as I,F as H,G as D,H as N,I as j,J as E,K as B,L as W,M as U,N as $,O as K,t as V,P as F,Q as Z,R as Y,j as X,g as q,f as G,S as J,T as Q,U as tt}from"./p-c88964d4.js";function it(t){if(!t||void 0===t||""===t)return;let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?`${parseInt(i[1],16)}, ${parseInt(i[2],16)}, ${parseInt(i[3],16)}`:void 0}function ot(t){return t.changedTouches?t.changedTouches[0]:t}function et(t,i){let o;return(...e)=>{o&&clearTimeout(o),o=setTimeout((()=>t(...e)),i&&i>0?i:300)}}function nt(){if(!window)return!1;let t=window.matchMedia("(any-pointer:coarse)").matches,i=window.matchMedia("(any-pointer:fine)").matches;return t&&!i}function st(){if(!window||!navigator)return!1;let t=lt();return/iPhone|iPod/i.test(t)||function(){if(!window||!navigator)return!1;let t=lt();return!!/iPad/i.test(t)||/Macintosh/i.test(t)&&nt()}()}function rt(){if(!window||!navigator)return!1;let t=lt();return/firefox/i.test(t)}function at(){let t=document.documentElement.getAttribute("dir");return null!==t&&"rtl"===t}var lt=()=>navigator.userAgent||navigator.vendor||window.opera;const ht=t=>!("isConnected"in t)||t.isConnected,ct=(()=>{let t;return(...i)=>{t&&clearTimeout(t),t=setTimeout((()=>{t=0,(t=>{for(let i of t.keys())t.set(i,t.get(i).filter(ht))})(...i)}),2e3)}})(),dt=t=>"function"==typeof t?t():t,ut=(o,e)=>{const n=((t,i=((t,i)=>t!==i))=>{const o=dt(t);let e=new Map(Object.entries(null!=o?o:{}));const n={dispose:[],get:[],set:[],reset:[]},s=()=>{var i;e=new Map(Object.entries(null!==(i=dt(t))&&void 0!==i?i:{})),n.reset.forEach((t=>t()))},r=t=>(n.get.forEach((i=>i(t))),e.get(t)),a=(t,o)=>{const s=e.get(t);i(o,s,t)&&(e.set(t,o),n.set.forEach((i=>i(t,o,s))))},l="undefined"==typeof Proxy?{}:new Proxy(o,{get:(t,i)=>r(i),ownKeys:()=>Array.from(e.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(t,i)=>e.has(i),set:(t,i,o)=>(a(i,o),!0)}),h=(t,i)=>(n[t].push(i),()=>{((t,i)=>{const o=t.indexOf(i);o>=0&&(t[o]=t[t.length-1],t.length--)})(n[t],i)});return{state:l,get:r,set:a,on:h,onChange:(i,o)=>{const e=h("set",((t,e)=>{t===i&&o(e)})),n=h("reset",(()=>o(dt(t)[i])));return()=>{e(),n()}},use:(...t)=>{const i=t.reduce(((t,i)=>(i.set&&t.push(h("set",i.set)),i.get&&t.push(h("get",i.get)),i.reset&&t.push(h("reset",i.reset)),i.dispose&&t.push(h("dispose",i.dispose)),t)),[]);return()=>i.forEach((t=>t()))},dispose:()=>{n.dispose.forEach((t=>t())),s()},reset:s,forceUpdate:t=>{const i=e.get(t);n.set.forEach((o=>o(t,i,i)))}}})(o,e);return n.use((()=>{if("function"!=typeof t)return{};const o=new Map;return{dispose:()=>o.clear(),get:i=>{const e=t();e&&((t,i,o)=>{const e=t.get(i);e?e.includes(o)||e.push(o):t.set(i,[o])})(o,i,e)},set:t=>{const e=o.get(t);e&&o.set(t,e.filter(i)),ct(o)},reset:()=>{o.forEach((t=>t.forEach(i))),ct(o)}}})()),n},ft=[l,h,c,d,u,f,p,v],pt={palette:g,command:"native",style:{list:!1,align:!0,fontSize:!0,backgroundColor:!0}},vt=["div","p","span"],gt=["h1","h2","h3","div","p"],bt=["placeholder","class","spellcheck","contenteditable","data-gramm","data-gramm_id","data-gramm_editor","data-gr-id","autocomplete"],yt={paragraphIdentifier:"paragraph_id",exclude:[...bt,"paragraph_id"]},{state:mt,onChange:wt}=ut({plugins:ft,toolbar:pt,placeholders:vt,textParagraphs:gt,menus:void 0,attributes:yt}),xt={state:mt,onChange:wt},{state:kt,onChange:Ct}=ut({ref:void 0,size:void 0}),Mt={state:kt,onChange:Ct},Pt={lang:"en",plugins:{huge_title:"Huge title",large_title:"Large title",small_title:"Small title",paragraph:"Paragraph",separator:"Separator",unordered_list:"Bulleted list",ordered_list:"Numbered list",image:"Image",code:"Code",no_matches:"No matches"},add:{placeholder:'Press "/" for plugins',add_element:"Add a new part"},toolbar:{align_left:"Align left",align_center:"Align center",align_right:"Align right",font_size:"Font size",list_ol:"Ordered list",list_ul:"Unordered list",style_list:"Style list",style_align:"Style alignment",style_font_size:"Style font size",style_color:"Style color",style_background:"Style background",link:"Create or remove link",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough"},menus:{img_width_original:"Original image width",img_width_large:"Large image width",img_width_medium:"Medium image width",img_width_small:"Small image width",img_delete:"Delete image"}},{state:Lt,onChange:At}=ut(Pt);At("lang",(async t=>{let i;switch(t){case"es":i=await(async()=>{const{es:t}=await import("./p-5459b041.js");return t})();break;case"de":i=await(async()=>{const{de:t}=await import("./p-894cd2c1.js");return t})();break;case"nl":i=await(async()=>{const{nl:t}=await import("./p-b371caa3.js");return t})();break;case"ja":i=await(async()=>{const{ja:t}=await import("./p-289bfdf4.js");return t})();break;default:i=Pt}Object.assign(Lt,Object.assign({custom:Lt.custom},i))}));const Rt={state:Lt},zt=({code:t,keyCode:i})=>["Enter"].includes(t)&&229!==i,Ot=()=>nt()||(()=>{if(!window)return!1;let t=lt();return/android|sink/i.test(t)})()||st(),Tt=t=>_t(t)&&St(t)?It(t):b(),_t=t=>(null==t?void 0:t.getRootNode())instanceof ShadowRoot,St=t=>(null==t?void 0:t.getRootNode()).getSelection,It=t=>t.getRootNode().getSelection(),Ht=t=>{const i=Tt(t);return!i||i.rangeCount<=0?{range:null,selection:null}:{selection:i,range:i.getRangeAt(0)}},Dt=t=>{const{startOffset:i,endOffset:o}=t;i!==o&&t.extractContents()},Nt=()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288M400 256H112"})),jt=class{constructor(t){e(this,t),this.selectParagraph=n(this,"selectParagraph",7),this.listPlugins=n(this,"listPlugins",7),this.hidePlugins=n(this,"hidePlugins",7),this.debouncePlaceholder=et((()=>this.addPlaceholder()),350),this.onKeyDown=t=>{const{code:i}=t;["ArrowDown","ArrowUp"].includes(i)||zt(t)||this.removePlaceholder(),["Backspace","Delete"].includes(i)&&this.displayOnMutations()},this.onFocusout=()=>{st()&&(this.top=void 0)},this.initParagraph=({target:t,onlyIfEmptyParagraph:i})=>{if(!t)return void this.hide();const o=y({element:t,container:Mt.state.ref});this.paragraph=m(o),!this.paragraph||i&&!w({paragraph:this.paragraph})?this.hide():(this.top=this.paragraph.offsetTop,this.editPlaceholder(),this.selectParagraph.emit(this.paragraph))},this.top=void 0}componentDidLoad(){null===window||void 0===window||window.addEventListener("resize",(()=>this.hide())),null===document||void 0===document||document.addEventListener("focusout",this.onFocusout),this.destroyListener=Mt.onChange("ref",(()=>{this.removeContainerListener(),this.addContainerListener()})),this.addContainerListener()}disconnectedCallback(){var t;null===window||void 0===window||window.removeEventListener("resize",(()=>this.hide())),null===document||void 0===document||document.removeEventListener("focusout",this.onFocusout),this.removeContainerListener(),null===(t=this.destroyListener)||void 0===t||t.call(this)}addContainerListener(){var t;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("keydown",this.onKeyDown,{passive:!0})}removeContainerListener(){var t;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("keydown",this.onKeyDown)}onKeyUp(t){const{code:i}=t;["ArrowDown","ArrowUp","Backspace","Delete"].includes(i)||zt(t)?["ArrowDown","ArrowUp"].includes(i)&&this.display({onlyIfEmptyParagraph:!1}):void 0!==this.top&&this.hide()}onBeforeInput({data:t}){["/"].includes(t)?this.paragraph&&this.paragraph.isConnected&&(w({paragraph:this.paragraph})?this.focusListPlugins():this.hidePlugins.emit()):this.hidePlugins.emit()}onClick({target:t}){var i;this.display({onlyIfEmptyParagraph:!1,target:(null===(i=Mt.state.ref)||void 0===i?void 0:i.isEqualNode(t))?void 0:t})}onAddParagraphs({detail:t}){this.initParagraph({target:t[0],onlyIfEmptyParagraph:!1})}hide(){this.selectParagraph.emit(void 0),Ot()||(this.top=void 0)}display({onlyIfEmptyParagraph:t,target:i}){var o;this.initParagraph({target:null!=i?i:null===(o=Tt(Mt.state.ref))||void 0===o?void 0:o.anchorNode,onlyIfEmptyParagraph:t})}displayOnMutations(){new MutationObserver(((t,i)=>{i.disconnect(),this.display({onlyIfEmptyParagraph:!0})})).observe(Mt.state.ref,{childList:!0,subtree:!0,characterData:!0})}editPlaceholder(){this.removePlaceholder(),this.debouncePlaceholder()}addPlaceholder(){var t;if(!w({paragraph:this.paragraph}))return;if(x({paragraph:this.paragraph}))return;if(!xt.state.placeholders.includes(null===(t=this.paragraph)||void 0===t?void 0:t.nodeName.toLowerCase()))return;const i=window.getComputedStyle(this.paragraph,":before"),o=window.getComputedStyle(this.paragraph,":after"),e=['""',"none"];e.includes(i.getPropertyValue("content"))&&e.includes(o.getPropertyValue("content"))&&this.paragraph.setAttribute("placeholder",Rt.state.add.placeholder)}removePlaceholder(){var t;const i=null===(t=Mt.state.ref)||void 0===t?void 0:t.querySelectorAll("[placeholder]");null==i||i.forEach((t=>t.removeAttribute("placeholder")))}selectPlugins(t){if(!this.paragraph||!Mt.state.ref)return;if(t.stopPropagation(),w({paragraph:this.paragraph})&&!x({paragraph:this.paragraph}))return void this.focusListPlugins();k({paragraph:this.paragraph}),new MutationObserver(((t,i)=>{i.disconnect();const o=t.reduce(((t,{addedNodes:i})=>[...t,...Array.from(i)]),[]).find((t=>"div"===t.nodeName.toLowerCase()));M(o),this.listPlugins.emit(o)})).observe(Mt.state.ref,{childList:!0,subtree:!0});const i=C({nodeName:"div"});this.paragraph.after(i),this.hide()}focusListPlugins(){k({paragraph:this.paragraph}),this.listPlugins.emit(this.paragraph)}render(){return o(s,{style:void 0===this.top?{display:"none"}:{"--actions-top":`${this.top}px`}},o("button",{type:"button","aria-label":Rt.state.add.add_element,onClick:t=>this.selectPlugins(t),onKeyDown:t=>t.stopPropagation(),onMouseDown:t=>t.stopPropagation(),onTouchStart:t=>t.stopPropagation()},o(Nt,null)))}};jt.style=":host{display:block;position:absolute;top:var(--actions-top);left:var(--stylo-add-left, 8px);transition:top 0.1s ease;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}button{display:flex;position:relative;isolation:isolate;overflow:hidden;background:transparent;border:none;outline:none;cursor:pointer;transition:color 0.25s ease-out, background 0.25s ease-out, transform 0.15s ease-out;flex-direction:column;justify-content:center;align-items:center;border-radius:50%;width:1.4rem;height:1.4rem;color:var(--stylo-add-color, var(--medium))}button:active{box-shadow:none;transform:translateX(1px) translateY(1px)}button:hover,button:focus{color:var(--light-contrast)}svg{width:1.2rem;height:1.2rem}";const Et=class{constructor(t){e(this,t),this.colorChange=n(this,"colorChange",7),this.debounceInitSelectedColorPalette=et((()=>{this.selectedColorPalette=this.initSelectedColorPalette(),this.selectedCustomColorRgb=this.selectedColorPalette?void 0:this.selectedColorRgb}),150),this.selectColor=t=>{const i=t.detail;this.applyColorHexChange(i.hex,i.rgb),this.colorChange.emit(i)},this.palette=g,this.inputAlt="Input a color (hex)",this.colorHex=void 0,this.colorRgb=void 0,this.selectedColorHex=void 0,this.selectedColorRgb=void 0,this.selectedColorPalette=!1,this.selectedCustomColorRgb=void 0}componentWillLoad(){this.selectedColorHex=this.colorHex,this.selectedColorRgb=this.colorRgb?this.colorRgb:it(this.colorHex),this.selectedColorPalette=this.initSelectedColorPalette(),this.selectedColorPalette||(this.selectedCustomColorRgb=this.selectedColorRgb)}async onColorHexChange(){this.applyColorHexChange(this.colorHex,void 0)}applyColorHexChange(t,i){this.selectedColorHex=t,this.selectedColorRgb=i,this.debounceInitSelectedColorPalette(),this.palette=[...this.palette]}async onColorRgbChange(){this.selectedColorHex=void 0,this.selectedColorRgb=this.colorRgb,this.debounceInitSelectedColorPalette(),this.palette=[...this.palette]}pickColor(t){!this.palette||this.palette.length<=0||(this.selectedColorHex=t.color?t.color.hex:void 0,this.selectedColorRgb=t.color?t.color.rgb:void 0,this.colorChange.emit(t.color),this.selectedColorPalette=!0,this.selectedCustomColorRgb=void 0)}isHexColorSelected(t){return!!(t&&t.color&&t.color.hex)&&!!this.selectedColorHex&&this.selectedColorHex.toUpperCase()===t.color.hex.toUpperCase()}isRgbColorSelected(t){return!!(t&&t.color&&t.color.rgb)&&!!this.selectedColorRgb&&this.selectedColorRgb.replace(/\s/g,"").toUpperCase()===t.color.rgb.replace(/\s/g,"").toUpperCase()}initSelectedColorPalette(){return!(!this.palette||this.palette.length<=0)&&this.palette.findIndex((t=>this.isHexColorSelected(t)||this.isRgbColorSelected(t)))>-1}render(){return o(s,null,this.renderPalette(),this.renderInput())}renderPalette(){return this.palette&&this.palette.length>0?this.palette.map((t=>{const i={"--stylo-palette-color-hex":`${t.color.hex}`,"--stylo-palette-color-rgb":`${t.color.rgb}`};return t.display&&(i["--stylo-palette-border-color"]=t.display.borderColor,i["--stylo-palette-box-shadow-color"]=t.display.boxShadowColor),o("button",{"aria-label":t.alt,class:this.isHexColorSelected(t)||this.isRgbColorSelected(t)?"selected":void 0,style:i,onClick:i=>{i.stopPropagation(),this.pickColor(t)}})})):void 0}renderInput(){return o("stylo-color-input",{colorHex:this.selectedColorHex,colorRgb:this.selectedColorRgb,customColorRgb:this.selectedCustomColorRgb,inputAlt:this.inputAlt,onSelectHexColor:this.selectColor})}get el(){return r(this)}static get watchers(){return{colorHex:["onColorHexChange"],colorRgb:["onColorRgbChange"]}}};Et.style=":host{display:flex;align-items:center;justify-content:center;flex-wrap:var(--stylo-color-flex-wrap, wrap);overflow:var(--stylo-color-overflow, visible);padding:var(--stylo-color-padding, 8px);width:var(--stylo-color-width, 298px)}button{width:var(--stylo-color-button-width, 28px);height:var(--stylo-color-button-height, 28px);margin:var(--stylo-color-button-margin, 4px);padding:0;outline:var(--stylo-color-button-outline, none);cursor:pointer;border:1px solid var(--stylo-palette-border-color, var(--stylo-palette-color-hex));border-radius:var(--stylo-color-button-border-radius, 2px);background:var(--stylo-palette-color-hex)}button.selected{box-shadow:0 0 4px 4px rgba(var(--stylo-palette-box-shadow-color, var(--stylo-palette-color-rgb)), 0.4)}button:not(.selected):hover,button:not(.selected):focus{box-shadow:0 0 2px 2px rgba(var(--stylo-palette-box-shadow-color, var(--stylo-palette-color-rgb)), 0.4)}";const Bt=class{constructor(t){e(this,t),this.selectHexColor=n(this,"selectHexColor",7),this.debounceSelectColor=et((t=>this.emitColor(t)),500),this.colorHex=void 0,this.colorRgb=void 0,this.customColorRgb=void 0,this.inputAlt=void 0,this.color=void 0}async componentWillLoad(){this.color=this.initColorHex()}async watchColors(){this.color=this.initColorHex()}initColorHex(){return this.colorHex?this.colorHex:(t=this.customColorRgb?this.customColorRgb:this.colorRgb)?(t=>{if(t)return`#${t.map((t=>t.toString(16).padStart(2,"0"))).join("")}`})(function(t){let i=t.match(/([.\d]+),\s*([.\d]+),\s*([.\d]+)/);if(i)return i.splice(1,3).map((t=>Number(t)))}(t)):void 0;var t}emitColor(t){const i=`#${t.replace("#","")}`,o=it(i);o&&this.selectHexColor.emit({hex:i,rgb:o})}render(){var t;return o(s,null,o("span",null,"#"),o("input",{type:"text",name:"color-picker","aria-label":this.inputAlt,onInput:t=>this.debounceSelectColor(t.target.value),value:null===(t=this.color)||void 0===t?void 0:t.replace("#","")}))}static get watchers(){return{colorHex:["watchColors"],colorRgb:["watchColors"],customColorRgb:["watchColors"]}}};Bt.style=":host{display:flex;position:relative;margin:var(--stylo-color-input-margin, 4px);border-radius:var(--stylo-color-input-container-border-radius);border:var(--stylo-color-input-container-border)}span{width:var(--stylo-color-hash-width, 28px);height:var(--stylo-color-hash-height, 28px);display:inline-flex;justify-content:center;align-items:center;background:var(--stylo-color-hash-background, #f0f0f0 none repeat scroll 0 0);color:var(--stylo-color-hash-color, #98a1a4);border-radius:var(--stylo-color-hash-border-radius, 4px 0 0 4px)}input{color:var(--stylo-color-input-color, #666666);background:var(--stylo-color-input-background, inherit);border:none;outline:none;height:var(--stylo-color-input-height, 28px);box-shadow:var(--stylo-color-input-box-shadow, #f0f0f0 0 0 0 1px inset);border-radius:var(--stylo-color-input-border-radius, 0 4px 4px 0);padding:var(--stylo-color-input-padding, 0 4px);max-width:var(--stylo-color-input-max-width, 136px);font-family:var(--stylo-color-input-font-family, inherit)}";const Wt=({editorRef:t,message:i,detail:o})=>{const e=new CustomEvent(i,{detail:o,bubbles:!0});null==t||t.dispatchEvent(e)},Ut=({mutations:t,container:i})=>{if(!t||t.length<=0)return[];const o=t.filter((({addedNodes:t})=>(null==t?void 0:t.length)>0)).reduce(((t,{addedNodes:i})=>[...t,...Array.from(i)]),[]);return Zt({nodes:o,container:i})},$t=({mutations:t,container:i})=>t.filter((({addedNodes:t})=>(null==t?void 0:t.length)>0)).filter((({addedNodes:t})=>!P({element:t[0],container:i}))).filter((({addedNodes:t})=>!w({paragraph:y({element:t[0],container:i})}))),Kt=({mutations:t,paragraphIdentifier:i})=>t.filter((({removedNodes:t})=>(null==t?void 0:t.length)>0)).filter((({removedNodes:t})=>!(({removedNodes:t,paragraphIdentifier:i})=>void 0!==Array.from(t).find((t=>{var o;return!L(t)&&(null===(o=m(t))||void 0===o?void 0:o.hasAttribute(i))})))({removedNodes:t,paragraphIdentifier:i}))),Vt=({previousSibling:t,container:i})=>{if(t&&!i.isEqualNode(t))return L(t)?Vt({previousSibling:t.previousSibling,container:i}):t},Ft=({mutations:t,container:i})=>{if(!t||t.length<=0)return[];const o=t.reduce(((t,{target:i})=>[...t,i]),[]);return[...new Set(o.map((t=>y({element:t,container:i}))).filter((t=>void 0!==t&&(null==t?void 0:t.nodeType)!==Node.TEXT_NODE&&(null==t?void 0:t.nodeType)!==Node.COMMENT_NODE)))]},Zt=({nodes:t,container:i})=>t.filter((t=>P({element:t,container:i}))).filter((t=>(null==t?void 0:t.nodeType)!==Node.TEXT_NODE&&(null==t?void 0:t.nodeType)!==Node.COMMENT_NODE)),Yt=({nodes:t,paragraphIdentifier:i})=>t.filter((t=>!L(t))).map((t=>t)).filter((t=>null==t?void 0:t.hasAttribute(i))),Xt=({mutations:t,excludeAttributes:i})=>{const o=t.filter((({attributeName:t})=>null!==t));return void 0!==o.find((({attributeName:t})=>i.includes(t)))?[]:o};class qt{constructor(){this.stackDataMutations=[],this.debounceUpdateInput=et((()=>this.updateData()),500),this.onTreeMutation=async t=>{const i=await this.addParagraphs(t);this.deleteParagraphs(t),this.updateAddedNodesParagraphs({addedParagraphs:i,mutations:t})},this.onAttributesMutation=t=>{this.updateParagraphs({mutations:Xt({mutations:t,excludeAttributes:xt.state.attributes.exclude})})},this.onDataMutation=t=>{this.stackDataMutations.push(...t),this.debounceUpdateInput()}}init({editorRef:t}){this.editorRef=t,this.treeObserver=new MutationObserver(this.onTreeMutation),this.treeObserver.observe(Mt.state.ref,{childList:!0,subtree:!0}),this.attributesObserver=new MutationObserver(this.onAttributesMutation),this.attributesObserver.observe(Mt.state.ref,{attributes:!0,subtree:!0}),this.dataObserver=new MutationObserver(this.onDataMutation),this.dataObserver.observe(Mt.state.ref,{characterData:!0,subtree:!0})}destroy(){var t,i,o;null===(t=this.treeObserver)||void 0===t||t.disconnect(),null===(i=this.attributesObserver)||void 0===i||i.disconnect(),null===(o=this.dataObserver)||void 0===o||o.disconnect()}async addParagraphs(t){if(!Mt.state.ref)return[];const i=Ut({mutations:t,container:Mt.state.ref});return i.length<=0?[]:(await Promise.all(i.map((t=>A({paragraph:t,attributeName:xt.state.attributes.paragraphIdentifier})))),(({editorRef:t,addedParagraphs:i})=>{Wt({editorRef:t,detail:i,message:"addParagraphs"})})({editorRef:this.editorRef,addedParagraphs:i}),i)}deleteParagraphs(t){if(!Mt.state.ref)return;if(!t||t.length<=0)return;const i=t.reduce(((t,{addedNodes:i})=>[...t,...Array.from(i)]),[]),o=t.reduce(((t,{removedNodes:i})=>[...t,...Array.from(i)]),[]).filter((t=>!L(t))).filter((t=>void 0===i.find((i=>i.isEqualNode(t))))).map((t=>m(t))).filter((t=>null==t?void 0:t.hasAttribute(xt.state.attributes.paragraphIdentifier)));o.length<=0||(({editorRef:t,removedParagraphs:i})=>{Wt({editorRef:t,detail:i,message:"deleteParagraphs"})})({editorRef:this.editorRef,removedParagraphs:o})}updateAddedNodesParagraphs({mutations:t,addedParagraphs:i}){if(!Mt.state.ref)return;if(!t||t.length<=0)return;const o=$t({mutations:t,container:Mt.state.ref}),e=Kt({mutations:t,paragraphIdentifier:xt.state.attributes.paragraphIdentifier});this.updateParagraphs({mutations:[...o,...e],addedParagraphs:i})}updateData(){if(!this.stackDataMutations||this.stackDataMutations.length<=0)return;const t=[...this.stackDataMutations];this.stackDataMutations=[],this.updateParagraphs({mutations:t})}updateParagraphs({mutations:t,addedParagraphs:i=[]}){if(!Mt.state.ref)return;const o=Ft({mutations:t,container:Mt.state.ref});if(o.length<=0)return;const e=o.filter((t=>!(t=>void 0!==i.find((i=>i.isSameNode(t))))(t)));e.length<=0||(({editorRef:t,updatedParagraphs:i})=>{Wt({editorRef:t,detail:i,message:"updateParagraphs"})})({editorRef:this.editorRef,updatedParagraphs:e})}}const{state:Gt,onChange:Jt,reset:Qt}=ut({undo:void 0,redo:void 0,observe:!0}),ti={state:Gt,onChange:Jt,reset:Qt},ii=t=>{const{range:i,selection:o}=Ht();if(!i)return;const{anchorNode:e,focusNode:n}=o,s=m(y({element:e,container:t})),r=m(y({element:n,container:t}));return s&&r?{startIndex:R(s),startIndexDepths:z({target:e,paragraph:y({element:e,container:t})}),startOffset:o.anchorOffset,endIndex:R(r),endIndexDepths:z({target:n,paragraph:y({element:n,container:t})}),endOffset:o.focusOffset,reverse:!e.isEqualNode(i.startContainer)}:void 0},oi=({container:t,addRemoveParagraphs:i,updateParagraphs:o,selection:e})=>{if(i.length<=0&&o.length<=0)return;ti.state.undo||(ti.state.undo=[]);const n={changes:[{type:"paragraph",target:t,data:i.map((({outerHTML:t,index:i,mutation:o})=>({outerHTML:t,mutation:o,index:i})))},{type:"update",target:t,data:o}],selection:e};ti.state.undo.push(n),ti.state.redo=[]},ei=()=>si(ti.state.undo),ni=()=>si(ti.state.redo),si=t=>{if(t)return t[t.length-1]},ri=async()=>li({popFrom:()=>ti.state.undo=[...ti.state.undo.slice(0,ti.state.undo.length-1)],pushTo:t=>ti.state.redo.push(t),undoChanges:ei()}),ai=async()=>li({popFrom:()=>ti.state.redo=[...ti.state.redo.slice(0,ti.state.redo.length-1)],pushTo:t=>ti.state.undo.push(t),undoChanges:ni()}),li=async({popFrom:t,pushTo:i,undoChanges:o})=>{if(!o)return;const e=ii(Mt.state.ref),{changes:n,selection:s}=o;let r=[];for(const t of n)r=[await hi({undoChange:t}),...r];(({selection:t,container:i})=>{if(!t)return;const{startIndex:o,startIndexDepths:e,startOffset:n,endIndex:s,endIndexDepths:r,endOffset:a,reverse:l}=t,h=i.children[Math.min(o,i.children.length-1)],c=i.children[Math.min(s,i.children.length-1)],d=O({parent:h,indexDepths:e}),u=O({parent:c,indexDepths:r});if(!d||!u)return;if(d.textContent.length<n||u.textContent.length<a)return;const f=document.createRange();l?(f.setEnd(d,n),f.setStart(u,a)):(f.setStart(d,n),f.setEnd(u,a));const p=Tt(i);null==p||p.removeAllRanges(),null==p||p.addRange(f),f.detach()})({container:Mt.state.ref,selection:s}),i({changes:r,selection:e}),t()},hi=async({undoChange:t})=>{const{type:i}=t;return"input"===i?ci({undoChange:t}):"paragraph"===i?di({undoChange:t}):ui({undoChange:t})},ci=async({undoChange:t})=>{var i;const{data:o,target:e}=t,n=m(e),{oldValue:s,offset:r,index:a,indexDepths:l}=o,h=n.children[a];let c=O({parent:h,indexDepths:l});if(!c||!L(c)){const t=[...l];t.pop();let o=t.length<=0?c?c.parentNode:void 0:O({parent:h,indexDepths:[...t]});!o&&L(null===(i=m(h))||void 0===i?void 0:i.lastChild)&&(c=m(h).lastChild),c||(o||(o=await yi({paragraph:m(h)||n,container:n})),c=await gi({parent:m(o),container:n}))}const{previousValue:d}=await bi({text:c,oldValue:s,container:n});return T({element:c,offset:Math.max(Math.min(s.length>r?r:s.length,c.nodeValue.length),0)}),{type:"input",target:n,data:{index:a,indexDepths:z({target:null!=c?c:e,paragraph:h}),oldValue:d,offset:r+(d.length-s.length)}}},di=async({undoChange:t})=>{const{data:i,target:o}=t,e=m(o),n=i;let s=[];for(const t of n){const{index:i,outerHTML:o,mutation:n}=t;"add"===n&&(await pi({container:e,index:i}),s=[{outerHTML:o,index:i,mutation:"remove"},...s]),"remove"===n&&(await fi({container:e,index:i,outerHTML:o}),s=[{outerHTML:o,mutation:"add",index:i},...s])}return Object.assign(Object.assign({},t),{data:s})},ui=async({undoChange:t})=>{const{data:i,target:o}=t,e=i,n=m(o),s=[];for(const t of e){const{index:i,outerHTML:o}=t,{previousOuterHTML:e}=await vi({container:n,index:i,outerHTML:o});s.push({index:i,outerHTML:e})}return Object.assign(Object.assign({},t),{data:s})},fi=({container:t,index:i,outerHTML:o})=>new Promise((e=>{const n=new MutationObserver((()=>{n.disconnect(),e()}));n.observe(t,{childList:!0,subtree:!0});const s=i-1;-1!==s?t.children[Math.min(s,t.children.length-1)].insertAdjacentHTML("afterend",o):t.insertAdjacentHTML("afterbegin",o)})),pi=({container:t,index:i})=>new Promise((o=>{const e=new MutationObserver((()=>{e.disconnect(),o()}));e.observe(t,{childList:!0,subtree:!0});const n=t.children[Math.min(i,t.children.length-1)];null==n||n.parentElement.removeChild(n)})),vi=({container:t,index:i,outerHTML:o})=>new Promise((e=>{const n=t.children[Math.min(i,t.children.length-1)],s=n.outerHTML,r=new MutationObserver((()=>{r.disconnect(),e({previousOuterHTML:s})}));r.observe(t,{childList:!0,subtree:!0}),n.outerHTML=o})),gi=({parent:t,container:i})=>new Promise((o=>{const e=document.createTextNode(""),n=new MutationObserver((()=>{n.disconnect(),o(e)}));n.observe(i,{childList:!0,subtree:!0}),t.prepend(e)})),bi=({container:t,oldValue:i,text:o})=>new Promise((e=>{const n=o.nodeValue,s=new MutationObserver((()=>{s.disconnect(),e({previousValue:n})}));s.observe(t,{characterData:!0,subtree:!0}),o.nodeValue=i})),yi=({container:t,paragraph:i})=>new Promise((o=>{var e;const n="br"!==(null===(e=i.lastElementChild)||void 0===e?void 0:e.nodeName.toLowerCase())?m(i.lastElementChild):document.createElement("span"),s=m(n.cloneNode());s.innerHTML="";const r=new MutationObserver((()=>{r.disconnect(),o(s)}));r.observe(t,{childList:!0,subtree:!0}),n.after(s)}));class mi{constructor(){this.onKeyDown=async t=>{zt(t)&&await this.createParagraph(t)}}init(){var t;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("keydown",this.onKeyDown)}destroy(){var t;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("keydown",this.onKeyDown)}async createParagraph(t){const{range:i,selection:o}=Ht(Mt.state.ref);if(!i)return;const e=m(null==o?void 0:o.anchorNode);if(!e)return;const n=m(y({element:e,container:Mt.state.ref}));if(!n)return;if(_({node:n}))return;t.preventDefault();const s=this.toUpdateParagraphs([n]);Dt(i),i.collapse(!0),i.setEndAfter(n);const r=""===i.cloneContents().textContent,{shiftKey:a}=t;if(a||S({paragraph:n}))await this.createLineBreak({anchor:e,paragraph:n,isEndOfParagraph:r,range:i,undoParagraphs:s});else if(r){const t=await I({container:Mt.state.ref,paragraph:n});H(t)}else await this.createParagraphWithContent({range:i,paragraph:n,undoParagraphs:s})}async createParagraphWithContent({paragraph:t,range:i,undoParagraphs:o}){ti.state.observe=!1;const e=i.extractContents(),n=await D({container:Mt.state.ref,paragraph:t,fragment:e}),s=this.toAddParagraphs([m(n)]);""===t.textContent&&await N({paragraph:t}),oi({container:Mt.state.ref,addRemoveParagraphs:s,updateParagraphs:o}),ti.state.observe=!0,M(n)}toAddParagraphs(t){return t.map((t=>({outerHTML:t.outerHTML,index:R(t),mutation:"add"})))}toUpdateParagraphs(t){return t.map((t=>({outerHTML:t.outerHTML,index:R(t)})))}async createLineBreak({anchor:t,paragraph:i,isEndOfParagraph:o,range:e,undoParagraphs:n}){ti.state.observe=!1,oi({container:Mt.state.ref,addRemoveParagraphs:[],updateParagraphs:n}),e.setEndAfter(Tt(Mt.state.ref).anchorNode);const s=await j({paragraph:t,range:e});if(!o||!s)return M(s),void(ti.state.observe=!0);const r=await E({paragraph:i,element:s});M(r),ti.state.observe=!0}}const wi=[{match:({key:t,lastKey:i,lastBeforeInput:o})=>st()?["‘","’","´"].includes(null==o?void 0:o.key)&&" "===t.key:"`"===t.key&&[" ","Dead"].includes(null==i?void 0:i.key),transform:()=>document.createElement("mark"),active:({nodeName:t})=>"mark"===t.toLowerCase(),shouldTrimText:({nodeValue:t})=>"`"===t.charAt(t.length-1)||"`"===t.charAt(0),shouldTrimSplit:({target:t,startOffset:i})=>void 0!==i&&"`"===t.nodeValue.charAt(i-1),trim:()=>"`".length,postTransform:()=>xi()},{match:({lastKey:t,key:i})=>"*"===(null==t?void 0:t.key)&&"*"===i.key,transform:()=>{const t=document.createElement("span");return t.style.fontWeight="bold",t},active:t=>{const{fontWeight:i}=window.getComputedStyle(t);return parseInt(i)>400||"bold"===i},shouldTrimText:({nodeValue:t})=>"*"===t.charAt(t.length-1)||"*"===t.charAt(0),shouldTrimSplit:({target:t,startOffset:i})=>void 0!==i&&"*"===t.nodeValue.charAt(i-1),trim:()=>"*".length},{match:({lastBeforeInput:t,key:i})=>" "===(null==t?void 0:t.key)&&"_"===i.key,transform:()=>{const t=document.createElement("span");return t.style.fontStyle="italic",t},active:t=>{const{fontStyle:i}=window.getComputedStyle(t);return"italic"===i},shouldTrimText:()=>!1,shouldTrimSplit:()=>!1,trim:()=>"".length}],xi=()=>/apple/i.test(navigator.vendor)?Promise.resolve():ki(),ki=()=>new Promise((t=>{const i=new MutationObserver((async o=>{i.disconnect();const e=o[0].target;if(!e.nodeValue.includes("`"))return void t();ti.state.observe=!1,await Ci({target:e,searchValue:"`",replaceValue:""}),ti.state.observe=!0;const n=m(e),s="mark"===(null==n?void 0:n.nodeName.toLowerCase());if(rt())return H(s?n.nextSibling:e.nextSibling),void t();H(s?e:e.nextSibling),t()}));i.observe(Mt.state.ref,{characterData:!0,subtree:!0})})),Ci=({target:t,searchValue:i,replaceValue:o})=>new Promise((e=>{const n=new MutationObserver((t=>{n.disconnect(),e(t[0].target)}));n.observe(Mt.state.ref,{characterData:!0,subtree:!0}),t.nodeValue=t.nodeValue.replace(i,o)})),Mi=({target:t,index:i,transformInput:o})=>new Promise((e=>{var n,s;const r=new MutationObserver((async()=>{if(r.disconnect(),!o.shouldTrimText(l))return void e(l);const t=await Pi({target:l,index:1});e(t)}));r.observe(Mt.state.ref,{childList:!0,subtree:!0});const a=null===(s=null===(n=Tt(Mt.state.ref))||void 0===n?void 0:n.getRangeAt(0))||void 0===s?void 0:s.startOffset,l=t.splitText(i-(o.shouldTrimSplit({target:t,startOffset:a})?o.trim():0))})),Pi=({target:t,index:i})=>new Promise((o=>{const e=new MutationObserver((t=>{e.disconnect(),o(t[0].target)}));e.observe(Mt.state.ref,{characterData:!0,subtree:!0}),t.nodeValue=t.nodeValue.slice(i)}));class Li{constructor(){this.lastBeforeInput=void 0,this.lastKey=void 0,this.onBeforeInput=async t=>{await this.preventTextLeaves(t);const{data:i}=t;this.lastBeforeInput={key:i}},this.onKeyDown=async t=>{await this.transformInput(t),this.deleteSelection(t)}}init(){var t,i;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("beforeinput",this.onBeforeInput),null===(i=Mt.state.ref)||void 0===i||i.addEventListener("keydown",this.onKeyDown)}destroy(){var t,i;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("beforeinput",this.onBeforeInput),null===(i=Mt.state.ref)||void 0===i||i.removeEventListener("keydown",this.onKeyDown)}async preventTextLeaves(t){var i;const{range:o,selection:e}=Ht(Mt.state.ref);if(!o)return;if(!Mt.state.ref.isEqualNode(null==e?void 0:e.anchorNode))return;const{data:n}=t;if(null===n)return;const{startOffset:s}=o,r=O({parent:Mt.state.ref,indexDepths:[s]});if(null===(i=xt.state.textParagraphs)||void 0===i?void 0:i.includes(null==r?void 0:r.nodeName.toLowerCase()))return void o.setStart(r,0);t.preventDefault();const a=await W({container:Mt.state.ref,range:o,text:n});H(a)}async transformInput(t){var i;const{key:o}=t,e=Tt(Mt.state.ref);if(!e)return;const{focusNode:n}=e,s=m(n);if(void 0!==wi.find((({active:t})=>t(s))))return;const r=wi.find((({match:t})=>t({key:{key:o},lastKey:this.lastKey,lastBeforeInput:this.lastBeforeInput})));if(void 0!==r)return await(async({$event:t,transformInput:i,target:o,parent:e})=>{(({target:t,parent:i,transformInput:o})=>{const e=B({target:t});if(t.nodeValue.length===e)return!0;const{active:n}=o;return!n(i)})({target:o,parent:e,transformInput:i})&&(t.preventDefault(),ti.state.observe=!1,await(({target:t,transformInput:i,parent:o})=>new Promise((async e=>{const n=B({target:t});if(t.nodeValue.length===n){if(!i.shouldTrimText(t))return void e();const o=new MutationObserver((()=>{o.disconnect(),e()}));return o.observe(Mt.state.ref,{characterData:!0,subtree:!0}),void(t.nodeValue=t.nodeValue.substring(0,t.nodeValue.length-i.trim()))}const s=await Mi({target:t,index:n,transformInput:i}),r=new MutationObserver((t=>{var i;r.disconnect(),H(null===(i=t[1])||void 0===i?void 0:i.addedNodes[0]),e()}));r.observe(Mt.state.ref,{childList:!0,subtree:!0}),t.nextSibling?o.insertBefore(s,t.nextSibling):o.appendChild(s)})))({target:o,parent:e,transformInput:i}),ti.state.observe=!0,await(({target:t,parent:i,transformInput:o})=>new Promise((async e=>{const n=new MutationObserver((t=>{var i;n.disconnect(),H(null===(i=t[0])||void 0===i?void 0:i.addedNodes[0]),e()}));n.observe(Mt.state.ref,{childList:!0,subtree:!0});const{active:s,transform:r}=o;if(s(i))return;const a=r();a.innerHTML="​";const l=document.createTextNode("​");t.nextSibling?i.insertBefore(a,t.nextSibling):i.append(a,l)})))({target:o,parent:e,transformInput:i}))})({$event:t,transformInput:r,target:n,parent:s}),await(null===(i=r.postTransform)||void 0===i?void 0:i.call(r)),void(this.lastKey=void 0);this.lastKey={key:o}}deleteSelection(t){const{key:i}=t;if(!["Delete","Backspace"].includes(i))return;const{range:o}=Ht(Mt.state.ref);if(!o)return;if(!Mt.state.ref.isEqualNode(null==o?void 0:o.commonAncestorContainer))return;if(1===o.startOffset&&"​"===o.startContainer.textContent.charAt(0)&&o.setStart(o.startContainer,0),o.startOffset>0)return;if(!U({element:o.startContainer,container:Mt.state.ref}))return;const e=m(y({element:o.startContainer,container:Mt.state.ref}));e&&(o.setStartBefore(e),t.preventDefault(),t.stopImmediatePropagation(),o.deleteContents())}}const Ai=({linkUrl:t})=>{const i=document.createElement("a");return i.href=t,i.rel="noopener noreferrer",i.target="_blank",i};class Ri{constructor(){this.onPaste=async t=>{const i=t.clipboardData.getData("text/html"),o=document.createElement("div");o.innerHTML=i;const e=o.children.length<=0;if(e){const i=t.clipboardData.getData("text/plain");if((t=>{try{const{protocol:i}=new URL(t);return["http:","https:"].includes(i)}catch(t){return!1}})(i)){const t=Ai({linkUrl:i});t.innerHTML=i,o.append(t)}}if(e&&o.children.length<=0)return;const{range:n,selection:s}=Ht(Mt.state.ref);if(!n)return;const r=m(null==s?void 0:s.anchorNode);if(!r)return;t.preventDefault();const a=m(y({element:r,container:Mt.state.ref}));this.cleanAttributes(o),this.cleanMetas(o);const l=void 0!==Array.from(o.childNodes).find((t=>!$(t)));if(Dt(n),!l)return a?void await this.insertNodes({range:n,div:o}):void K({paragraph:a,container:Mt.state.ref,nodes:[o]});const h=Array.from(o.childNodes).map((t=>{if(L(t)||"span"===t.nodeName.toLowerCase().trim()){const i=document.createElement("div");return i.appendChild(t),i}return t}));if(w({paragraph:a}))return void V({elements:h,paragraph:a,container:Mt.state.ref});const c=this.splitCurrentParagraph({range:n,paragraph:a});K({paragraph:a,container:Mt.state.ref,nodes:[...h,...void 0!==c?[c]:[]]})}}init(){var t;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("paste",this.onPaste)}destroy(){var t;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("paste",this.onPaste)}async insertNodes({range:t,div:i}){const o=document.createDocumentFragment();o.append(...Array.from(i.childNodes));const e=await F({observerRoot:Mt.state.ref,range:t,element:o});H(e)}splitCurrentParagraph({range:t,paragraph:i}){if(i)return t.collapse(!0),t.setEndAfter(i),t.extractContents()}cleanAttributes(t){const i=[...new Set([...xt.state.attributes.exclude,"class","style"])],o=({element:t,attributes:i})=>{for(const o of i)t.removeAttribute(o)},e=t.querySelectorAll(i.map((t=>`[${t}]`)).join(","));for(const t of Array.from(e))o({element:t,attributes:i});return t}cleanMetas(t){const i=Array.from(t.children).filter((t=>Z(t)));for(const t of i)t.parentElement.removeChild(t);return t}}class zi{constructor(){this.onSelectParagraph=({detail:t})=>{var i,o,e,n,s,r;const a=null===(i=Mt.state.ref)||void 0===i?void 0:i.firstElementChild,l=null===(o=Mt.state.ref)||void 0===o?void 0:o.children[1],h=a&&t&&t.isEqualNode(a),c=l&&t&&t.isEqualNode(l);null===(e=Mt.state.ref)||void 0===e||e.removeEventListener("keydown",this.onKeyChange),null===(n=Mt.state.ref)||void 0===n||n.removeEventListener("keyup",this.onKeyChange),(h||c)&&(null===(s=Mt.state.ref)||void 0===s||s.addEventListener("keydown",this.onKeyChange),null===(r=Mt.state.ref)||void 0===r||r.addEventListener("keyup",this.onKeyChange)),this.classesEmpty(),this.cleanEmpty()},this.onKeyChange=()=>{var t;const i=y({element:null===(t=getSelection())||void 0===t?void 0:t.anchorNode,container:Mt.state.ref});i&&!L(i)&&setTimeout((()=>this.toggleClassEmpty(i)),250)}}init({editorRef:t}){var i,o;this.editorRef=t,null===(i=this.editorRef)||void 0===i||i.addEventListener("selectParagraph",this.onSelectParagraph),null===(o=Mt.state.ref)||void 0===o||o.addEventListener("focusin",this.onSelectParagraph,{passive:!0}),this.classesEmpty()}destroy(){var t,i;null===(t=this.editorRef)||void 0===t||t.removeEventListener("selectParagraph",this.onSelectParagraph),null===(i=Mt.state.ref)||void 0===i||i.removeEventListener("focusin",this.onSelectParagraph)}classesEmpty(){var t,i;const o=null===(t=Mt.state.ref)||void 0===t?void 0:t.firstElementChild,e=null===(i=Mt.state.ref)||void 0===i?void 0:i.children[1];this.classEmpty(o),this.classEmpty(e)}classEmpty(t){if(!t)return;const i=y({element:t,container:Mt.state.ref});i&&!L(i)&&this.toggleClassEmpty(i)}toggleClassEmpty(t){var i;const{classList:o,nodeName:e}=t;if(!xt.state.textParagraphs.includes(e.toLowerCase()))return void o.remove("stylo-placeholder-empty");const n=w({paragraph:t}),s=R(t);n&&(0===s||(null===(i=Mt.state.ref)||void 0===i?void 0:i.children.length)<=2)?o.add("stylo-placeholder-empty"):o.remove("stylo-placeholder-empty")}cleanEmpty(){var t;const i=null===(t=Mt.state.ref)||void 0===t?void 0:t.querySelectorAll(".stylo-empty"),o=Array.from(i||[]).filter((t=>R(t)>1));for(const t of o)t.classList.remove("stylo-empty")}}class Oi{constructor(){this.onKeyDown=async t=>{const{key:i}=t;["Tab"].includes(i)&&(t.preventDefault(),await this.catchTab(t))}}init(){var t;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("keydown",this.onKeyDown)}destroy(){var t;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("keydown",this.onKeyDown)}async catchTab({shiftKey:t}){const{range:i,selection:o}=Ht(Mt.state.ref);if(!i)return;const e=null==o?void 0:o.focusNode,n=y({element:e,container:Mt.state.ref});n&&_({node:n})?await this.createSublist({paragraph:n,node:e,range:i,shiftKey:t}):t||this.createTabulation({range:i,node:e,paragraph:n})}createTabulation({range:t,node:i,paragraph:o}){if(!L(i))return void 0!==o?void this.insertSpanTabulation({range:t}):void 0;this.insertSpanTabulation({range:t})}insertSpanTabulation({range:t}){const i=document.createElement("span");i.innerHTML="\t",null==t||t.insertNode(i),H(i)}async createSublist({paragraph:t,node:i,range:o,shiftKey:e}){const n=void 0!==i&&_({node:i}),s=t.nodeName.toLowerCase(),r=n?i.firstChild:this.findParentElement({element:i,paragraph:t,nodeName:"li"});if(!r)return void this.createTabulation({range:o,node:i,paragraph:t});const a=n?i:this.findParentElement({element:i,paragraph:t,nodeName:s});if(!a)return void this.createTabulation({range:o,node:i,paragraph:t});if(e){if(P({element:a,container:Mt.state.ref}))return;const i=new MutationObserver((t=>{var o;i.disconnect();const e=null===(o=t.find((({addedNodes:t})=>t.length>0)))||void 0===o?void 0:o.addedNodes[0];M(e)}));i.observe(t,{childList:!0,subtree:!0});const o=new Range;o.setStartBefore(r),o.setEndAfter(a.lastChild);const e=Y(r),n=o.extractContents();return 0===e?void a.parentElement.replaceChild(n,a):void a.parentElement.insertBefore(n,a.nextSibling)}const{endOffset:l,commonAncestorContainer:h}=o,c=0===h.textContent.length,d=l===h.textContent.length,u=h.isSameNode(this.findLastChild(r));if(!(d&&u||c))return void this.createTabulation({range:o,node:i,paragraph:t});if(1===a.childNodes.length)return void this.createTabulation({range:o,node:i,paragraph:t});const f=new MutationObserver((t=>{var i;f.disconnect();const o=null===(i=t.find((({addedNodes:t})=>t.length>0)))||void 0===i?void 0:i.addedNodes[0];if(!o)return;const e=_({node:o})?o.firstChild:o;0!==o.textContent.length?H(e):M(e)}));if(f.observe(t,{childList:!0,subtree:!0}),r.previousSibling&&_({node:r.previousSibling}))return void r.previousSibling.appendChild(r);const p=new Range;p.selectNode(r);const v=p.cloneContents(),g=document.createElement(s);g.append(v),a.replaceChild(g,r)}findParentElement({element:t,paragraph:i,nodeName:o}){const{nodeName:e,parentElement:n}=t;return e.toLowerCase()===o?t:P({element:t,container:Mt.state.ref})?void 0:this.findParentElement({element:n,paragraph:i,nodeName:o})}findLastChild(t){return null!==t.lastChild?this.findLastChild(t.lastChild):t}}class Ti{constructor(){this.undoInputs=void 0,this.undoUpdateParagraphs=[],this.undoSelection=void 0,this.debounceUpdateInputs=et((()=>this.stackUndoInputs()),350),this.onKeydown=async t=>{const{key:i,ctrlKey:o,metaKey:e,shiftKey:n}=t;zt(t)?this.stackUndoInputs():"z"!==i||!o&&!e||n?"z"===i&&(o||e)&&n?await this.redo(t):"Backspace"===i&&this.stackBackspace():await this.undo(t)},this.onKeyup=()=>{var t;this.onEventUpdateParagraphs(null===(t=Tt(Mt.state.ref))||void 0===t?void 0:t.anchorNode)},this.onSelectionChange=()=>this.undoSelection=ii(Mt.state.ref),this.onToolbarActivated=()=>{this.copySelectedParagraphs({filterEmptySelection:!0})},this.onMenuActivated=({detail:t})=>{const{paragraph:i}=t;this.undoUpdateParagraphs=this.toUpdateParagraphs([i])},this.onSnapshotParagraph=({target:t})=>{this.onEventUpdateParagraphs(t)},this.onMouseTouchDown=({target:t})=>{this.onEventUpdateParagraphs(t)},this.onMutation=t=>{const i=this.onParagraphsMutations(t),o=this.onNodesParagraphsMutation(t);oi({container:Mt.state.ref,addRemoveParagraphs:i,updateParagraphs:o,selection:this.undoSelection}),o.length>0||(this.onAttributesMutation(t),this.onCharacterDataMutations(t))}}init(){var t,i,o,e,n;this.undoInputs=void 0,this.undoUpdateParagraphs=[],this.observer=new MutationObserver(this.onMutation),this.observe(),null===(t=Mt.state.ref)||void 0===t||t.addEventListener("keydown",this.onKeydown),null===(i=Mt.state.ref)||void 0===i||i.addEventListener("keyup",this.onKeyup),null===(o=Mt.state.ref)||void 0===o||o.addEventListener("mousedown",this.onMouseTouchDown),null===(e=Mt.state.ref)||void 0===e||e.addEventListener("touchstart",this.onMouseTouchDown),null===(n=Mt.state.ref)||void 0===n||n.addEventListener("snapshotParagraph",this.onSnapshotParagraph),document.addEventListener("selectionchange",this.onSelectionChange),document.addEventListener("toolbarActivated",this.onToolbarActivated),document.addEventListener("menuActivated",this.onMenuActivated),this.unsubscribe=ti.onChange("observe",(t=>{if(t)return this.copySelectedParagraphs({filterEmptySelection:!1}),this.undoInputs=void 0,void this.observe();this.disconnect()}))}destroy(){var t,i,o,e,n,s;this.disconnect(),null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("keydown",this.onKeydown),null===(i=Mt.state.ref)||void 0===i||i.removeEventListener("keyup",this.onKeyup),null===(o=Mt.state.ref)||void 0===o||o.removeEventListener("mousedown",this.onMouseTouchDown),null===(e=Mt.state.ref)||void 0===e||e.removeEventListener("touchstart",this.onMouseTouchDown),null===(n=Mt.state.ref)||void 0===n||n.removeEventListener("snapshotParagraph",this.onSnapshotParagraph),document.removeEventListener("selectionchange",this.onSelectionChange),document.removeEventListener("toolbarActivated",this.onToolbarActivated),document.removeEventListener("menuActivated",this.onMenuActivated),null===(s=this.unsubscribe)||void 0===s||s.call(this)}async undo(t){t.preventDefault(),void 0!==ei()&&await this.undoRedo({undoRedo:ri})}async redo(t){t.preventDefault(),void 0!==ni()&&await this.undoRedo({undoRedo:ai})}stackUndoInputs(){this.copySelectedParagraphs({filterEmptySelection:!1}),this.undoInputs&&((({container:t,data:i})=>{ti.state.undo||(ti.state.undo=[]),ti.state.undo.push({changes:i.map((i=>({type:"input",target:t,data:i})))}),ti.state.redo=[]})({data:this.undoInputs,container:Mt.state.ref}),this.undoInputs=void 0)}stackBackspace(){var t;const{range:i}=Ht(Mt.state.ref);if(!i)return;const o=1===i.startOffset&&"​"===i.startContainer.textContent.charAt(0);if(0!==i.startOffset&&!o)return;const e=null===(t=Tt(Mt.state.ref))||void 0===t?void 0:t.anchorNode;if(!e)return;const n=m(y({element:e,container:Mt.state.ref}));n&&(this.undoUpdateParagraphs=this.toUpdateParagraphs([...n.previousElementSibling?[n.previousElementSibling]:[],n]))}async undoRedo({undoRedo:t}){this.disconnect(),await t(),this.observe()}observe(){this.observer.observe(Mt.state.ref,{childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,subtree:!0})}disconnect(){var t;null===(t=this.observer)||void 0===t||t.disconnect()}onEventUpdateParagraphs(t){if(!t)return;const i=m(y({element:t,container:Mt.state.ref}));i&&(this.undoUpdateParagraphs=this.toUpdateParagraphs([i]))}copySelectedParagraphs({filterEmptySelection:t}){const i=(({container:t,filterEmptySelection:i})=>{const{range:o,selection:e}=Ht(t);if(!o||i&&0===(null==e?void 0:e.toString().length))return;const n=m(y({element:o.startContainer,container:t})),s=m(y({element:o.endContainer,container:t}));if(!s||!n||(null==n?void 0:n.isSameNode(s)))return n?[n]:[];if(n.nextElementSibling.isSameNode(s))return[n,s];const r=[];let a=n.nextElementSibling;for(;null!==a&&!a.isSameNode(s);)r.push(m(a)),a=a.nextElementSibling;return[n,...r,s]})({container:Mt.state.ref,filterEmptySelection:t});i&&(this.undoUpdateParagraphs=this.toUpdateParagraphs(i))}toUpdateParagraphs(t){return t.map((t=>({outerHTML:this.cleanOuterHTML(t),index:R(t),paragraph:t})))}onCharacterDataMutations(t){const i=t.filter((({oldValue:t})=>null!==t));i.length<=0||(this.undoInputs||(this.undoInputs=i.map((t=>this.toUndoInput(t))).filter((t=>void 0!==t))),this.undoInputs.length<=0?this.undoInputs=void 0:this.debounceUpdateInputs())}toUndoInput(t){const i=t.target,o=i.nodeValue;if(o===t.oldValue)return;const e=m(y({element:i,container:Mt.state.ref}));if(!e||!i.parentNode)return;const n=z({target:i,paragraph:e});return{oldValue:t.oldValue,offset:B({target:i})+(t.oldValue.length-o.length),index:R(e),indexDepths:n}}onParagraphsMutations(t){const i=[];Ut({mutations:t,container:Mt.state.ref}).forEach((t=>i.push({outerHTML:this.cleanOuterHTML(t),mutation:"add",index:t.previousElementSibling?R(m(t.previousElementSibling))+1:0}))),i.sort((({index:t},{index:i})=>i-t));const o=(({mutations:t,container:i,paragraphIdentifier:o})=>!t||t.length<=0?[]:t.filter((({removedNodes:t})=>(null==t?void 0:t.length)>0)).reduce(((t,{removedNodes:e,previousSibling:n})=>[...t,...Yt({nodes:Array.from(e),paragraphIdentifier:o}).map((t=>({paragraph:t,previousSibling:Vt({container:i,previousSibling:n})})))]),[]))({mutations:t,container:Mt.state.ref,paragraphIdentifier:xt.state.attributes.paragraphIdentifier}),e=Math.min(...o.map((({previousSibling:t})=>t?R(m(t))+1:0)));return o.forEach((({paragraph:t},o)=>{const n=o+(Number.isFinite(e)?e:0),s=this.undoUpdateParagraphs.find((({index:t})=>t===n));return i.push({outerHTML:(null==s?void 0:s.outerHTML)||this.cleanOuterHTML(t),mutation:"remove",index:n})})),i}onNodesParagraphsMutation(t){const i=$t({mutations:t,container:Mt.state.ref}),o=Kt({mutations:t,paragraphIdentifier:xt.state.attributes.paragraphIdentifier});if(!(i.length>0||o.length>0))return[];if(this.undoUpdateParagraphs.length<=0)return[];const e=Ut({mutations:t,container:Mt.state.ref}),n=this.undoUpdateParagraphs.filter((({paragraph:t})=>t.isConnected&&void 0===e.find((i=>i.isEqualNode(t)))));return n.length<=0?(this.copySelectedParagraphs({filterEmptySelection:!0}),[]):(this.copySelectedParagraphs({filterEmptySelection:!0}),this.undoInputs=void 0,n)}cleanOuterHTML(t){const i=t.cloneNode(!0);return i.removeAttribute("placeholder"),i.outerHTML}onAttributesMutation(t){const i=Ft({mutations:Xt({mutations:t,excludeAttributes:xt.state.attributes.exclude}),container:Mt.state.ref});i.length<=0||this.undoUpdateParagraphs.length<=0||(oi({container:Mt.state.ref,addRemoveParagraphs:[],updateParagraphs:this.undoUpdateParagraphs,selection:this.undoSelection}),this.undoUpdateParagraphs=this.toUpdateParagraphs(i))}}const _i=class{constructor(t){e(this,t),this.debounceSize=et((()=>this.applySize()),250),this.undoRedoEvents=new Ti,this.enterEvents=new mi,this.placeHolderEvents=new zi,this.inputEvents=new Li,this.tabEvents=new Oi,this.dataEvents=new qt,this.pasteEvents=new Ri,this.mobile=Ot(),this.config=void 0,this.containerRef=void 0,this.contentEditable=!0}componentWillLoad(){this.init(),this.applyConfig()}componentDidLoad(){null===window||void 0===window||window.addEventListener("resize",this.debounceSize)}disconnectedCallback(){var t;null===window||void 0===window||window.removeEventListener("resize",this.debounceSize),this.destroy(),null===(t=this.attributesObserver)||void 0===t||t.disconnect()}onContainerRefChange(){this.destroy(),this.init()}onConfigChange(){this.destroy(),this.applyConfig(),this.initEvents()}applySize(){var t;this.mobile||(Mt.state.size=null===(t=this.containerRef)||void 0===t?void 0:t.getBoundingClientRect())}init(){Mt.state.ref=this.containerRef,this.containerRef&&((({rootNode:t})=>{let i=(t===document?document.head:t).querySelector("style[stylo-editor]");null===i&&(i=document.createElement("style"),i.setAttribute("stylo-editor",""),i.innerHTML="\n    .stylo-container > * {\n      white-space: pre-wrap;\n      position: relative;\n    }\n\n    .stylo-container > *:after {\n      content: attr(placeholder);\n      color: var(--stylo-placeholder-color, rgba(55, 53, 47, 0.5));\n      position: absolute;\n      top: 0;\n    }\n  ",t!==document?t.prepend(i):document.head.append(i))})({rootNode:this.containerRef.getRootNode()}),Mt.state.ref.classList.add("stylo-container"),this.containerRefEditable(),this.applySize(),this.initEvents())}containerRefEditable(){var t;null===(t=this.attributesObserver)||void 0===t||t.disconnect(),this.attributesObserver=new MutationObserver((t=>{t.find((({attributeName:t})=>["contenteditable"].includes(t.toLowerCase())))&&(this.contentEditable=this.isContentEditable(),this.contentEditable?this.initEvents():this.destroy())})),this.attributesObserver.observe(Mt.state.ref,{attributes:!0}),this.contentEditable=this.isContentEditable()}isContentEditable(){return["true",""].includes(this.containerRef.getAttribute("contenteditable"))}applyConfig(){var t,i;if(!this.config)return;const{plugins:o,toolbar:e,i18n:n,placeholders:s,textParagraphs:r,menus:a,attributes:l}=this.config;Rt.state.custom=null==n?void 0:n.custom,Rt.state.lang=(null==n?void 0:n.lang)||"en",xt.state.plugins=o||ft,xt.state.toolbar=e?Object.assign(Object.assign({},xt.state.toolbar),e):pt,xt.state.placeholders=s||vt,xt.state.textParagraphs=r||gt,xt.state.menus=a;const h=null!==(t=null==l?void 0:l.paragraphIdentifier)&&void 0!==t?t:"paragraph_id";xt.state.attributes={paragraphIdentifier:h,exclude:[...new Set([...null!==(i=null==l?void 0:l.exclude)&&void 0!==i?i:[],...bt,h])]}}destroy(){this.undoRedoEvents.destroy(),this.inputEvents.destroy(),this.enterEvents.destroy(),this.placeHolderEvents.destroy(),this.tabEvents.destroy(),this.dataEvents.destroy(),this.pasteEvents.destroy(),ti.state.undo=[],ti.state.redo=[]}initEvents(){this.contentEditable&&(this.inputEvents.init(),this.enterEvents.init(),this.placeHolderEvents.init({editorRef:this.el}),this.tabEvents.init(),this.dataEvents.init({editorRef:this.el}),this.undoRedoEvents.init(),this.pasteEvents.init())}render(){var t;if(this.contentEditable)return o(a,null,o("stylo-add",null),o("stylo-plugins",null),this.renderToolbar(),(null===(t=xt.state.menus)||void 0===t?void 0:t.length)&&o("stylo-menus",null))}renderToolbar(){if(!this.mobile)return o("stylo-toolbar",{containerRef:this.containerRef})}get el(){return r(this)}static get watchers(){return{containerRef:["onContainerRefChange"],config:["onConfigChange"]}}};_i.style=":host{display:block}";const Si=()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M160 368L32 256l128-112M352 368l128-112-128-112M304 96l-96 320"})),Ii=()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o("circle",{cx:"256",cy:"256",r:"48"}),o("circle",{cx:"416",cy:"256",r:"48"}),o("circle",{cx:"96",cy:"256",r:"48"})),Hi=()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"512",height:"512",viewBox:"0 0 512 512"},o("path",{d:"M432,112V96a48.14,48.14,0,0,0-48-48H64A48.14,48.14,0,0,0,16,96V352a48.14,48.14,0,0,0,48,48H80",style:{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"32px"}}),o("rect",{x:"96",y:"128",width:"400",height:"336",rx:"45.99",ry:"45.99",style:{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"32px"}}),o("ellipse",{cx:"372.92",cy:"219.64",rx:"30.77",ry:"30.55",style:{fill:"none",stroke:"currentColor",strokeMiterlimit:"10",strokeWidth:"32px"}}),o("path",{d:"M342.15,372.17,255,285.78a30.93,30.93,0,0,0-42.18-1.21L96,387.64",style:{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32px"}}),o("path",{d:"M265.23,464,383.82,346.27a31,31,0,0,1,41.46-1.87L496,402.91",style:{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32px"}})),Di=()=>o("svg",{width:"100%",height:"100%",viewBox:"0 0 512 512",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"1.41421"}},o("path",{d:"M432,240l-240.5,0c-8.8,0 -16,7.2 -16,16c0,8.8 7.2,16 16,16l240.5,0c8.8,0 16,-7.2 16,-16c0,-8.8 -7.2,-16 -16,-16Zm0,124l-240.5,0c-8.8,0 -16,7.2 -16,16c0,8.8 7.2,16 16,16l240.5,0c8.8,0 16,-7.2 16,-16c0,-8.8 -7.2,-16 -16,-16Zm-240.5,-216l240.5,0c8.8,0 16,-7.2 16,-16c0,-8.8 -7.2,-16 -16,-16l-240.5,0c-8.8,0 -16,7.2 -16,16c0,8.8 7.2,16 16,16Z",style:{fillRule:"nonzero",fill:"currentColor"}}),o("path",{d:"M80.784,159.32l14.784,0l0,-46.896c0,-1.408 0.048,-2.832 0.144,-4.272l-12.288,10.512c-0.32,0.256 -0.64,0.44 -0.96,0.552c-0.32,0.112 -0.624,0.168 -0.912,0.168c-0.48,0 -0.912,-0.104 -1.296,-0.312c-0.384,-0.208 -0.672,-0.456 -0.864,-0.744l-2.688,-3.696l20.448,-17.712l6.96,0l0,62.4l13.536,0l0,6.528l-36.864,0l0,-6.528Z",style:{fillRule:"nonzero",fill:"currentColor"}}),o("path",{d:"M95.856,221.296c2.912,0 5.632,0.432 8.16,1.296c2.528,0.864 4.712,2.12 6.552,3.768c1.84,1.648 3.288,3.656 4.344,6.024c1.056,2.368 1.584,5.056 1.584,8.064c0,2.56 -0.384,4.928 -1.152,7.104c-0.768,2.176 -1.808,4.264 -3.12,6.264c-1.312,2 -2.824,3.936 -4.536,5.808c-1.712,1.872 -3.528,3.784 -5.448,5.736l-18.096,18.528c1.28,-0.352 2.576,-0.632 3.888,-0.84c1.312,-0.208 2.576,-0.312 3.792,-0.312l23.04,0c0.928,0 1.664,0.272 2.208,0.816c0.544,0.544 0.816,1.248 0.816,2.112l0,5.184l-45.888,0l0,-2.928c0,-0.608 0.12,-1.232 0.36,-1.872c0.24,-0.64 0.632,-1.232 1.176,-1.776l22.032,-22.128c1.824,-1.856 3.488,-3.64 4.992,-5.352c1.504,-1.712 2.792,-3.432 3.864,-5.16c1.072,-1.728 1.896,-3.48 2.472,-5.256c0.576,-1.776 0.864,-3.672 0.864,-5.688c0,-2.016 -0.32,-3.784 -0.96,-5.304c-0.64,-1.52 -1.52,-2.776 -2.64,-3.768c-1.12,-0.992 -2.432,-1.736 -3.936,-2.232c-1.504,-0.496 -3.12,-0.744 -4.848,-0.744c-1.728,0 -3.328,0.256 -4.8,0.768c-1.472,0.512 -2.776,1.224 -3.912,2.136c-1.136,0.912 -2.096,1.992 -2.88,3.24c-0.784,1.248 -1.336,2.624 -1.656,4.128c-0.256,0.928 -0.64,1.6 -1.152,2.016c-0.512,0.416 -1.184,0.624 -2.016,0.624c-0.16,0 -0.328,-0.008 -0.504,-0.024c-0.176,-0.016 -0.376,-0.04 -0.6,-0.072l-4.464,-0.768c0.448,-3.136 1.312,-5.912 2.592,-8.328c1.28,-2.416 2.904,-4.44 4.872,-6.072c1.968,-1.632 4.224,-2.872 6.768,-3.72c2.544,-0.848 5.288,-1.272 8.232,-1.272Z",style:{fillRule:"nonzero",fill:"currentColor"}}),o("path",{d:"M96.768,345.296c2.912,0 5.6,0.416 8.064,1.248c2.464,0.832 4.584,2.016 6.36,3.552c1.776,1.536 3.16,3.392 4.152,5.568c0.992,2.176 1.488,4.592 1.488,7.248c0,2.176 -0.28,4.12 -0.84,5.832c-0.56,1.712 -1.36,3.216 -2.4,4.512c-1.04,1.296 -2.296,2.392 -3.768,3.288c-1.472,0.896 -3.12,1.616 -4.944,2.16c4.48,1.184 7.848,3.168 10.104,5.952c2.256,2.784 3.384,6.272 3.384,10.464c0,3.168 -0.6,6.016 -1.8,8.544c-1.2,2.528 -2.84,4.68 -4.92,6.456c-2.08,1.776 -4.504,3.136 -7.272,4.08c-2.768,0.944 -5.736,1.416 -8.904,1.416c-3.648,0 -6.768,-0.456 -9.36,-1.368c-2.592,-0.912 -4.784,-2.168 -6.576,-3.768c-1.792,-1.6 -3.264,-3.496 -4.416,-5.688c-1.152,-2.192 -2.128,-4.568 -2.928,-7.128l3.648,-1.536c0.672,-0.288 1.344,-0.432 2.016,-0.432c0.64,0 1.208,0.136 1.704,0.408c0.496,0.272 0.872,0.696 1.128,1.272c0.064,0.128 0.128,0.264 0.192,0.408c0.064,0.144 0.128,0.296 0.192,0.456c0.448,0.928 0.992,1.976 1.632,3.144c0.64,1.168 1.504,2.264 2.592,3.288c1.088,1.024 2.44,1.888 4.056,2.592c1.616,0.704 3.624,1.056 6.024,1.056c2.4,0 4.504,-0.392 6.312,-1.176c1.808,-0.784 3.312,-1.8 4.512,-3.048c1.2,-1.248 2.104,-2.64 2.712,-4.176c0.608,-1.536 0.912,-3.056 0.912,-4.56c0,-1.856 -0.248,-3.552 -0.744,-5.088c-0.496,-1.536 -1.392,-2.864 -2.688,-3.984c-1.296,-1.12 -3.088,-2 -5.376,-2.64c-2.288,-0.64 -5.224,-0.96 -8.808,-0.96l0,-6.192c2.912,-0.032 5.4,-0.352 7.464,-0.96c2.064,-0.608 3.752,-1.44 5.064,-2.496c1.312,-1.056 2.264,-2.32 2.856,-3.792c0.592,-1.472 0.888,-3.104 0.888,-4.896c0,-1.984 -0.312,-3.712 -0.936,-5.184c-0.624,-1.472 -1.48,-2.688 -2.568,-3.648c-1.088,-0.96 -2.376,-1.68 -3.864,-2.16c-1.488,-0.48 -3.096,-0.72 -4.824,-0.72c-1.728,0 -3.328,0.256 -4.8,0.768c-1.472,0.512 -2.776,1.224 -3.912,2.136c-1.136,0.912 -2.088,2 -2.856,3.264c-0.768,1.264 -1.344,2.632 -1.728,4.104c-0.256,0.928 -0.64,1.6 -1.152,2.016c-0.512,0.416 -1.168,0.624 -1.968,0.624c-0.16,0 -0.328,-0.008 -0.504,-0.024c-0.176,-0.016 -0.376,-0.04 -0.6,-0.072l-4.464,-0.768c0.448,-3.136 1.312,-5.912 2.592,-8.328c1.28,-2.416 2.904,-4.44 4.872,-6.072c1.968,-1.632 4.224,-2.872 6.768,-3.72c2.544,-0.848 5.288,-1.272 8.232,-1.272Z",style:{fillRule:"nonzero",fill:"currentColor"}})),Ni=()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o("circle",{cx:"92",cy:"256",r:"28",style:{fill:"currentColor"}}),o("circle",{cx:"92",cy:"132",r:"28",style:{fill:"currentColor"}}),o("circle",{cx:"92",cy:"380",r:"28",style:{fill:"currentColor"}}),o("path",{style:{fill:"currentColor"},d:"M432 240H191.5c-8.8 0-16 7.2-16 16s7.2 16 16 16H432c8.8 0 16-7.2 16-16s-7.2-16-16-16zM432 364H191.5c-8.8 0-16 7.2-16 16s7.2 16 16 16H432c8.8 0 16-7.2 16-16s-7.2-16-16-16zM191.5 148H432c8.8 0 16-7.2 16-16s-7.2-16-16-16H191.5c-8.8 0-16 7.2-16 16s7.2 16 16 16z"})),ji=t=>{switch(t){case"code":return o(Si,null);case"ul":return o(Ni,null);case"ol":return o(Di,null);case"hr":return o(Ii,null);case"img":return o(Hi,null);default:return}},Ei=class{constructor(t){e(this,t),this.applyPlugin=n(this,"applyPlugin",7),this.cancelPlugins=n(this,"cancelPlugins",7),this.filter="",this.onKeyDown=t=>{const{code:i}=t;["Enter"].includes(i)||(t.preventDefault(),["Escape"].includes(i)?this.cancelPlugins.emit():["ArrowDown"].includes(i)?this.focusNext():["ArrowUp"].includes(i)?this.focusPrevious():this.filterPlugins(t))},this.display=!1,this.plugins=void 0}componentWillLoad(){this.plugins=[...xt.state.plugins]}componentDidUpdate(){this.focusOnUpdate()}focusOnUpdate(){const t=this.el.shadowRoot.querySelectorAll("button");1===t.length&&t[0].focus()}emitPlugin(t,i){t.stopPropagation(),this.applyPlugin.emit(i)}onDisplay(){this.display?document.addEventListener("keydown",this.onKeyDown):(document.removeEventListener("keydown",this.onKeyDown,!1),this.reset())}reset(){this.filter="",this.plugins=[...xt.state.plugins]}async focusFirstButton(){var t;this.focusButton=this.el.shadowRoot.querySelector("button"),null===(t=this.focusButton)||void 0===t||t.focus()}focusNext(){var t,i;this.focusButton=m(null===(t=this.focusButton||this.el.shadowRoot.firstElementChild)||void 0===t?void 0:t.nextElementSibling),null===(i=this.focusButton)||void 0===i||i.focus()}focusPrevious(){var t,i;this.focusButton=m(null===(t=this.focusButton||this.el.shadowRoot.lastElementChild)||void 0===t?void 0:t.previousElementSibling),null===(i=this.focusButton)||void 0===i||i.focus()}filterPlugins(t){const{code:i,metaKey:o,ctrlKey:e,key:n}=t;o||e||n.length>1&&!["Backspace"].includes(i)||(this.filter="Backspace"===i?this.filter.length>0?this.filter.slice(0,-1):this.filter:`${this.filter}${n}`,this.plugins=[...xt.state.plugins].filter((({text:t})=>{var i,o;return(null!==(o=null!==(i=Rt.state.plugins[t])&&void 0!==i?i:Rt.state.custom[t])&&void 0!==o?o:t).toLowerCase().indexOf(this.filter.toLowerCase())>-1})))}render(){return o(a,null,this.plugins.map(((t,i)=>this.renderPlugin(t,`plugin-${i}`))),this.renderEmpty())}renderEmpty(){if(!(this.plugins.length>0))return o("span",{class:"empty"},Rt.state.plugins.no_matches,": ",o("strong",null,this.filter))}renderPlugin(t,i){const{text:e,icon:n}=t,s=ji(n);return o("button",{key:i,onClick:i=>this.emitPlugin(i,t)},void 0===s&&o("div",Object.assign({class:"icon"},void 0===s&&{innerHTML:n})),s,this.renderText(e))}renderText(t){var i,e,n,s,r;const l=null!==(e=null!==(i=Rt.state.plugins[t])&&void 0!==i?i:Rt.state.custom[t])&&void 0!==e?e:t;if(this.filter.length>0){const t=new RegExp(this.filter+"(.*)","gi"),i=l.split(t),e=new RegExp(this.filter,"gi"),h=l.match(e);return o(a,null,null!==(n=i[0])&&void 0!==n?n:"",o("strong",null,null!==(s=h[0])&&void 0!==s?s:""),null!==(r=i[1])&&void 0!==r?r:"")}return l}get el(){return r(this)}static get watchers(){return{display:["onDisplay"]}}};Ei.style=":host{display:flex;flex-direction:column;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff;--background-active:var(--stylo-list-background-active, var(--light));--border-active:var(--stylo-list-border-active, 1px solid var(--background-active));--color-active:var(--stylo-list-color-active, var(--light-contrast))}button{display:flex;position:relative;isolation:isolate;overflow:hidden;background:transparent;border:none;outline:none;cursor:pointer;transition:color 0.25s ease-out, background 0.25s ease-out, transform 0.15s ease-out;justify-content:flex-start;align-items:center;font-size:1rem;color:var(--stylo-toolbar-button-color, black);white-space:pre}button:active{box-shadow:none;transform:translateX(1px) translateY(1px)}button:hover,button:focus{background:var(--background-active);color:var(--color-active)}svg,span.placeholder{width:1.4rem;height:1.4rem;border:var(--border-active);border-radius:var(--stylo-border, 4px);margin:4px 12px 4px 8px;background:var(--white)}svg{padding:8px}span.placeholder{padding:10px 8px 6px;font-size:0.8rem}span.placeholder::first-letter{font-size:125%}div.icon{display:flex}.empty{padding:10px 16px 6px}.empty strong{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block}";const Bi=class{constructor(t){e(this,t),this.menuActivated=n(this,"menuActivated",7),this.onKeyDown=()=>{this.hide()},this.top=void 0,this.menu=void 0}componentDidLoad(){this.destroyListener=Mt.onChange("ref",(()=>{this.removeContainerListener(),this.addContainerListener()})),this.addContainerListener()}disconnectedCallback(){var t;this.removeContainerListener(),null===(t=this.destroyListener)||void 0===t||t.call(this)}addContainerListener(){var t;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("keydown",this.onKeyDown,{passive:!0})}removeContainerListener(){var t;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("keydown",this.onKeyDown)}onResize(){this.hide()}onClick({target:t}){var i,o;const e=y({element:t,container:Mt.state.ref});this.paragraph=m(e),this.paragraph?(this.menuActivated.emit({paragraph:this.paragraph}),this.menu=null===(i=xt.state.menus)||void 0===i?void 0:i.find((({match:t})=>t({paragraph:this.paragraph}))),this.top=this.menu&&(null===(o=this.paragraph)||void 0===o?void 0:o.offsetTop)):this.hide()}async selectMenuAction({action:t}){this.paragraph?(await t({paragraph:this.paragraph}),this.hide()):this.hide()}hide(){this.paragraph=void 0,this.menu=void 0,this.top=void 0}render(){return o(s,{style:void 0===this.top?{display:"none"}:{"--menu-top":`${this.top}px`}},this.renderMenu(),o("stylo-toolbar-triangle",{style:{"--stylo-toolbar-triangle-start":"50%"}}))}renderMenu(){var t;return null===(t=this.menu)||void 0===t?void 0:t.actions.map((t=>this.renderAction(t)))}renderAction(t){var i,e;const{icon:n,text:s}=t,r=ji(n);return o("stylo-toolbar-button",{onAction:async()=>await this.selectMenuAction(t),label:null!==(e=null!==(i=Rt.state.menus[s])&&void 0!==i?i:Rt.state.custom[s])&&void 0!==e?e:s},r||o("div",{class:"icon",innerHTML:n}))}};Bi.style=":host{display:flex;justify-content:center;align-items:center;position:absolute;top:var(--menu-top);left:50%;transform:translate(-50%, calc(-100% - 16px));--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff;--box-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.12);box-shadow:var(--stylo-box-shadow, var(--box-shadow));border:var(--stylo-border);background:var(--stylo-background, var(--white));color:var(--stylo-color, var(--white-contrast));border-radius:var(--stylo-border, 4px);padding:var(--stylo-toolbar-padding, 0 8px);z-index:var(--stylo-toolbar-zindex, 1)}div.icon{display:flex;flex-direction:column}";const Wi=class{constructor(t){e(this,t),this.display=!1,this.position=void 0}componentWillLoad(){this.destroyListener=Mt.onChange("size",(()=>{Ot()||this.hide()}))}disconnectedCallback(){var t;null===(t=this.destroyListener)||void 0===t||t.call(this)}onClick(t){this.hide()}onHidePlugins(){this.hide()}hide(){this.display=!1,setTimeout((()=>this.position=void 0),150)}onListPlugins({detail:t}){if(!t)return void this.hide();const{height:i,top:o}=t.getBoundingClientRect(),e=o+220+16<(window.innerHeight||screen.height);this.position={top:t.offsetTop+(e?i:-1*i),left:t.offsetLeft,downward:e},this.paragraph=t,this.displayAndFocus()}displayAndFocus(){new MutationObserver((async(t,i)=>{var o;"visible"===this.el.style.visibility&&(i.disconnect(),await(null===(o=this.el.shadowRoot.querySelector("stylo-list"))||void 0===o?void 0:o.focusFirstButton()))})).observe(this.el,{attributes:!0,subtree:!0}),setTimeout((()=>this.display=!0),150)}onCancelPlugins(){this.hide(),k({paragraph:this.paragraph})}async onApplyPlugin(t){if(!Mt.state.ref||!this.paragraph)return;this.hide();const{files:i}=t;void 0===i?await this.transformParagraph({plugin:t}):this.openFilePicker(t)}async transformParagraph({plugin:t,files:i}){const{createParagraphs:o}=t;await o({paragraph:m(this.paragraph),container:Mt.state.ref,files:i})}openFilePicker(t){const i=this.filePicker(t);null==i||i.click()}async onFilePickerChange(t){const i=this.filePicker(t);!i||i.files.length<=0||(await this.transformParagraph({plugin:t,files:i.files}),i.value="")}filePicker({files:t}){const{accept:i}=t;return this.el.shadowRoot.querySelector(`input[accept="${i}"]`)}render(){const t=Object.assign(Object.assign({visibility:this.display?"visible":"hidden"},!this.display&&{height:"0px"}),void 0===this.position?{}:{"--actions-top":`${this.position.top}px`,"--actions-left":`${this.position.left}px`,"--actions-translate-y":this.position.downward?"0":"-100%"});return o(s,{style:t,class:this.display?"display":"hidden"},this.renderList(),this.renderInputs())}renderInputs(){return xt.state.plugins.filter((({files:t})=>void 0!==t)).map((t=>{const{accept:i,multiple:e}=t.files;return o("input",{type:"file",accept:i,multiple:e,onChange:async()=>await this.onFilePickerChange(t)})}))}renderList(){return o("stylo-list",{onApplyPlugin:async({detail:t})=>await this.onApplyPlugin(t),onCancelPlugins:()=>this.onCancelPlugins(),display:this.display})}get el(){return r(this)}};Wi.style=":host{display:flex;flex-direction:column;position:absolute;top:var(--actions-top);left:var(--actions-left);transform:translate(0, var(--actions-translate-y)) scale(0.95);opacity:0;margin:2px 0;width:220px;max-height:220px;overflow:auto;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff;background:var(--stylo-background, var(--white));color:var(--stylo-color, var(--white-contrast));border-radius:var(--stylo-border, 4px);--box-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.12);box-shadow:var(--stylo-box-shadow, var(--box-shadow));border:var(--stylo-border);pointer-events:none;transition-property:opacity, transform;transition-duration:0.15s, 0.15s;transition-timing-function:cubic-bezier(0.175, 0.885, 0.32, 1.275), cubic-bezier(0.175, 0.885, 0.32, 1.275)}:host(.display){opacity:1;transform:translate(0, var(--actions-translate-y)) scale(1);pointer-events:all}input{visibility:hidden;opacity:0}";const Ui={cmd:"style",detail:{style:"font-weight",value:"bold",initial:t=>t&&"bold"===t.style["font-weight"]}},$i={cmd:"style",detail:{style:"font-style",value:"italic",initial:t=>t&&"italic"===t.style["font-style"]}},Ki={cmd:"style",detail:{style:"text-decoration",value:"underline",initial:t=>t&&"underline"===t.style["text-decoration"]}},Vi={cmd:"style",detail:{style:"text-decoration",value:"line-through",initial:t=>t&&"line-through"===t.style["text-decoration"]}};function Fi(t,i=!0){t.hasChildNodes()&&i&&Array.from(t.childNodes).forEach((i=>{if(i.hasChildNodes()&&i.childNodes.length>1&&i.firstChild.nodeType!==Node.TEXT_NODE&&i.firstChild.nodeType!==Node.COMMENT_NODE){const o=document.createElement("span");o.append(...Array.from(i.childNodes)),t.parentElement.insertBefore(o,t)}else{const o=document.createTextNode(i.textContent);t.parentElement.insertBefore(o,t)}})),t.parentElement.removeChild(t)}const Zi=(t,i,o)=>{if("HTML"===t.nodeName.toUpperCase()||"BODY"===t.nodeName.toUpperCase())return null;if(!t.parentNode)return null;if(P({element:t,container:o}))return null;const{style:e}=m(t);return null!=e[i]&&""!==e[i]?t:Zi(t.parentNode,i,o)},Yi=(t,i)=>{if(!t)return!1;if(t.nodeName.toLowerCase()===i)return!0;if(t.hasChildNodes()){const o=t.getElementsByTagName(i);return o&&o.length>0}return!1};function Xi(t,i,o){const e=J(t);e&&(e&&e.innerText===t.toString()&&!P({element:e,container:o})&&void 0!==e.style[i.style]?qi(e,i,o):function(t,i,o,e){const n=o.getRangeAt(0);if(n.commonAncestorContainer&&["ol","ul","dl"].some((t=>t===n.commonAncestorContainer.nodeName.toLowerCase())))return void qi(n.commonAncestorContainer,i,e);const s=n.extractContents(),r=function(t,i,o){const e=document.createElement("span");return e.style[i.style]=Ji(t,i,o),e}(t,i,e);r.appendChild(s),Gi(i,r),Qi(i,r),n.insertNode(r),o.selectAllChildren(r)}(e,i,t,o))}function qi(t,i,o){t.style[i.style]=Ji(o,i,o),Gi(i,t)}function Gi(t,i){if(!i.hasChildNodes())return;const o=Array.from(i.children).filter((i=>void 0!==i.style[t.style]&&""!==i.style[t.style]));o&&o.length>0&&o.forEach((i=>{i.style[t.style]="",""!==i.getAttribute("style")&&null!==i.style||i.removeAttribute("style")})),Array.from(i.children).forEach((i=>Gi(t,i)))}function Ji(t,i,o){if(!t)return i.value;if(i.initial(t))return"initial";const e=Zi(t,i.style,o);return i.initial(e)?"initial":i.value}function Qi(t,i){if(!i.hasChildNodes())return;const o=Array.from(i.children).filter((t=>{const i=t.getAttribute("style");return!i||""===i}));o&&o.length>0?o.forEach((t=>{const i=t.querySelectorAll("[style]");if(!i||0===i.length){const i=document.createTextNode(t.textContent);t.parentElement.replaceChild(i,t)}})):Array.from(i.children).forEach((i=>Qi(t,i)))}const to=()=>o("svg",{width:"100%",height:"100%",viewBox:"0 0 512 512",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round"}},o("path",{d:"M176,331l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),o("path",{d:"M176,185l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),o("path",{d:"M96,258l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),o("path",{d:"M96,112l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),o("path",{d:"M96,400l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}})),io=()=>o("svg",{width:"100%",height:"100%",viewBox:"0 0 512 512",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round"}},o("path",{d:"M96,331l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),o("path",{d:"M96,185l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),o("path",{d:"M96,258l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),o("path",{d:"M96,112l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),o("path",{d:"M96,400l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}})),oo=()=>o("svg",{width:"100%",height:"100%",viewBox:"0 0 512 512",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round"}},o("path",{d:"M256,331l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),o("path",{d:"M256,185l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),o("path",{d:"M96,258l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),o("path",{d:"M96,112l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),o("path",{d:"M96,400l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}})),eo=()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o("path",{d:"M419.1 337.45a3.94 3.94 0 00-6.1 0c-10.5 12.4-45 46.55-45 77.66 0 27 21.5 48.89 48 48.89h0c26.5 0 48-22 48-48.89 0-31.11-34.3-65.26-44.9-77.66zM387 287.9L155.61 58.36a36 36 0 00-51 0l-5.15 5.15a36 36 0 000 51l52.89 52.89 57-57L56.33 263.2a28 28 0 00.3 40l131.2 126a28.05 28.05 0 0038.9-.1c37.8-36.6 118.3-114.5 126.7-122.9 5.8-5.8 18.2-7.1 28.7-7.1h.3a6.53 6.53 0 004.57-11.2z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"})),no=()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o("path",{d:"M208 352h-64a96 96 0 010-192h64M304 160h64a96 96 0 010 192h-64M163.29 256h187.42",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"})),so=()=>o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},o("path",{d:"M430.11 347.9c-6.6-6.1-16.3-7.6-24.6-9-11.5-1.9-15.9-4-22.6-10-14.3-12.7-14.3-31.1 0-43.8l30.3-26.9c46.4-41 46.4-108.2 0-149.2-34.2-30.1-80.1-45-127.8-45-55.7 0-113.9 20.3-158.8 60.1-83.5 73.8-83.5 194.7 0 268.5 41.5 36.7 97.5 55 152.9 55.4h1.7c55.4 0 110-17.9 148.8-52.4 14.4-12.7 11.99-36.6.1-47.7z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"}),o("circle",{cx:"144",cy:"208",r:"32",fill:"currentColor"}),o("circle",{cx:"152",cy:"311",r:"32",fill:"currentColor"}),o("circle",{cx:"224",cy:"144",r:"32",fill:"currentColor"}),o("circle",{cx:"256",cy:"367",r:"48",fill:"currentColor"}),o("circle",{cx:"328",cy:"144",r:"32",fill:"currentColor"})),ro=({align:t,list:i,switchToolbarActions:e,disabledTitle:n,bold:s,italic:r,strikethrough:l,underline:h,link:c,onExecCommand:d,toggleLink:u})=>{const f=()=>o("stylo-toolbar-separator",null);return o(a,null,o("stylo-toolbar-text",{disabledTitle:n,bold:"bold"===s,italic:"italic"===r,underline:"underline"===h,strikethrough:"strikethrough"===l,onExecCommand:t=>d(t)}),f(),(()=>{if(xt.state.toolbar.style.fontSize)return o(a,null,o("stylo-toolbar-button",{onAction:()=>e(Q.FONT_SIZE),label:Rt.state.toolbar.style_font_size},o("span",null,"A",o("small",null,"A"))),f())})(),(()=>{const t=[o("stylo-toolbar-button",{onAction:()=>e(Q.COLOR),label:Rt.state.toolbar.style_color},o(so,null))];return xt.state.toolbar.style.backgroundColor&&t.push(o("stylo-toolbar-button",{onAction:()=>e(Q.BACKGROUND_COLOR),label:Rt.state.toolbar.style_background},o(eo,null))),t})(),f(),(()=>{if(xt.state.toolbar.style.align)return o("stylo-toolbar-button",{onAction:()=>e(Q.ALIGNMENT),label:Rt.state.toolbar.style_align},o(t===q.LEFT?io:t===q.CENTER?to:oo,null))})(),o("stylo-toolbar-button",{onAction:()=>e(Q.LIST),label:Rt.state.toolbar.style_list},o(i===G.UNORDERED?Ni:Di,null)),(()=>{if(i||t)return f()})(),o("stylo-toolbar-button",{onAction:u,cssClass:c?"active":void 0,label:Rt.state.toolbar.link},o(no,null)))},ao=class{constructor(t){e(this,t),this.toolbarActivated=n(this,"toolbarActivated",7),this.linkCreated=n(this,"linkCreated",7),this.styleDidChange=n(this,"styleDidChange",7),this.debounceDisplayToolsActivated=et((()=>{this.displayToolsActivated=!0,this.toolbarActivated.emit(!0)})),this.selection=null,this.selectionParagraph=void 0,this.anchorLink=null,this.rtl=at(),this.onKeyDown=t=>{const{code:i}=t;["Escape"].includes(i)?this.reset(!1):this.styleKeyboardShortcuts(t)},this.startSelection=t=>{this.anchorEvent={$event:t,composedPath:t.composedPath()}},this.toggleLink=()=>{this.link?((t=>{const{range:i,selection:o}=Ht(t);if(!i)return;if(rt())return void(t=>{const i=m(t.anchorNode);i&&"a"===i.nodeName.toLowerCase()&&(i.parentElement.insertBefore(document.createTextNode(i.textContent),i),i.parentElement.removeChild(i))})(o);const e=m(o.anchorNode),n=i.extractContents();e.parentElement.replaceChild(n,e)})(this.containerRef),this.reset(!0)):this.openLink()},this.switchToolbarActions=t=>this.toolbarActions=t,this.onExecCommand=t=>{this.execCommand(t.detail)},this.config=void 0,this.containerRef=void 0,this.bold=void 0,this.italic=void 0,this.underline=void 0,this.strikethrough=void 0,this.align=void 0,this.list=void 0,this.fontSize=void 0,this.disabledTitle=!1,this.toolsActivated=!1,this.displayToolsActivated=!1,this.link=!1,this.toolbarActions=Q.STYLE,this.toolsPosition=void 0,this.onSelectionChange=this.onSelectionChange.bind(this)}componentWillLoad(){this.initDefaultContentAlign(),this.applyStandaloneConfig()}connectedCallback(){this.addListener()}disconnectedCallback(){this.removeListener()}onContainerRef(){this.containerRef&&(this.removeListener(),this.addListener())}onConfigChange(){this.applyStandaloneConfig()}applyStandaloneConfig(){this.config&&(xt.state.toolbar=Object.assign(Object.assign({},xt.state.toolbar),this.config))}styleKeyboardShortcuts(t){const{metaKey:i,ctrlKey:o,key:e}=t;if((i||o)&&["b","i","u","k"].includes(e))switch(t.preventDefault(),t.stopPropagation(),e){case"b":this.execCommand(Ui);break;case"i":this.execCommand($i);break;case"u":this.execCommand(Ki);break;case"k":this.openLink()}}onContextMenu(){this.reset(!1)}onSelectionChange(){[Q.COLOR,Q.BACKGROUND_COLOR,Q.LINK].includes(this.toolbarActions)||this.displayTools()}onResize(){Ot()||this.reset(!0)}onContainerClick(t){[Q.COLOR,Q.BACKGROUND_COLOR,Q.LINK].includes(this.toolbarActions)||t.preventDefault()}addListener(){const t=this.containerRef||document;null==t||t.addEventListener("mousedown",this.startSelection,{passive:!0}),null==t||t.addEventListener("touchstart",this.startSelection,{passive:!0}),null==t||t.addEventListener("keydown",this.onKeyDown)}removeListener(){const t=this.containerRef||document;null==t||t.removeEventListener("mousedown",this.startSelection),null==t||t.removeEventListener("touchstart",this.startSelection),null==t||t.removeEventListener("keydown",this.onKeyDown)}displayTools(){let t=Tt(this.containerRef);if(!this.anchorEvent)return void this.reset(!1);const{$event:i,composedPath:o}=this.anchorEvent;if(this.containerRef&&!this.containerRef.contains(i.target)&&!this.containerRef.contains(o[0]))return void this.reset(!1);if(!t||!t.toString()||t.toString().trim().length<=0)return void this.reset(!1);const e=this.activateToolbar(t);if(this.setToolsActivated(e),this.toolsActivated&&(this.selection=t,this.selectionParagraph=y({element:this.selection?this.selection.anchorNode:document.activeElement,container:this.containerRef}),t.rangeCount>0)){const i=t.getRangeAt(0);this.anchorLink={range:i.cloneRange()},this.setToolbarAnchorPosition()}}setToolbarAnchorPosition(){if(!this.tools)return;const{$event:t}=this.anchorEvent,i=ot(t).clientX,o=ot(t).clientY,{range:e}=Ht(this.containerRef),n=null==e?void 0:e.getBoundingClientRect(),s=n?n.x+n.width/2:i,r=n?n.y:o,{x:a,y:l}=this.el.shadowRoot.host.getBoundingClientRect(),h=s-a,c=r-l,d=o>100?"above":"under",{innerWidth:u}=window,f=this.tools.offsetWidth/2+32>h,p=u>0&&((null==n?void 0:n.left)||i)-40>u-(this.tools.offsetWidth/2+32);this.toolsPosition={top:"above"===d?c-16:c+((null==n?void 0:n.height)||0)+8,left:p?u-a-this.tools.offsetWidth-32+"px":f?"32px":`${h}px`,right:"auto",position:d,align:p?"end":f?"start":"center",anchorLeft:f?h-32:p?h-(u-32-this.tools.offsetWidth):this.tools.offsetWidth/2}}activateToolbar(t){const i=t&&t.toString()&&t.toString().length>0;return i&&(this.initStyle(t),this.initLink(t)),i}initStyle(t){if(!t||t.rangeCount<=0)return;const i=J(t);i&&this.initStyleForNode(i)}initStyleForNode(t){this.bold=void 0,this.italic=void 0,this.underline=void 0,this.strikethrough=void 0,this.list=void 0,this.fontSize=void 0,this.initDefaultContentAlign(),this.findStyle(t)}initDefaultContentAlign(){this.align=this.rtl?q.RIGHT:q.LEFT}findStyle(t){if(t&&!(t instanceof ShadowRoot)&&"HTML"!==t.nodeName.toUpperCase()&&"BODY"!==t.nodeName.toUpperCase()){var i;if(void 0===this.bold&&(this.bold=(i=m(t),Yi(i,"b")||Yi(i,"strong")||"bold"===i.style.fontWeight?"bold":"initial"===i.style.fontWeight?"initial":void 0)),void 0===this.italic&&(this.italic=(t=>{if(Yi(t,"i"))return"italic";if(Yi(t,"em"))return"italic";if("italic"===t.style.fontStyle)return"italic";if("initial"===t.style.fontStyle)return"initial";if(!t.hasChildNodes())return;const i=t.children;if(i&&i.length>0){const t=Array.from(i).find((t=>"italic"===t.style.fontStyle||"initial"===t.style.fontStyle));if(t)return"italic"===t.style.fontStyle?"italic":"initial"}})(m(t))),void 0===this.underline&&(this.underline=(t=>{var i,o,e,n,s;if(Yi(t,"u"))return"underline";if((null===(i=t.style.textDecoration)||void 0===i?void 0:i.indexOf("underline"))>-1||(null===(o=t.style.textDecorationLine)||void 0===o?void 0:o.indexOf("underline"))>-1)return"underline";if((null===(e=t.style.textDecoration)||void 0===e?void 0:e.indexOf("initial"))>-1||(null===(n=t.style.textDecorationLine)||void 0===n?void 0:n.indexOf("initial"))>-1)return"initial";if(!t.hasChildNodes())return;const r=t.children;if(r&&r.length>0){const t=Array.from(r).find((t=>{var i,o,e;return(null===(i=t.style.textDecoration)||void 0===i?void 0:i.indexOf("underline"))>-1||(null===(o=t.style.textDecorationLine)||void 0===o?void 0:o.indexOf("underline"))>-1||(null===(e=t.style.textDecorationLine)||void 0===e?void 0:e.indexOf("initial"))>-1}));if(t)return(null===(s=t.style.fontStyle)||void 0===s?void 0:s.indexOf("underline"))>-1?"underline":"initial"}})(m(t))),void 0===this.strikethrough&&(this.strikethrough=(t=>{var i,o,e,n,s;if(Yi(t,"strike"))return"strikethrough";if((null===(i=t.style.textDecoration)||void 0===i?void 0:i.indexOf("line-through"))>-1||(null===(o=t.style.textDecorationLine)||void 0===o?void 0:o.indexOf("line-through"))>-1)return"strikethrough";if((null===(e=t.style.textDecoration)||void 0===e?void 0:e.indexOf("initial"))>-1||(null===(n=t.style.textDecorationLine)||void 0===n?void 0:n.indexOf("initial"))>-1)return"initial";if(!t.hasChildNodes())return;const r=t.children;if(r&&r.length>0){const t=Array.from(r).find((t=>{var i,o,e;return(null===(i=t.style.textDecoration)||void 0===i?void 0:i.indexOf("line-through"))>-1||(null===(o=t.style.textDecorationLine)||void 0===o?void 0:o.indexOf("line-through"))>-1||(null===(e=t.style.textDecorationLine)||void 0===e?void 0:e.indexOf("initial"))>-1}));if(t)return(null===(s=t.style.fontStyle)||void 0===s?void 0:s.indexOf("line-through"))>-1?"strikethrough":"initial"}})(m(t))),void 0===this.list&&(this.list=(t=>{if(t)return t.nodeName&&"li"===t.nodeName.toLowerCase()&&t.parentElement&&t.parentElement.nodeName?"ol"===t.parentElement.nodeName.toLowerCase()?G.ORDERED:"ul"===t.parentElement.nodeName.toLowerCase()?G.UNORDERED:void 0:void 0})(m(t))),void 0===this.fontSize&&(this.fontSize=(t=>{if(t)return t.hasAttribute("size")?t.getAttribute("size"):""!==t.style.fontSize?X[t.style.fontSize.replace("-","_").toUpperCase()]:void 0})(m(t))),P({element:t,container:this.containerRef})){const i=t.nodeName.toUpperCase();return this.disabledTitle="H1"===i||"H2"===i||"H3"===i||"H4"===i||"H5"===i||"H6"===i,void(this.align=(t=>{const i=window.getComputedStyle(t);return"center"===i.textAlign?q.CENTER:"right"===i.textAlign?q.RIGHT:"left"===i.textAlign?q.LEFT:at()?q.RIGHT:q.LEFT})(m(t)))}this.findStyle(t.parentNode)}}initLink(t){if(!t)return;let i=t.anchorNode;i&&(3===i.nodeType&&(i=i.parentElement),this.link=i.nodeName&&"a"===i.nodeName.toLowerCase())}reset(t,i){t&&tt(),this.setToolsActivated(!1),t&&this.toolbarActivated.emit(!1),this.selection=null,this.selectionParagraph=null,this.toolbarActions=Q.STYLE,this.anchorLink=null,this.link=!1,i&&document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur()}openLink(){this.toolbarActions=Q.LINK}setToolsActivated(t){this.toolsActivated=t,t?this.debounceDisplayToolsActivated():this.displayToolsActivated=!1}execCommand(t){this.onAttributesChangesInitStyle(),"native"===xt.state.toolbar.command?(t=>{"style"===t.cmd?(t=>{const i=t.detail;switch(document.execCommand("styleWithCSS",!1,!0),i.style){case"color":document.execCommand("foreColor",!1,i.value);break;case"background-color":document.execCommand("backColor",!1,i.value);break;case"font-size":document.execCommand("fontSize",!1,X[i.value.replace("-","_").toUpperCase()]);break;case"font-weight":document.execCommand("bold",!1,null);break;case"font-style":document.execCommand("italic",!1,null);break;case"text-decoration":document.execCommand("line-through"===i.value?"strikeThrough":"underline",!1,null)}})(t):"list"===t.cmd&&(t=>{switch(t.detail.type){case"ol":document.execCommand("insertOrderedList",!1,null);break;case"ul":document.execCommand("insertUnorderedList",!1,null)}})(t)})(t):function(t,i,o){document&&t&&("style"===i.cmd?Xi(t,i.detail,o):"list"===i.cmd&&function(t,i,o){const e=t.anchorNode;if(!e)return;const n=m(y({element:e,container:o}));n&&(n.nodeName.toLowerCase()!==i.type?["ol","ul","dl"].includes(n.nodeName.toLowerCase())?(function(t,i,o){const e=document.createElement(o);e.append(...Array.from(t.childNodes)),Array.from(t.attributes).forEach((t=>e.setAttribute(t.nodeName,t.nodeValue))),t.parentElement.insertBefore(e,t),i.selectAllChildren(e)}(n,t,i.type),Fi(n,!1)):function(t,i,o){const e=i.getRangeAt(0),n=e.extractContents(),s=document.createElement(o),r=document.createElement("li");r.style.cssText=t.style.cssText,r.appendChild(n),s.appendChild(r),e.insertNode(s),i.selectAllChildren(s)}(n,t,i.type):Fi(n))}(t,i.detail,o))}(this.selection,t,this.containerRef);const{cmd:i}=t;("list"===i||st())&&this.reset(!0),this.selectionParagraph&&this.styleDidChange.emit(m(this.selectionParagraph))}onAttributesChangesInitStyle(){const t=J(this.selection);if(!t)return;const i=new MutationObserver((()=>{i.disconnect(),this.initStyleForNode(t)}));i.observe(t,{attributes:!0})}render(){var t,i;const e=(null===(t=this.toolsPosition)||void 0===t?void 0:t.position)||"above";return o("div",{class:this.displayToolsActivated?"tools tools-activated":"tools",ref:t=>this.tools=t,style:this.toolsPosition?{"--actions-top":`${this.toolsPosition.top}px`,"--actions-left":this.toolsPosition.left,"--actions-right":this.toolsPosition.right,"--actions-translate-x":"center"===this.toolsPosition.align?"-50%":"0","--actions-translate-y":"above"===this.toolsPosition.position?"-100%":"0"}:void 0,onClick:t=>t.stopPropagation(),onMouseDown:t=>this.onContainerClick(t),onTouchStart:t=>this.onContainerClick(t)},o("stylo-toolbar-triangle",{class:"above"===e?"bottom":"top",style:{"--stylo-toolbar-triangle-start":`${null===(i=this.toolsPosition)||void 0===i?void 0:i.anchorLeft}px`}}),this.renderActions())}renderActions(){return this.toolbarActions===Q.LINK?o("stylo-toolbar-link",{containerRef:this.containerRef,toolbarActions:this.toolbarActions,anchorLink:this.anchorLink,linkCreated:this.linkCreated,onLinkModified:t=>this.reset(t.detail),onClose:()=>this.reset(!1)}):this.toolbarActions===Q.COLOR||this.toolbarActions===Q.BACKGROUND_COLOR?o("stylo-toolbar-color",{containerRef:this.containerRef,action:this.toolbarActions===Q.BACKGROUND_COLOR?"background-color":"color",onExecCommand:this.onExecCommand,onClose:()=>this.reset(!1)}):this.toolbarActions===Q.ALIGNMENT?o("stylo-toolbar-align",{containerRef:this.containerRef,anchorEvent:this.anchorEvent.$event,align:this.align,onAlignModified:()=>this.reset(!0)}):this.toolbarActions===Q.LIST?o("stylo-toolbar-list",{list:this.list,onExecCommand:this.onExecCommand}):this.toolbarActions===Q.FONT_SIZE?o("stylo-toolbar-font-size",{fontSize:this.fontSize,onExecCommand:this.onExecCommand}):o(ro,{align:this.align,list:this.list,switchToolbarActions:this.switchToolbarActions,bold:this.bold,disabledTitle:this.disabledTitle,italic:this.italic,strikethrough:this.strikethrough,underline:this.underline,link:this.link,onExecCommand:this.onExecCommand,toggleLink:this.toggleLink})}get el(){return r(this)}static get watchers(){return{containerRef:["onContainerRef"],config:["onConfigChange"]}}};ao.style=":host{direction:ltr;position:absolute;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}div.tools{display:flex;justify-content:center;align-items:center;visibility:hidden;opacity:0;height:0;animation:0s ease 0s 1 normal none running none;transition:opacity 0.1s ease-out;position:absolute;top:var(--actions-top);left:var(--actions-left);right:var(--actions-right);transform:translate(var(--actions-translate-x), var(--actions-translate-y));z-index:var(--stylo-toolbar-zindex, 2);--box-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.12);box-shadow:var(--stylo-box-shadow, var(--box-shadow));border:var(--stylo-border);background:var(--stylo-background, var(--white));color:var(--stylo-color, var(--white-contrast));border-radius:var(--stylo-border, 4px);padding:var(--stylo-toolbar-padding, 0 8px);min-width:var(--stylo-toolbar-min-width, 280px)}div.tools.tools-activated{visibility:visible;opacity:1;height:unset;min-height:var(--stylo-toolbar-min-height, 44px)}";const lo=class{constructor(t){e(this,t),this.alignModified=n(this,"alignModified",7),this.anchorEvent=void 0,this.align=void 0,this.containerRef=void 0}justifyContent(t,i){t.stopPropagation(),"native"===xt.state.toolbar.command?(t=>{switch(t){case q.CENTER:document.execCommand("justifyCenter",!1,null);break;case q.RIGHT:document.execCommand("justifyRight",!1,null);break;default:document.execCommand("justifyLeft",!1,null)}})(i):((t,i,o)=>{const e=m(this.anchorEvent.target),n=m(y({element:e,container:i}));n&&(n.style.textAlign=(null==n?void 0:n.style.textAlign)===o?"":o)})(0,this.containerRef,i),this.alignModified.emit()}render(){return o(s,null,o("stylo-toolbar-button",{label:Rt.state.toolbar.align_left,onAction:t=>this.justifyContent(t.detail,q.LEFT),class:this.align===q.LEFT?"active":void 0},o(io,null)),o("stylo-toolbar-button",{label:Rt.state.toolbar.align_center,onAction:t=>this.justifyContent(t.detail,q.CENTER),class:this.align===q.CENTER?"active":void 0},o(to,null)),o("stylo-toolbar-button",{label:Rt.state.toolbar.align_right,onAction:t=>this.justifyContent(t.detail,q.RIGHT),class:this.align===q.RIGHT?"active":void 0},o(oo,null)))}};lo.style=":host{display:flex;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}stylo-toolbar-button.active{--stylo-toolbar-button-color:var(--stylo-toolbar-button-color-active, var(--highlight))}";const ho=class{constructor(t){e(this,t),this.action=n(this,"action",7),this.disableAction=!1,this.cssClass=void 0,this.label=void 0}render(){return o("button",{onMouseDown:t=>t.stopPropagation(),onTouchStart:t=>t.stopPropagation(),onClick:t=>{t.stopPropagation(),this.action.emit(t)},disabled:this.disableAction,class:this.cssClass,"aria-label":this.label},o("slot",null))}};ho.style=".host{--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}button{pointer-events:initial;cursor:pointer;margin:0;padding:4px 6px 6px;height:40px;z-index:var(--stylo-toolbar-button-zindex, 2);display:flex;justify-content:center;align-items:center;border:0;color:var(--stylo-toolbar-button-color, black);transition:0.1s background-color, 0.1s border-color, 0.1s fill;background:transparent;font-size:var(--stylo-toolbar-button-font-size, 1.4rem);font-family:var(--stylo-toolbar-button-font-family, inherit);-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;outline:0}button.active{color:var(--stylo-toolbar-button-color-active, var(--highlight))}button[disabled]{color:var(--stylo-toolbar-button-color-disabled, var(--light));display:var(--stylo-toolbar-button-display-disabled, none)}button.active>div{background-color:var(--stylo-toolbar-button-color-active, var(--highlight))}button[disabled]>div{background-color:var(--stylo-toolbar-button-color-disabled, var(--light))}::slotted(*){pointer-events:none}::slotted(svg){width:20px;height:20px;padding-bottom:2px}";const co=class{constructor(t){e(this,t),this.execCommand=n(this,"execCommand",7),this.close=n(this,"close",7),this.closeToolbar=()=>{this.close.emit()},this.action=void 0,this.containerRef=void 0,this.colorRgb=void 0}componentWillLoad(){this.initColor()}connectedCallback(){this.addListener()}disconnectedCallback(){this.removeListener()}addListener(){const t=this.containerRef||document;null==t||t.addEventListener("click",this.closeToolbar,{passive:!0})}removeListener(){const t=this.containerRef||document;null==t||t.removeEventListener("click",this.closeToolbar)}initColor(){const{range:t,selection:i}=Ht(this.containerRef);this.range=t;const o=J(i);if(!o)return;const e=Zi(o,"color"===this.action?"color":"background-color",this.containerRef);if(!e)return;const n=null===window||void 0===window?void 0:window.getComputedStyle(m(e));this.colorRgb=("color"===this.action?n.color:n.backgroundColor).replace("rgb(","").replace(")","")}selectColor(t){const i=Tt(this.containerRef);if(!i||!t||!t.detail)return;if(!this.action)return;null==i||i.removeAllRanges(),null==i||i.addRange(this.range);const o=new MutationObserver((()=>{o.disconnect(),this.range=null==i?void 0:i.getRangeAt(0)})),e=J(i);e&&(o.observe(e,{childList:!0}),this.execCommand.emit({cmd:"style",detail:{style:this.action,value:t.detail.hex,initial:i=>{const o=it(t.detail.hex);return i&&(i.style[this.action]===t.detail.hex||i.style[this.action]===`rgb(${o})`)}}}))}render(){return o("stylo-color",{"color-rgb":this.colorRgb,onColorChange:t=>this.selectColor(t),palette:xt.state.toolbar.palette})}};co.style=":host{padding:4px 0}:host stylo-color{pointer-events:all}";const uo=class{constructor(t){e(this,t),this.execCommand=n(this,"execCommand",7),this.fontSize=void 0}modifyFontSize(t,i){t.stopPropagation();const o=Object.keys(X).find((t=>X[t]===i));this.execCommand.emit({cmd:"style",detail:{style:"font-size",value:o.toLowerCase().replace("_","-"),initial:t=>t&&t.style["font-size"]===o.toLowerCase().replace("_","-")}}),this.fontSize=i}render(){return o(s,null,this.renderAction(X.X_SMALL),this.renderAction(X.SMALL),this.renderAction(X.MEDIUM),this.renderAction(X.LARGE),this.renderAction(X.X_LARGE),this.renderAction(X.XX_LARGE),this.renderAction(X.XXX_LARGE))}renderAction(t){return o("stylo-toolbar-button",{label:`${Rt.state.toolbar.font_size} ${t}`,onAction:i=>this.modifyFontSize(i.detail,t),class:this.fontSize===t?"active":void 0},o("span",null,t.toString()))}};uo.style=":host{--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff;display:flex}stylo-toolbar-button.active{--stylo-toolbar-button-color:var(--stylo-toolbar-button-color-active, var(--highlight))}stylo-toolbar-button:first-of-type{--stylo-toolbar-button-font-size:0.8rem}stylo-toolbar-button:nth-of-type(2){--stylo-toolbar-button-font-size:1rem}stylo-toolbar-button:nth-of-type(3){--stylo-toolbar-button-font-size:1.2rem}stylo-toolbar-button:nth-of-type(5){--stylo-toolbar-button-font-size:1.6rem}stylo-toolbar-button:nth-of-type(6){--stylo-toolbar-button-font-size:1.8rem}stylo-toolbar-button:nth-of-type(7){--stylo-toolbar-button-font-size:2rem}";const fo=class{constructor(t){e(this,t),this.linkModified=n(this,"linkModified",7),this.close=n(this,"close",7),this.closeToolbar=()=>{this.close.emit()},this.containerRef=void 0,this.toolbarActions=void 0,this.anchorLink=void 0,this.linkCreated=void 0}componentDidLoad(){setTimeout((()=>{var t;return null===(t=this.input)||void 0===t?void 0:t.focus()}),250)}connectedCallback(){this.addListener()}disconnectedCallback(){this.removeListener()}addListener(){const t=this.containerRef||document;null==t||t.addEventListener("click",this.closeToolbar,{passive:!0})}removeListener(){const t=this.containerRef||document;null==t||t.removeEventListener("click",this.closeToolbar)}handleLinkInput(t){this.linkUrl=t.target.value}createLink(){if(!this.anchorLink)return;const{range:t}=this.anchorLink;if(!t)return;if(!this.linkUrl||this.linkUrl.length<=0)return;(({range:t,linkUrl:i})=>{const o=(({fragment:t,linkUrl:i})=>{const o=Ai({linkUrl:i});return o.appendChild(t),o})({fragment:t.extractContents(),linkUrl:i});t.insertNode(o)})({range:t,linkUrl:this.linkUrl});const i=y({element:t.commonAncestorContainer,container:this.containerRef});i&&this.linkCreated.emit(m(i))}handleLinkEnter(t){t&&(this.toolbarActions!==Q.STYLE||"backspace"!==t.key.toLowerCase()&&"delete"!==t.key.toLowerCase()?this.toolbarActions===Q.LINK&&"enter"===t.key.toLowerCase()&&(this.createLink(),this.linkModified.emit(!0)):this.linkModified.emit(!1))}render(){return o(s,null,o("input",{ref:t=>this.input=t,placeholder:"Add a link...",onInput:t=>this.handleLinkInput(t),onKeyUp:t=>this.handleLinkEnter(t)}))}};fo.style=":host{width:100%;height:100%;z-index:var(--stylo-toolbar-link-zindex, 2)}:host input{pointer-events:visible;background:transparent;width:97%;height:100%;color:var(--stylo-toolbar-link-color, black);border:none;outline:0;font-size:16px}:host input::-moz-placeholder{color:var(--stylo-toolbar-link-placeholder-color, black)}:host input::placeholder{color:var(--stylo-toolbar-link-placeholder-color, black)}";const po=class{constructor(t){e(this,t),this.execCommand=n(this,"execCommand",7),this.list=void 0}toggleList(t,i){t.stopPropagation(),this.execCommand.emit({cmd:"list",detail:{type:i}})}render(){return o(s,null,o("stylo-toolbar-button",{label:Rt.state.toolbar.list_ol,onAction:t=>this.toggleList(t.detail,"ol"),class:this.list===G.ORDERED?"active":void 0},o(Di,null)),o("stylo-toolbar-button",{label:Rt.state.toolbar.list_ul,onAction:t=>this.toggleList(t.detail,"ul"),class:this.list===G.UNORDERED?"active":void 0},o(Ni,null)))}};po.style=":host{display:flex;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}stylo-toolbar-button.active{--stylo-toolbar-button-color:var(--stylo-toolbar-button-color-active, var(--highlight))}";const vo=class{constructor(t){e(this,t)}render(){return o("div",{class:"separator"})}};vo.style=":host{--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}div.separator{display:inline-block;vertical-align:middle;width:1px;min-width:1px;margin:0 6px;height:24px;background:var(--stylo-toolbar-separator-background, var(--light))}";const go=class{constructor(t){e(this,t),this.execCommand=n(this,"execCommand",7),this.disabledTitle=!1,this.bold=void 0,this.italic=void 0,this.underline=void 0,this.strikethrough=void 0}styleBold(t){t.stopPropagation(),this.execCommand.emit(Ui)}styleItalic(t){t.stopPropagation(),this.execCommand.emit($i)}styleUnderline(t){t.stopPropagation(),this.execCommand.emit(Ki)}styleStrikeThrough(t){t.stopPropagation(),this.execCommand.emit(Vi)}render(){return o(s,null,o("stylo-toolbar-button",{label:Rt.state.toolbar.bold,onAction:t=>this.styleBold(t.detail),disableAction:this.disabledTitle,cssClass:this.bold?"active":void 0,class:"bold"},o("span",null,"B")),o("stylo-toolbar-button",{label:Rt.state.toolbar.italic,onAction:t=>this.styleItalic(t.detail),cssClass:this.italic?"active":void 0,class:"italic"},o("span",null,"I")),o("stylo-toolbar-button",{label:Rt.state.toolbar.underline,onAction:t=>this.styleUnderline(t.detail),cssClass:this.underline?"active":void 0,class:this.underline?"active underline":"underline"},o("span",null,"U")),o("stylo-toolbar-button",{label:Rt.state.toolbar.strikethrough,onAction:t=>this.styleStrikeThrough(t.detail),cssClass:this.strikethrough?"active":void 0,class:"strikethrough"},o("span",{style:{"text-decoration":"line-through"}},"S")))}};go.style=":host{display:inline-flex;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}stylo-toolbar-button{margin:0 2px}stylo-toolbar-button.italic span{font-style:italic}stylo-toolbar-button.underline.active span{border-bottom:1px solid var(--stylo-toolbar-button-color-active, var(--highlight))}stylo-toolbar-button.underline span{border-bottom:1px solid var(--stylo-toolbar-button-color, black)}";const bo=class{constructor(t){e(this,t),this.mobile=void 0}render(){if(!this.mobile)return o("div",{class:"triangle"})}};bo.style=':host(.top) div.triangle{bottom:unset;top:-34px;transform:scale(0.7) translate(50%, 0)}div.triangle{z-index:1;position:absolute;bottom:-34px;left:var(--stylo-toolbar-triangle-start);width:40px;height:40px;overflow:hidden;transform:scale(0.7) rotate(180deg) translate(50%, 0)}div.triangle:after{content:"";position:absolute;width:24px;height:24px;background:white;transform:rotate(45deg);top:28px;left:8px;--box-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.12);box-shadow:var(--stylo-box-shadow, var(--box-shadow));border:var(--stylo-border)}';export{jt as stylo_add,Et as stylo_color,Bt as stylo_color_input,_i as stylo_editor,Ei as stylo_list,Bi as stylo_menus,Wi as stylo_plugins,ao as stylo_toolbar,lo as stylo_toolbar_align,ho as stylo_toolbar_button,co as stylo_toolbar_color,uo as stylo_toolbar_font_size,fo as stylo_toolbar_link,po as stylo_toolbar_list,vo as stylo_toolbar_separator,go as stylo_toolbar_text,bo as stylo_toolbar_triangle}