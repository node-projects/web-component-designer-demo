import{g as t,f as i,h as e,r as o,c as n,H as r,a as s,F as a}from"./p-22f3f94f.js";import{h as l,b as h,d as c,u as d,o as u,i as f,a as p,e as v,D as g,k as b,l as y,m,n as w,p as x,q as k,c as C,r as M,s as P,v as L,w as A,x as R,y as z,z as O,A as T,B as _,C as S,E as I,F as H,G as D,H as N,I as j,J as E,K as B,L as W,M as U,N as $,O as K,t as V,P as F,Q as Z,R as Y,j as X,g as q,f as G,S as J,T as Q,U as tt}from"./p-c88964d4.js";function it(t){if(!t||void 0===t||""===t)return;let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?`${parseInt(i[1],16)}, ${parseInt(i[2],16)}, ${parseInt(i[3],16)}`:void 0}function et(t){return t.changedTouches?t.changedTouches[0]:t}function ot(t,i){let e;return(...o)=>{e&&clearTimeout(e),e=setTimeout((()=>t(...o)),i&&i>0?i:300)}}function nt(){if(!window)return!1;let t=window.matchMedia("(any-pointer:coarse)").matches,i=window.matchMedia("(any-pointer:fine)").matches;return t&&!i}function rt(){if(!window||!navigator)return!1;let t=lt();return/iPhone|iPod/i.test(t)||function(){if(!window||!navigator)return!1;let t=lt();return!!/iPad/i.test(t)||/Macintosh/i.test(t)&&nt()}()}function st(){if(!window||!navigator)return!1;let t=lt();return/firefox/i.test(t)}function at(){let t=document.documentElement.getAttribute("dir");return null!==t&&"rtl"===t}var lt=()=>navigator.userAgent||navigator.vendor||window.opera;const ht=t=>!("isConnected"in t)||t.isConnected,ct=(()=>{let t;return(...i)=>{t&&clearTimeout(t),t=setTimeout((()=>{t=0,(t=>{for(let i of t.keys())t.set(i,t.get(i).filter(ht))})(...i)}),2e3)}})(),dt=t=>"function"==typeof t?t():t,ut=(e,o)=>{const n=((t,i=((t,i)=>t!==i))=>{const e=dt(t);let o=new Map(Object.entries(null!=e?e:{}));const n={dispose:[],get:[],set:[],reset:[]},r=()=>{var i;o=new Map(Object.entries(null!==(i=dt(t))&&void 0!==i?i:{})),n.reset.forEach((t=>t()))},s=t=>(n.get.forEach((i=>i(t))),o.get(t)),a=(t,e)=>{const r=o.get(t);i(e,r,t)&&(o.set(t,e),n.set.forEach((i=>i(t,e,r))))},l="undefined"==typeof Proxy?{}:new Proxy(e,{get:(t,i)=>s(i),ownKeys:()=>Array.from(o.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(t,i)=>o.has(i),set:(t,i,e)=>(a(i,e),!0)}),h=(t,i)=>(n[t].push(i),()=>{((t,i)=>{const e=t.indexOf(i);e>=0&&(t[e]=t[t.length-1],t.length--)})(n[t],i)});return{state:l,get:s,set:a,on:h,onChange:(i,e)=>{const o=h("set",((t,o)=>{t===i&&e(o)})),n=h("reset",(()=>e(dt(t)[i])));return()=>{o(),n()}},use:(...t)=>{const i=t.reduce(((t,i)=>(i.set&&t.push(h("set",i.set)),i.get&&t.push(h("get",i.get)),i.reset&&t.push(h("reset",i.reset)),i.dispose&&t.push(h("dispose",i.dispose)),t)),[]);return()=>i.forEach((t=>t()))},dispose:()=>{n.dispose.forEach((t=>t())),r()},reset:r,forceUpdate:t=>{const i=o.get(t);n.set.forEach((e=>e(t,i,i)))}}})(e,o);return n.use((()=>{if("function"!=typeof t)return{};const e=new Map;return{dispose:()=>e.clear(),get:i=>{const o=t();o&&((t,i,e)=>{const o=t.get(i);o?o.includes(e)||o.push(e):t.set(i,[e])})(e,i,o)},set:t=>{const o=e.get(t);o&&e.set(t,o.filter(i)),ct(e)},reset:()=>{e.forEach((t=>t.forEach(i))),ct(e)}}})()),n},ft=[l,h,c,d,u,f,p,v],pt={palette:g,command:"native",style:{list:!1,align:!0,fontSize:!0,backgroundColor:!0}},vt=["div","p","span"],gt=["h1","h2","h3","div","p"],bt=["placeholder","class","spellcheck","contenteditable","data-gramm","data-gramm_id","data-gramm_editor","data-gr-id","autocomplete"],yt={paragraphIdentifier:"paragraph_id",exclude:[...bt,"paragraph_id"]},{state:mt,onChange:wt}=ut({plugins:ft,toolbar:pt,placeholders:vt,textParagraphs:gt,menus:void 0,attributes:yt}),xt={state:mt,onChange:wt},{state:kt,onChange:Ct}=ut({ref:void 0,size:void 0}),Mt={state:kt,onChange:Ct},Pt={lang:"en",plugins:{huge_title:"Huge title",large_title:"Large title",small_title:"Small title",paragraph:"Paragraph",separator:"Separator",unordered_list:"Bulleted list",ordered_list:"Numbered list",image:"Image",code:"Code",no_matches:"No matches"},add:{placeholder:'Press "/" for plugins',add_element:"Add a new part"},toolbar:{align_left:"Align left",align_center:"Align center",align_right:"Align right",font_size:"Font size",list_ol:"Ordered list",list_ul:"Unordered list",style_list:"Style list",style_align:"Style alignment",style_font_size:"Style font size",style_color:"Style color",style_background:"Style background",link:"Create or remove link",bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough"},menus:{img_width_original:"Original image width",img_width_large:"Large image width",img_width_medium:"Medium image width",img_width_small:"Small image width",img_delete:"Delete image"}},{state:Lt,onChange:At}=ut(Pt);At("lang",(async t=>{let i;switch(t){case"es":i=await(async()=>{const{es:t}=await import("./p-5459b041.js");return t})();break;case"de":i=await(async()=>{const{de:t}=await import("./p-894cd2c1.js");return t})();break;case"nl":i=await(async()=>{const{nl:t}=await import("./p-b371caa3.js");return t})();break;case"ja":i=await(async()=>{const{ja:t}=await import("./p-289bfdf4.js");return t})();break;default:i=Pt}Object.assign(Lt,Object.assign({custom:Lt.custom},i))}));const Rt={state:Lt},zt=({code:t,keyCode:i})=>["Enter"].includes(t)&&229!==i,Ot=()=>nt()||(()=>{if(!window)return!1;let t=lt();return/android|sink/i.test(t)})()||rt(),Tt=t=>_t(t)&&St(t)?It(t):b(),_t=t=>(null==t?void 0:t.getRootNode())instanceof ShadowRoot,St=t=>(null==t?void 0:t.getRootNode()).getSelection,It=t=>t.getRootNode().getSelection(),Ht=t=>{const i=Tt(t);return!i||i.rangeCount<=0?{range:null,selection:null}:{selection:i,range:i.getRangeAt(0)}},Dt=t=>{const{startOffset:i,endOffset:e}=t;i!==e&&t.extractContents()},Nt=()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288M400 256H112"})),jt=class{constructor(t){o(this,t),this.selectParagraph=n(this,"selectParagraph",7),this.listPlugins=n(this,"listPlugins",7),this.hidePlugins=n(this,"hidePlugins",7),this.debouncePlaceholder=ot((()=>this.addPlaceholder()),350),this.onKeyDown=t=>{const{code:i}=t;["ArrowDown","ArrowUp"].includes(i)||zt(t)||this.removePlaceholder(),["Backspace","Delete"].includes(i)&&this.displayOnMutations()},this.onFocusout=()=>{rt()&&(this.top=void 0)},this.initParagraph=({target:t,onlyIfEmptyParagraph:i})=>{if(!t)return void this.hide();const e=y({element:t,container:Mt.state.ref});this.paragraph=m(e),!this.paragraph||i&&!w({paragraph:this.paragraph})?this.hide():(this.top=this.paragraph.offsetTop,this.editPlaceholder(),this.selectParagraph.emit(this.paragraph))}}componentDidLoad(){null===window||void 0===window||window.addEventListener("resize",(()=>this.hide())),null===document||void 0===document||document.addEventListener("focusout",this.onFocusout),this.destroyListener=Mt.onChange("ref",(()=>{this.removeContainerListener(),this.addContainerListener()})),this.addContainerListener()}disconnectedCallback(){var t;null===window||void 0===window||window.removeEventListener("resize",(()=>this.hide())),null===document||void 0===document||document.removeEventListener("focusout",this.onFocusout),this.removeContainerListener(),null===(t=this.destroyListener)||void 0===t||t.call(this)}addContainerListener(){var t;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("keydown",this.onKeyDown,{passive:!0})}removeContainerListener(){var t;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("keydown",this.onKeyDown)}onKeyUp(t){const{code:i}=t;["ArrowDown","ArrowUp","Backspace","Delete"].includes(i)||zt(t)?["ArrowDown","ArrowUp"].includes(i)&&this.display({onlyIfEmptyParagraph:!1}):void 0!==this.top&&this.hide()}onBeforeInput({data:t}){["/"].includes(t)?this.paragraph&&this.paragraph.isConnected&&(w({paragraph:this.paragraph})?this.focusListPlugins():this.hidePlugins.emit()):this.hidePlugins.emit()}onClick({target:t}){var i;this.display({onlyIfEmptyParagraph:!1,target:(null===(i=Mt.state.ref)||void 0===i?void 0:i.isEqualNode(t))?void 0:t})}onAddParagraphs({detail:t}){this.initParagraph({target:t[0],onlyIfEmptyParagraph:!1})}hide(){this.selectParagraph.emit(void 0),Ot()||(this.top=void 0)}display({onlyIfEmptyParagraph:t,target:i}){var e;this.initParagraph({target:null!=i?i:null===(e=Tt(Mt.state.ref))||void 0===e?void 0:e.anchorNode,onlyIfEmptyParagraph:t})}displayOnMutations(){new MutationObserver(((t,i)=>{i.disconnect(),this.display({onlyIfEmptyParagraph:!0})})).observe(Mt.state.ref,{childList:!0,subtree:!0,characterData:!0})}editPlaceholder(){this.removePlaceholder(),this.debouncePlaceholder()}addPlaceholder(){var t;if(!w({paragraph:this.paragraph}))return;if(x({paragraph:this.paragraph}))return;if(!xt.state.placeholders.includes(null===(t=this.paragraph)||void 0===t?void 0:t.nodeName.toLowerCase()))return;const i=window.getComputedStyle(this.paragraph,":before"),e=window.getComputedStyle(this.paragraph,":after"),o=['""',"none"];o.includes(i.getPropertyValue("content"))&&o.includes(e.getPropertyValue("content"))&&this.paragraph.setAttribute("placeholder",Rt.state.add.placeholder)}removePlaceholder(){var t;const i=null===(t=Mt.state.ref)||void 0===t?void 0:t.querySelectorAll("[placeholder]");null==i||i.forEach((t=>t.removeAttribute("placeholder")))}selectPlugins(t){if(!this.paragraph||!Mt.state.ref)return;if(t.stopPropagation(),w({paragraph:this.paragraph})&&!x({paragraph:this.paragraph}))return void this.focusListPlugins();k({paragraph:this.paragraph}),new MutationObserver(((t,i)=>{i.disconnect();const e=t.reduce(((t,{addedNodes:i})=>[...t,...Array.from(i)]),[]).find((t=>"div"===t.nodeName.toLowerCase()));M(e),this.listPlugins.emit(e)})).observe(Mt.state.ref,{childList:!0,subtree:!0});const i=C({nodeName:"div"});this.paragraph.after(i),this.hide()}focusListPlugins(){k({paragraph:this.paragraph}),this.listPlugins.emit(this.paragraph)}render(){return e(r,{style:void 0===this.top?{display:"none"}:{"--actions-top":`${this.top}px`}},e("button",{type:"button","aria-label":Rt.state.add.add_element,onClick:t=>this.selectPlugins(t),onKeyDown:t=>t.stopPropagation(),onMouseDown:t=>t.stopPropagation(),onTouchStart:t=>t.stopPropagation()},e(Nt,null)))}};jt.style=":host{display:block;position:absolute;top:var(--actions-top);left:var(--stylo-add-left, 8px);transition:top 0.1s ease;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}button{display:flex;position:relative;isolation:isolate;overflow:hidden;background:transparent;border:none;outline:none;cursor:pointer;transition:color 0.25s ease-out, background 0.25s ease-out, transform 0.15s ease-out;flex-direction:column;justify-content:center;align-items:center;border-radius:50%;width:1.4rem;height:1.4rem;color:var(--stylo-add-color, var(--medium))}button:active{box-shadow:none;transform:translateX(1px) translateY(1px)}button:hover,button:focus{color:var(--light-contrast)}svg{width:1.2rem;height:1.2rem}";const Et=class{constructor(t){o(this,t),this.colorChange=n(this,"colorChange",7),this.palette=g,this.inputAlt="Input a color (hex)",this.selectedColorPalette=!1,this.debounceInitSelectedColorPalette=ot((()=>{this.selectedColorPalette=this.initSelectedColorPalette(),this.selectedCustomColorRgb=this.selectedColorPalette?void 0:this.selectedColorRgb}),150),this.selectColor=t=>{const i=t.detail;this.applyColorHexChange(i.hex,i.rgb),this.colorChange.emit(i)}}componentWillLoad(){this.selectedColorHex=this.colorHex,this.selectedColorRgb=this.colorRgb?this.colorRgb:it(this.colorHex),this.selectedColorPalette=this.initSelectedColorPalette(),this.selectedColorPalette||(this.selectedCustomColorRgb=this.selectedColorRgb)}async onColorHexChange(){this.applyColorHexChange(this.colorHex,void 0)}applyColorHexChange(t,i){this.selectedColorHex=t,this.selectedColorRgb=i,this.debounceInitSelectedColorPalette(),this.palette=[...this.palette]}async onColorRgbChange(){this.selectedColorHex=void 0,this.selectedColorRgb=this.colorRgb,this.debounceInitSelectedColorPalette(),this.palette=[...this.palette]}pickColor(t){!this.palette||this.palette.length<=0||(this.selectedColorHex=t.color?t.color.hex:void 0,this.selectedColorRgb=t.color?t.color.rgb:void 0,this.colorChange.emit(t.color),this.selectedColorPalette=!0,this.selectedCustomColorRgb=void 0)}isHexColorSelected(t){return!!(t&&t.color&&t.color.hex)&&!!this.selectedColorHex&&this.selectedColorHex.toUpperCase()===t.color.hex.toUpperCase()}isRgbColorSelected(t){return!!(t&&t.color&&t.color.rgb)&&!!this.selectedColorRgb&&this.selectedColorRgb.replace(/\s/g,"").toUpperCase()===t.color.rgb.replace(/\s/g,"").toUpperCase()}initSelectedColorPalette(){return!(!this.palette||this.palette.length<=0)&&this.palette.findIndex((t=>this.isHexColorSelected(t)||this.isRgbColorSelected(t)))>-1}render(){return e(r,null,this.renderPalette(),this.renderInput())}renderPalette(){return this.palette&&this.palette.length>0?this.palette.map((t=>{const i={"--stylo-palette-color-hex":`${t.color.hex}`,"--stylo-palette-color-rgb":`${t.color.rgb}`};return t.display&&(i["--stylo-palette-border-color"]=t.display.borderColor,i["--stylo-palette-box-shadow-color"]=t.display.boxShadowColor),e("button",{"aria-label":t.alt,class:this.isHexColorSelected(t)||this.isRgbColorSelected(t)?"selected":void 0,style:i,onClick:i=>{i.stopPropagation(),this.pickColor(t)}})})):void 0}renderInput(){return e("stylo-color-input",{colorHex:this.selectedColorHex,colorRgb:this.selectedColorRgb,customColorRgb:this.selectedCustomColorRgb,inputAlt:this.inputAlt,onSelectHexColor:this.selectColor})}get el(){return s(this)}static get watchers(){return{colorHex:["onColorHexChange"],colorRgb:["onColorRgbChange"]}}};Et.style=":host{display:flex;align-items:center;justify-content:center;flex-wrap:var(--stylo-color-flex-wrap, wrap);overflow:var(--stylo-color-overflow, visible);padding:var(--stylo-color-padding, 8px);width:var(--stylo-color-width, 298px)}button{width:var(--stylo-color-button-width, 28px);height:var(--stylo-color-button-height, 28px);margin:var(--stylo-color-button-margin, 4px);padding:0;outline:var(--stylo-color-button-outline, none);cursor:pointer;border:1px solid var(--stylo-palette-border-color, var(--stylo-palette-color-hex));border-radius:var(--stylo-color-button-border-radius, 2px);background:var(--stylo-palette-color-hex)}button.selected{box-shadow:0 0 4px 4px rgba(var(--stylo-palette-box-shadow-color, var(--stylo-palette-color-rgb)), 0.4)}button:not(.selected):hover,button:not(.selected):focus{box-shadow:0 0 2px 2px rgba(var(--stylo-palette-box-shadow-color, var(--stylo-palette-color-rgb)), 0.4)}";const Bt=class{constructor(t){o(this,t),this.selectHexColor=n(this,"selectHexColor",7),this.debounceSelectColor=ot((t=>this.emitColor(t)),500)}async componentWillLoad(){this.color=this.initColorHex()}async watchColors(){this.color=this.initColorHex()}initColorHex(){return this.colorHex?this.colorHex:(t=this.customColorRgb?this.customColorRgb:this.colorRgb)?(t=>{if(t)return`#${t.map((t=>t.toString(16).padStart(2,"0"))).join("")}`})(function(t){let i=t.match(/([.\d]+),\s*([.\d]+),\s*([.\d]+)/);if(i)return i.splice(1,3).map((t=>Number(t)))}(t)):void 0;var t}emitColor(t){const i=`#${t.replace("#","")}`,e=it(i);e&&this.selectHexColor.emit({hex:i,rgb:e})}render(){var t;return e(r,null,e("span",null,"#"),e("input",{type:"text",name:"color-picker","aria-label":this.inputAlt,onInput:t=>this.debounceSelectColor(t.target.value),value:null===(t=this.color)||void 0===t?void 0:t.replace("#","")}))}static get watchers(){return{colorHex:["watchColors"],colorRgb:["watchColors"],customColorRgb:["watchColors"]}}};Bt.style=":host{display:flex;position:relative;margin:var(--stylo-color-input-margin, 4px);border-radius:var(--stylo-color-input-container-border-radius);border:var(--stylo-color-input-container-border)}span{width:var(--stylo-color-hash-width, 28px);height:var(--stylo-color-hash-height, 28px);display:inline-flex;justify-content:center;align-items:center;background:var(--stylo-color-hash-background, #f0f0f0 none repeat scroll 0 0);color:var(--stylo-color-hash-color, #98a1a4);border-radius:var(--stylo-color-hash-border-radius, 4px 0 0 4px)}input{color:var(--stylo-color-input-color, #666666);background:var(--stylo-color-input-background, inherit);border:none;outline:none;height:var(--stylo-color-input-height, 28px);box-shadow:var(--stylo-color-input-box-shadow, #f0f0f0 0 0 0 1px inset);border-radius:var(--stylo-color-input-border-radius, 0 4px 4px 0);padding:var(--stylo-color-input-padding, 0 4px);max-width:var(--stylo-color-input-max-width, 136px);font-family:var(--stylo-color-input-font-family, inherit)}";const Wt=({editorRef:t,message:i,detail:e})=>{const o=new CustomEvent(i,{detail:e,bubbles:!0});null==t||t.dispatchEvent(o)},Ut=({mutations:t,container:i})=>{if(!t||t.length<=0)return[];const e=t.filter((({addedNodes:t})=>(null==t?void 0:t.length)>0)).reduce(((t,{addedNodes:i})=>[...t,...Array.from(i)]),[]);return Zt({nodes:e,container:i})},$t=({mutations:t,container:i})=>t.filter((({addedNodes:t})=>(null==t?void 0:t.length)>0)).filter((({addedNodes:t})=>!P({element:t[0],container:i}))).filter((({addedNodes:t})=>!w({paragraph:y({element:t[0],container:i})}))),Kt=({mutations:t,paragraphIdentifier:i})=>t.filter((({removedNodes:t})=>(null==t?void 0:t.length)>0)).filter((({removedNodes:t})=>!(({removedNodes:t,paragraphIdentifier:i})=>void 0!==Array.from(t).find((t=>{var e;return!L(t)&&(null===(e=m(t))||void 0===e?void 0:e.hasAttribute(i))})))({removedNodes:t,paragraphIdentifier:i}))),Vt=({previousSibling:t,container:i})=>{if(t&&!i.isEqualNode(t))return L(t)?Vt({previousSibling:t.previousSibling,container:i}):t},Ft=({mutations:t,container:i})=>{if(!t||t.length<=0)return[];const e=t.reduce(((t,{target:i})=>[...t,i]),[]);return[...new Set(e.map((t=>y({element:t,container:i}))).filter((t=>void 0!==t&&(null==t?void 0:t.nodeType)!==Node.TEXT_NODE&&(null==t?void 0:t.nodeType)!==Node.COMMENT_NODE)))]},Zt=({nodes:t,container:i})=>t.filter((t=>P({element:t,container:i}))).filter((t=>(null==t?void 0:t.nodeType)!==Node.TEXT_NODE&&(null==t?void 0:t.nodeType)!==Node.COMMENT_NODE)),Yt=({nodes:t,paragraphIdentifier:i})=>t.filter((t=>!L(t))).map((t=>t)).filter((t=>null==t?void 0:t.hasAttribute(i))),Xt=({mutations:t,excludeAttributes:i})=>{const e=t.filter((({attributeName:t})=>null!==t));return void 0!==e.find((({attributeName:t})=>i.includes(t)))?[]:e};class qt{constructor(){this.stackDataMutations=[],this.debounceUpdateInput=ot((()=>this.updateData()),500),this.onTreeMutation=async t=>{const i=await this.addParagraphs(t);this.deleteParagraphs(t),this.updateAddedNodesParagraphs({addedParagraphs:i,mutations:t})},this.onAttributesMutation=t=>{this.updateParagraphs({mutations:Xt({mutations:t,excludeAttributes:xt.state.attributes.exclude})})},this.onDataMutation=t=>{this.stackDataMutations.push(...t),this.debounceUpdateInput()}}init({editorRef:t}){this.editorRef=t,this.treeObserver=new MutationObserver(this.onTreeMutation),this.treeObserver.observe(Mt.state.ref,{childList:!0,subtree:!0}),this.attributesObserver=new MutationObserver(this.onAttributesMutation),this.attributesObserver.observe(Mt.state.ref,{attributes:!0,subtree:!0}),this.dataObserver=new MutationObserver(this.onDataMutation),this.dataObserver.observe(Mt.state.ref,{characterData:!0,subtree:!0})}destroy(){var t,i,e;null===(t=this.treeObserver)||void 0===t||t.disconnect(),null===(i=this.attributesObserver)||void 0===i||i.disconnect(),null===(e=this.dataObserver)||void 0===e||e.disconnect()}async addParagraphs(t){if(!Mt.state.ref)return[];const i=Ut({mutations:t,container:Mt.state.ref});return i.length<=0?[]:(await Promise.all(i.map((t=>A({paragraph:t,attributeName:xt.state.attributes.paragraphIdentifier})))),(({editorRef:t,addedParagraphs:i})=>{Wt({editorRef:t,detail:i,message:"addParagraphs"})})({editorRef:this.editorRef,addedParagraphs:i}),i)}deleteParagraphs(t){if(!Mt.state.ref)return;if(!t||t.length<=0)return;const i=t.reduce(((t,{addedNodes:i})=>[...t,...Array.from(i)]),[]),e=t.reduce(((t,{removedNodes:i})=>[...t,...Array.from(i)]),[]).filter((t=>!L(t))).filter((t=>void 0===i.find((i=>i.isEqualNode(t))))).map((t=>m(t))).filter((t=>null==t?void 0:t.hasAttribute(xt.state.attributes.paragraphIdentifier)));e.length<=0||(({editorRef:t,removedParagraphs:i})=>{Wt({editorRef:t,detail:i,message:"deleteParagraphs"})})({editorRef:this.editorRef,removedParagraphs:e})}updateAddedNodesParagraphs({mutations:t,addedParagraphs:i}){if(!Mt.state.ref)return;if(!t||t.length<=0)return;const e=$t({mutations:t,container:Mt.state.ref}),o=Kt({mutations:t,paragraphIdentifier:xt.state.attributes.paragraphIdentifier});this.updateParagraphs({mutations:[...e,...o],addedParagraphs:i})}updateData(){if(!this.stackDataMutations||this.stackDataMutations.length<=0)return;const t=[...this.stackDataMutations];this.stackDataMutations=[],this.updateParagraphs({mutations:t})}updateParagraphs({mutations:t,addedParagraphs:i=[]}){if(!Mt.state.ref)return;const e=Ft({mutations:t,container:Mt.state.ref});if(e.length<=0)return;const o=e.filter((t=>!(t=>void 0!==i.find((i=>i.isSameNode(t))))(t)));o.length<=0||(({editorRef:t,updatedParagraphs:i})=>{Wt({editorRef:t,detail:i,message:"updateParagraphs"})})({editorRef:this.editorRef,updatedParagraphs:o})}}const{state:Gt,onChange:Jt,reset:Qt}=ut({undo:void 0,redo:void 0,observe:!0}),ti={state:Gt,onChange:Jt,reset:Qt},ii=t=>{const{range:i,selection:e}=Ht();if(!i)return;const{anchorNode:o,focusNode:n}=e,r=m(y({element:o,container:t})),s=m(y({element:n,container:t}));return r&&s?{startIndex:R(r),startIndexDepths:z({target:o,paragraph:y({element:o,container:t})}),startOffset:e.anchorOffset,endIndex:R(s),endIndexDepths:z({target:n,paragraph:y({element:n,container:t})}),endOffset:e.focusOffset,reverse:!o.isEqualNode(i.startContainer)}:void 0},ei=({container:t,addRemoveParagraphs:i,updateParagraphs:e,selection:o})=>{if(i.length<=0&&e.length<=0)return;ti.state.undo||(ti.state.undo=[]);const n={changes:[{type:"paragraph",target:t,data:i.map((({outerHTML:t,index:i,mutation:e})=>({outerHTML:t,mutation:e,index:i})))},{type:"update",target:t,data:e}],selection:o};ti.state.undo.push(n),ti.state.redo=[]},oi=()=>ri(ti.state.undo),ni=()=>ri(ti.state.redo),ri=t=>{if(t)return t[t.length-1]},si=async()=>li({popFrom:()=>ti.state.undo=[...ti.state.undo.slice(0,ti.state.undo.length-1)],pushTo:t=>ti.state.redo.push(t),undoChanges:oi()}),ai=async()=>li({popFrom:()=>ti.state.redo=[...ti.state.redo.slice(0,ti.state.redo.length-1)],pushTo:t=>ti.state.undo.push(t),undoChanges:ni()}),li=async({popFrom:t,pushTo:i,undoChanges:e})=>{if(!e)return;const o=ii(Mt.state.ref),{changes:n,selection:r}=e;let s=[];for(const t of n)s=[await hi({undoChange:t}),...s];(({selection:t,container:i})=>{if(!t)return;const{startIndex:e,startIndexDepths:o,startOffset:n,endIndex:r,endIndexDepths:s,endOffset:a,reverse:l}=t,h=i.children[Math.min(e,i.children.length-1)],c=i.children[Math.min(r,i.children.length-1)],d=O({parent:h,indexDepths:o}),u=O({parent:c,indexDepths:s});if(!d||!u)return;if(d.textContent.length<n||u.textContent.length<a)return;const f=document.createRange();l?(f.setEnd(d,n),f.setStart(u,a)):(f.setStart(d,n),f.setEnd(u,a));const p=Tt(i);null==p||p.removeAllRanges(),null==p||p.addRange(f),f.detach()})({container:Mt.state.ref,selection:r}),i({changes:s,selection:o}),t()},hi=async({undoChange:t})=>{const{type:i}=t;return"input"===i?ci({undoChange:t}):"paragraph"===i?di({undoChange:t}):ui({undoChange:t})},ci=async({undoChange:t})=>{var i;const{data:e,target:o}=t,n=m(o),{oldValue:r,offset:s,index:a,indexDepths:l}=e,h=n.children[a];let c=O({parent:h,indexDepths:l});if(!c||!L(c)){const t=[...l];t.pop();let e=t.length<=0?c?c.parentNode:void 0:O({parent:h,indexDepths:[...t]});!e&&L(null===(i=m(h))||void 0===i?void 0:i.lastChild)&&(c=m(h).lastChild),c||(e||(e=await yi({paragraph:m(h)||n,container:n})),c=await gi({parent:m(e),container:n}))}const{previousValue:d}=await bi({text:c,oldValue:r,container:n});return T({element:c,offset:Math.max(Math.min(r.length>s?s:r.length,c.nodeValue.length),0)}),{type:"input",target:n,data:{index:a,indexDepths:z({target:null!=c?c:o,paragraph:h}),oldValue:d,offset:s+(d.length-r.length)}}},di=async({undoChange:t})=>{const{data:i,target:e}=t,o=m(e),n=i;let r=[];for(const t of n){const{index:i,outerHTML:e,mutation:n}=t;"add"===n&&(await pi({container:o,index:i}),r=[{outerHTML:e,index:i,mutation:"remove"},...r]),"remove"===n&&(await fi({container:o,index:i,outerHTML:e}),r=[{outerHTML:e,mutation:"add",index:i},...r])}return Object.assign(Object.assign({},t),{data:r})},ui=async({undoChange:t})=>{const{data:i,target:e}=t,o=i,n=m(e),r=[];for(const t of o){const{index:i,outerHTML:e}=t,{previousOuterHTML:o}=await vi({container:n,index:i,outerHTML:e});r.push({index:i,outerHTML:o})}return Object.assign(Object.assign({},t),{data:r})},fi=({container:t,index:i,outerHTML:e})=>new Promise((o=>{const n=new MutationObserver((()=>{n.disconnect(),o()}));n.observe(t,{childList:!0,subtree:!0});const r=i-1;-1!==r?t.children[Math.min(r,t.children.length-1)].insertAdjacentHTML("afterend",e):t.insertAdjacentHTML("afterbegin",e)})),pi=({container:t,index:i})=>new Promise((e=>{const o=new MutationObserver((()=>{o.disconnect(),e()}));o.observe(t,{childList:!0,subtree:!0});const n=t.children[Math.min(i,t.children.length-1)];null==n||n.parentElement.removeChild(n)})),vi=({container:t,index:i,outerHTML:e})=>new Promise((o=>{const n=t.children[Math.min(i,t.children.length-1)],r=n.outerHTML,s=new MutationObserver((()=>{s.disconnect(),o({previousOuterHTML:r})}));s.observe(t,{childList:!0,subtree:!0}),n.outerHTML=e})),gi=({parent:t,container:i})=>new Promise((e=>{const o=document.createTextNode(""),n=new MutationObserver((()=>{n.disconnect(),e(o)}));n.observe(i,{childList:!0,subtree:!0}),t.prepend(o)})),bi=({container:t,oldValue:i,text:e})=>new Promise((o=>{const n=e.nodeValue,r=new MutationObserver((()=>{r.disconnect(),o({previousValue:n})}));r.observe(t,{characterData:!0,subtree:!0}),e.nodeValue=i})),yi=({container:t,paragraph:i})=>new Promise((e=>{var o;const n="br"!==(null===(o=i.lastElementChild)||void 0===o?void 0:o.nodeName.toLowerCase())?m(i.lastElementChild):document.createElement("span"),r=m(n.cloneNode());r.innerHTML="";const s=new MutationObserver((()=>{s.disconnect(),e(r)}));s.observe(t,{childList:!0,subtree:!0}),n.after(r)}));class mi{constructor(){this.onKeyDown=async t=>{zt(t)&&await this.createParagraph(t)}}init(){var t;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("keydown",this.onKeyDown)}destroy(){var t;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("keydown",this.onKeyDown)}async createParagraph(t){const{range:i,selection:e}=Ht(Mt.state.ref);if(!i)return;const o=m(null==e?void 0:e.anchorNode);if(!o)return;const n=m(y({element:o,container:Mt.state.ref}));if(!n)return;if(_({node:n}))return;t.preventDefault();const r=this.toUpdateParagraphs([n]);Dt(i),i.collapse(!0),i.setEndAfter(n);const s=""===i.cloneContents().textContent,{shiftKey:a}=t;if(a||S({paragraph:n}))await this.createLineBreak({anchor:o,paragraph:n,isEndOfParagraph:s,range:i,undoParagraphs:r});else if(s){const t=await I({container:Mt.state.ref,paragraph:n});H(t)}else await this.createParagraphWithContent({range:i,paragraph:n,undoParagraphs:r})}async createParagraphWithContent({paragraph:t,range:i,undoParagraphs:e}){ti.state.observe=!1;const o=i.extractContents(),n=await D({container:Mt.state.ref,paragraph:t,fragment:o}),r=this.toAddParagraphs([m(n)]);""===t.textContent&&await N({paragraph:t}),ei({container:Mt.state.ref,addRemoveParagraphs:r,updateParagraphs:e}),ti.state.observe=!0,M(n)}toAddParagraphs(t){return t.map((t=>({outerHTML:t.outerHTML,index:R(t),mutation:"add"})))}toUpdateParagraphs(t){return t.map((t=>({outerHTML:t.outerHTML,index:R(t)})))}async createLineBreak({anchor:t,paragraph:i,isEndOfParagraph:e,range:o,undoParagraphs:n}){ti.state.observe=!1,ei({container:Mt.state.ref,addRemoveParagraphs:[],updateParagraphs:n}),o.setEndAfter(Tt(Mt.state.ref).anchorNode);const r=await j({paragraph:t,range:o});if(!e||!r)return M(r),void(ti.state.observe=!0);const s=await E({paragraph:i,element:r});M(s),ti.state.observe=!0}}const wi=[{match:({key:t,lastKey:i,lastBeforeInput:e})=>rt()?["‘","’","´"].includes(null==e?void 0:e.key)&&" "===t.key:"`"===t.key&&[" ","Dead"].includes(null==i?void 0:i.key),transform:()=>document.createElement("mark"),active:({nodeName:t})=>"mark"===t.toLowerCase(),shouldTrimText:({nodeValue:t})=>"`"===t.charAt(t.length-1)||"`"===t.charAt(0),shouldTrimSplit:({target:t,startOffset:i})=>void 0!==i&&"`"===t.nodeValue.charAt(i-1),trim:()=>"`".length,postTransform:()=>xi()},{match:({lastKey:t,key:i})=>"*"===(null==t?void 0:t.key)&&"*"===i.key,transform:()=>{const t=document.createElement("span");return t.style.fontWeight="bold",t},active:t=>{const{fontWeight:i}=window.getComputedStyle(t);return parseInt(i)>400||"bold"===i},shouldTrimText:({nodeValue:t})=>"*"===t.charAt(t.length-1)||"*"===t.charAt(0),shouldTrimSplit:({target:t,startOffset:i})=>void 0!==i&&"*"===t.nodeValue.charAt(i-1),trim:()=>"*".length},{match:({lastBeforeInput:t,key:i})=>" "===(null==t?void 0:t.key)&&"_"===i.key,transform:()=>{const t=document.createElement("span");return t.style.fontStyle="italic",t},active:t=>{const{fontStyle:i}=window.getComputedStyle(t);return"italic"===i},shouldTrimText:()=>!1,shouldTrimSplit:()=>!1,trim:()=>"".length}],xi=()=>/apple/i.test(navigator.vendor)?Promise.resolve():ki(),ki=()=>new Promise((t=>{const i=new MutationObserver((async e=>{i.disconnect();const o=e[0].target;if(!o.nodeValue.includes("`"))return void t();ti.state.observe=!1,await Ci({target:o,searchValue:"`",replaceValue:""}),ti.state.observe=!0;const n=m(o),r="mark"===(null==n?void 0:n.nodeName.toLowerCase());if(st())return H(r?n.nextSibling:o.nextSibling),void t();H(r?o:o.nextSibling),t()}));i.observe(Mt.state.ref,{characterData:!0,subtree:!0})})),Ci=({target:t,searchValue:i,replaceValue:e})=>new Promise((o=>{const n=new MutationObserver((t=>{n.disconnect(),o(t[0].target)}));n.observe(Mt.state.ref,{characterData:!0,subtree:!0}),t.nodeValue=t.nodeValue.replace(i,e)})),Mi=({target:t,index:i,transformInput:e})=>new Promise((o=>{var n,r;const s=new MutationObserver((async()=>{if(s.disconnect(),!e.shouldTrimText(l))return void o(l);const t=await Pi({target:l,index:1});o(t)}));s.observe(Mt.state.ref,{childList:!0,subtree:!0});const a=null===(r=null===(n=Tt(Mt.state.ref))||void 0===n?void 0:n.getRangeAt(0))||void 0===r?void 0:r.startOffset,l=t.splitText(i-(e.shouldTrimSplit({target:t,startOffset:a})?e.trim():0))})),Pi=({target:t,index:i})=>new Promise((e=>{const o=new MutationObserver((t=>{o.disconnect(),e(t[0].target)}));o.observe(Mt.state.ref,{characterData:!0,subtree:!0}),t.nodeValue=t.nodeValue.slice(i)}));class Li{constructor(){this.lastBeforeInput=void 0,this.lastKey=void 0,this.onBeforeInput=async t=>{await this.preventTextLeaves(t);const{data:i}=t;this.lastBeforeInput={key:i}},this.onKeyDown=async t=>{await this.transformInput(t),this.deleteSelection(t)}}init(){var t,i;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("beforeinput",this.onBeforeInput),null===(i=Mt.state.ref)||void 0===i||i.addEventListener("keydown",this.onKeyDown)}destroy(){var t,i;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("beforeinput",this.onBeforeInput),null===(i=Mt.state.ref)||void 0===i||i.removeEventListener("keydown",this.onKeyDown)}async preventTextLeaves(t){var i;const{range:e,selection:o}=Ht(Mt.state.ref);if(!e)return;if(!Mt.state.ref.isEqualNode(null==o?void 0:o.anchorNode))return;const{data:n}=t;if(null===n)return;const{startOffset:r}=e,s=O({parent:Mt.state.ref,indexDepths:[r]});if(null===(i=xt.state.textParagraphs)||void 0===i?void 0:i.includes(null==s?void 0:s.nodeName.toLowerCase()))return void e.setStart(s,0);t.preventDefault();const a=await W({container:Mt.state.ref,range:e,text:n});H(a)}async transformInput(t){var i;const{key:e}=t,o=Tt(Mt.state.ref);if(!o)return;const{focusNode:n}=o,r=m(n);if(void 0!==wi.find((({active:t})=>t(r))))return;const s=wi.find((({match:t})=>t({key:{key:e},lastKey:this.lastKey,lastBeforeInput:this.lastBeforeInput})));if(void 0!==s)return await(async({$event:t,transformInput:i,target:e,parent:o})=>{(({target:t,parent:i,transformInput:e})=>{const o=B({target:t});if(t.nodeValue.length===o)return!0;const{active:n}=e;return!n(i)})({target:e,parent:o,transformInput:i})&&(t.preventDefault(),ti.state.observe=!1,await(({target:t,transformInput:i,parent:e})=>new Promise((async o=>{const n=B({target:t});if(t.nodeValue.length===n){if(!i.shouldTrimText(t))return void o();const e=new MutationObserver((()=>{e.disconnect(),o()}));return e.observe(Mt.state.ref,{characterData:!0,subtree:!0}),void(t.nodeValue=t.nodeValue.substring(0,t.nodeValue.length-i.trim()))}const r=await Mi({target:t,index:n,transformInput:i}),s=new MutationObserver((t=>{var i;s.disconnect(),H(null===(i=t[1])||void 0===i?void 0:i.addedNodes[0]),o()}));s.observe(Mt.state.ref,{childList:!0,subtree:!0}),t.nextSibling?e.insertBefore(r,t.nextSibling):e.appendChild(r)})))({target:e,parent:o,transformInput:i}),ti.state.observe=!0,await(({target:t,parent:i,transformInput:e})=>new Promise((async o=>{const n=new MutationObserver((t=>{var i;n.disconnect(),H(null===(i=t[0])||void 0===i?void 0:i.addedNodes[0]),o()}));n.observe(Mt.state.ref,{childList:!0,subtree:!0});const{active:r,transform:s}=e;if(r(i))return;const a=s();a.innerHTML="​";const l=document.createTextNode("​");t.nextSibling?i.insertBefore(a,t.nextSibling):i.append(a,l)})))({target:e,parent:o,transformInput:i}))})({$event:t,transformInput:s,target:n,parent:r}),await(null===(i=s.postTransform)||void 0===i?void 0:i.call(s)),void(this.lastKey=void 0);this.lastKey={key:e}}deleteSelection(t){const{key:i}=t;if(!["Delete","Backspace"].includes(i))return;const{range:e}=Ht(Mt.state.ref);if(!e)return;if(!Mt.state.ref.isEqualNode(null==e?void 0:e.commonAncestorContainer))return;if(1===e.startOffset&&"​"===e.startContainer.textContent.charAt(0)&&e.setStart(e.startContainer,0),e.startOffset>0)return;if(!U({element:e.startContainer,container:Mt.state.ref}))return;const o=m(y({element:e.startContainer,container:Mt.state.ref}));o&&(e.setStartBefore(o),t.preventDefault(),t.stopImmediatePropagation(),e.deleteContents())}}const Ai=({linkUrl:t})=>{const i=document.createElement("a");return i.href=t,i.rel="noopener noreferrer",i.target="_blank",i};class Ri{constructor(){this.onPaste=async t=>{const i=t.clipboardData.getData("text/html"),e=document.createElement("div");e.innerHTML=i,console.log(t.clipboardData.getData("text/plain"),"---",t.clipboardData.getData("text/html"));const o=e.children.length<=0;if(o){const i=t.clipboardData.getData("text/plain");if((t=>{try{const{protocol:i}=new URL(t);return["http:","https:"].includes(i)}catch(t){return!1}})(i)){const t=Ai({linkUrl:i});t.innerHTML=i,e.append(t)}}if(o&&e.children.length<=0)return;const{range:n,selection:r}=Ht(Mt.state.ref);if(!n)return;const s=m(null==r?void 0:r.anchorNode);if(!s)return;t.preventDefault();const a=m(y({element:s,container:Mt.state.ref}));this.cleanAttributes(e),this.cleanMetas(e);const l=void 0!==Array.from(e.childNodes).find((t=>!$(t)));if(Dt(n),!l)return a?void await this.insertNodes({range:n,div:e}):void K({paragraph:a,container:Mt.state.ref,nodes:[e]});const h=Array.from(e.childNodes).map((t=>{if(L(t)||"span"===t.nodeName.toLowerCase().trim()){const i=document.createElement("div");return i.appendChild(t),i}return t}));if(w({paragraph:a}))return void V({elements:h,paragraph:a,container:Mt.state.ref});const c=this.splitCurrentParagraph({range:n,paragraph:a});K({paragraph:a,container:Mt.state.ref,nodes:[...h,...void 0!==c?[c]:[]]})}}init(){var t;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("paste",this.onPaste)}destroy(){var t;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("paste",this.onPaste)}async insertNodes({range:t,div:i}){const e=document.createDocumentFragment();e.append(...Array.from(i.childNodes));const o=await F({observerRoot:Mt.state.ref,range:t,element:e});H(o)}splitCurrentParagraph({range:t,paragraph:i}){if(i)return t.collapse(!0),t.setEndAfter(i),t.extractContents()}cleanAttributes(t){const i=[...new Set([...xt.state.attributes.exclude,"class","style"])],e=({element:t,attributes:i})=>{for(const e of i)t.removeAttribute(e)},o=t.querySelectorAll(i.map((t=>`[${t}]`)).join(","));for(const t of Array.from(o))e({element:t,attributes:i});return t}cleanMetas(t){const i=Array.from(t.children).filter((t=>Z(t)));for(const t of i)t.parentElement.removeChild(t);return t}}class zi{constructor(){this.onSelectParagraph=({detail:t})=>{var i,e,o,n,r,s;const a=null===(i=Mt.state.ref)||void 0===i?void 0:i.firstElementChild,l=null===(e=Mt.state.ref)||void 0===e?void 0:e.children[1],h=a&&t&&t.isEqualNode(a),c=l&&t&&t.isEqualNode(l);null===(o=Mt.state.ref)||void 0===o||o.removeEventListener("keydown",this.onKeyChange),null===(n=Mt.state.ref)||void 0===n||n.removeEventListener("keyup",this.onKeyChange),(h||c)&&(null===(r=Mt.state.ref)||void 0===r||r.addEventListener("keydown",this.onKeyChange),null===(s=Mt.state.ref)||void 0===s||s.addEventListener("keyup",this.onKeyChange)),this.classesEmpty(),this.cleanEmpty()},this.onKeyChange=()=>{var t;const i=y({element:null===(t=getSelection())||void 0===t?void 0:t.anchorNode,container:Mt.state.ref});i&&!L(i)&&setTimeout((()=>this.toggleClassEmpty(i)),250)}}init({editorRef:t}){var i,e;this.editorRef=t,null===(i=this.editorRef)||void 0===i||i.addEventListener("selectParagraph",this.onSelectParagraph),null===(e=Mt.state.ref)||void 0===e||e.addEventListener("focusin",this.onSelectParagraph,{passive:!0}),this.classesEmpty()}destroy(){var t,i;null===(t=this.editorRef)||void 0===t||t.removeEventListener("selectParagraph",this.onSelectParagraph),null===(i=Mt.state.ref)||void 0===i||i.removeEventListener("focusin",this.onSelectParagraph)}classesEmpty(){var t,i;const e=null===(t=Mt.state.ref)||void 0===t?void 0:t.firstElementChild,o=null===(i=Mt.state.ref)||void 0===i?void 0:i.children[1];this.classEmpty(e),this.classEmpty(o)}classEmpty(t){if(!t)return;const i=y({element:t,container:Mt.state.ref});i&&!L(i)&&this.toggleClassEmpty(i)}toggleClassEmpty(t){var i;const{classList:e,nodeName:o}=t;if(!xt.state.textParagraphs.includes(o.toLowerCase()))return void e.remove("stylo-placeholder-empty");const n=w({paragraph:t}),r=R(t);n&&(0===r||(null===(i=Mt.state.ref)||void 0===i?void 0:i.children.length)<=2)?e.add("stylo-placeholder-empty"):e.remove("stylo-placeholder-empty")}cleanEmpty(){var t;const i=null===(t=Mt.state.ref)||void 0===t?void 0:t.querySelectorAll(".stylo-empty"),e=Array.from(i||[]).filter((t=>R(t)>1));for(const t of e)t.classList.remove("stylo-empty")}}class Oi{constructor(){this.onKeyDown=async t=>{const{key:i}=t;["Tab"].includes(i)&&(t.preventDefault(),await this.catchTab(t))}}init(){var t;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("keydown",this.onKeyDown)}destroy(){var t;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("keydown",this.onKeyDown)}async catchTab({shiftKey:t}){const{range:i,selection:e}=Ht(Mt.state.ref);if(!i)return;const o=null==e?void 0:e.focusNode,n=y({element:o,container:Mt.state.ref});n&&_({node:n})?await this.createSublist({paragraph:n,node:o,range:i,shiftKey:t}):t||this.createTabulation({range:i,node:o,paragraph:n})}createTabulation({range:t,node:i,paragraph:e}){if(!L(i))return void 0!==e?void this.insertSpanTabulation({range:t}):void 0;this.insertSpanTabulation({range:t})}insertSpanTabulation({range:t}){const i=document.createElement("span");i.innerHTML="\t",null==t||t.insertNode(i),H(i)}async createSublist({paragraph:t,node:i,range:e,shiftKey:o}){const n=void 0!==i&&_({node:i}),r=t.nodeName.toLowerCase(),s=n?i.firstChild:this.findParentElement({element:i,paragraph:t,nodeName:"li"});if(!s)return void this.createTabulation({range:e,node:i,paragraph:t});const a=n?i:this.findParentElement({element:i,paragraph:t,nodeName:r});if(!a)return void this.createTabulation({range:e,node:i,paragraph:t});if(o){if(P({element:a,container:Mt.state.ref}))return;const i=new MutationObserver((t=>{var e;i.disconnect();const o=null===(e=t.find((({addedNodes:t})=>t.length>0)))||void 0===e?void 0:e.addedNodes[0];M(o)}));i.observe(t,{childList:!0,subtree:!0});const e=new Range;e.setStartBefore(s),e.setEndAfter(a.lastChild);const o=Y(s),n=e.extractContents();return 0===o?void a.parentElement.replaceChild(n,a):void a.parentElement.insertBefore(n,a.nextSibling)}const{endOffset:l,commonAncestorContainer:h}=e,c=0===h.textContent.length,d=l===h.textContent.length,u=h.isSameNode(this.findLastChild(s));if(!(d&&u||c))return void this.createTabulation({range:e,node:i,paragraph:t});if(1===a.childNodes.length)return void this.createTabulation({range:e,node:i,paragraph:t});const f=new MutationObserver((t=>{var i;f.disconnect();const e=null===(i=t.find((({addedNodes:t})=>t.length>0)))||void 0===i?void 0:i.addedNodes[0];if(!e)return;const o=_({node:e})?e.firstChild:e;0!==e.textContent.length?H(o):M(o)}));if(f.observe(t,{childList:!0,subtree:!0}),s.previousSibling&&_({node:s.previousSibling}))return void s.previousSibling.appendChild(s);const p=new Range;p.selectNode(s);const v=p.cloneContents(),g=document.createElement(r);g.append(v),a.replaceChild(g,s)}findParentElement({element:t,paragraph:i,nodeName:e}){const{nodeName:o,parentElement:n}=t;return o.toLowerCase()===e?t:P({element:t,container:Mt.state.ref})?void 0:this.findParentElement({element:n,paragraph:i,nodeName:e})}findLastChild(t){return null!==t.lastChild?this.findLastChild(t.lastChild):t}}class Ti{constructor(){this.undoInputs=void 0,this.undoUpdateParagraphs=[],this.undoSelection=void 0,this.debounceUpdateInputs=ot((()=>this.stackUndoInputs()),350),this.onKeydown=async t=>{const{key:i,ctrlKey:e,metaKey:o,shiftKey:n}=t;zt(t)?this.stackUndoInputs():"z"!==i||!e&&!o||n?"z"===i&&(e||o)&&n?await this.redo(t):"Backspace"===i&&this.stackBackspace():await this.undo(t)},this.onKeyup=()=>{var t;this.onEventUpdateParagraphs(null===(t=Tt(Mt.state.ref))||void 0===t?void 0:t.anchorNode)},this.onSelectionChange=()=>this.undoSelection=ii(Mt.state.ref),this.onToolbarActivated=()=>{this.copySelectedParagraphs({filterEmptySelection:!0})},this.onMenuActivated=({detail:t})=>{const{paragraph:i}=t;this.undoUpdateParagraphs=this.toUpdateParagraphs([i])},this.onSnapshotParagraph=({target:t})=>{this.onEventUpdateParagraphs(t)},this.onMouseTouchDown=({target:t})=>{this.onEventUpdateParagraphs(t)},this.onMutation=t=>{const i=this.onParagraphsMutations(t),e=this.onNodesParagraphsMutation(t);ei({container:Mt.state.ref,addRemoveParagraphs:i,updateParagraphs:e,selection:this.undoSelection}),e.length>0||(this.onAttributesMutation(t),this.onCharacterDataMutations(t))}}init(){var t,i,e,o,n;this.undoInputs=void 0,this.undoUpdateParagraphs=[],this.observer=new MutationObserver(this.onMutation),this.observe(),null===(t=Mt.state.ref)||void 0===t||t.addEventListener("keydown",this.onKeydown),null===(i=Mt.state.ref)||void 0===i||i.addEventListener("keyup",this.onKeyup),null===(e=Mt.state.ref)||void 0===e||e.addEventListener("mousedown",this.onMouseTouchDown),null===(o=Mt.state.ref)||void 0===o||o.addEventListener("touchstart",this.onMouseTouchDown),null===(n=Mt.state.ref)||void 0===n||n.addEventListener("snapshotParagraph",this.onSnapshotParagraph),document.addEventListener("selectionchange",this.onSelectionChange),document.addEventListener("toolbarActivated",this.onToolbarActivated),document.addEventListener("menuActivated",this.onMenuActivated),this.unsubscribe=ti.onChange("observe",(t=>{if(t)return this.copySelectedParagraphs({filterEmptySelection:!1}),this.undoInputs=void 0,void this.observe();this.disconnect()}))}destroy(){var t,i,e,o,n,r;this.disconnect(),null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("keydown",this.onKeydown),null===(i=Mt.state.ref)||void 0===i||i.removeEventListener("keyup",this.onKeyup),null===(e=Mt.state.ref)||void 0===e||e.removeEventListener("mousedown",this.onMouseTouchDown),null===(o=Mt.state.ref)||void 0===o||o.removeEventListener("touchstart",this.onMouseTouchDown),null===(n=Mt.state.ref)||void 0===n||n.removeEventListener("snapshotParagraph",this.onSnapshotParagraph),document.removeEventListener("selectionchange",this.onSelectionChange),document.removeEventListener("toolbarActivated",this.onToolbarActivated),document.removeEventListener("menuActivated",this.onMenuActivated),null===(r=this.unsubscribe)||void 0===r||r.call(this)}async undo(t){t.preventDefault(),void 0!==oi()&&await this.undoRedo({undoRedo:si})}async redo(t){t.preventDefault(),void 0!==ni()&&await this.undoRedo({undoRedo:ai})}stackUndoInputs(){this.copySelectedParagraphs({filterEmptySelection:!1}),this.undoInputs&&((({container:t,data:i})=>{ti.state.undo||(ti.state.undo=[]),ti.state.undo.push({changes:i.map((i=>({type:"input",target:t,data:i})))}),ti.state.redo=[]})({data:this.undoInputs,container:Mt.state.ref}),this.undoInputs=void 0)}stackBackspace(){var t;const{range:i}=Ht(Mt.state.ref);if(!i)return;const e=1===i.startOffset&&"​"===i.startContainer.textContent.charAt(0);if(0!==i.startOffset&&!e)return;const o=null===(t=Tt(Mt.state.ref))||void 0===t?void 0:t.anchorNode;if(!o)return;const n=m(y({element:o,container:Mt.state.ref}));n&&(this.undoUpdateParagraphs=this.toUpdateParagraphs([...n.previousElementSibling?[n.previousElementSibling]:[],n]))}async undoRedo({undoRedo:t}){this.disconnect(),await t(),this.observe()}observe(){this.observer.observe(Mt.state.ref,{childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,subtree:!0})}disconnect(){var t;null===(t=this.observer)||void 0===t||t.disconnect()}onEventUpdateParagraphs(t){if(!t)return;const i=m(y({element:t,container:Mt.state.ref}));i&&(this.undoUpdateParagraphs=this.toUpdateParagraphs([i]))}copySelectedParagraphs({filterEmptySelection:t}){const i=(({container:t,filterEmptySelection:i})=>{const{range:e,selection:o}=Ht(t);if(!e||i&&0===(null==o?void 0:o.toString().length))return;const n=m(y({element:e.startContainer,container:t})),r=m(y({element:e.endContainer,container:t}));if(!r||!n||(null==n?void 0:n.isSameNode(r)))return n?[n]:[];if(n.nextElementSibling.isSameNode(r))return[n,r];const s=[];let a=n.nextElementSibling;for(;null!==a&&!a.isSameNode(r);)s.push(m(a)),a=a.nextElementSibling;return[n,...s,r]})({container:Mt.state.ref,filterEmptySelection:t});i&&(this.undoUpdateParagraphs=this.toUpdateParagraphs(i))}toUpdateParagraphs(t){return t.map((t=>({outerHTML:this.cleanOuterHTML(t),index:R(t),paragraph:t})))}onCharacterDataMutations(t){const i=t.filter((({oldValue:t})=>null!==t));i.length<=0||(this.undoInputs||(this.undoInputs=i.map((t=>this.toUndoInput(t))).filter((t=>void 0!==t))),this.undoInputs.length<=0?this.undoInputs=void 0:this.debounceUpdateInputs())}toUndoInput(t){const i=t.target,e=i.nodeValue;if(e===t.oldValue)return;const o=m(y({element:i,container:Mt.state.ref}));if(!o||!i.parentNode)return;const n=z({target:i,paragraph:o});return{oldValue:t.oldValue,offset:B({target:i})+(t.oldValue.length-e.length),index:R(o),indexDepths:n}}onParagraphsMutations(t){const i=[];Ut({mutations:t,container:Mt.state.ref}).forEach((t=>i.push({outerHTML:this.cleanOuterHTML(t),mutation:"add",index:t.previousElementSibling?R(m(t.previousElementSibling))+1:0}))),i.sort((({index:t},{index:i})=>i-t));const e=(({mutations:t,container:i,paragraphIdentifier:e})=>!t||t.length<=0?[]:t.filter((({removedNodes:t})=>(null==t?void 0:t.length)>0)).reduce(((t,{removedNodes:o,previousSibling:n})=>[...t,...Yt({nodes:Array.from(o),paragraphIdentifier:e}).map((t=>({paragraph:t,previousSibling:Vt({container:i,previousSibling:n})})))]),[]))({mutations:t,container:Mt.state.ref,paragraphIdentifier:xt.state.attributes.paragraphIdentifier}),o=Math.min(...e.map((({previousSibling:t})=>t?R(m(t))+1:0)));return e.forEach((({paragraph:t},e)=>{const n=e+(Number.isFinite(o)?o:0),r=this.undoUpdateParagraphs.find((({index:t})=>t===n));return i.push({outerHTML:(null==r?void 0:r.outerHTML)||this.cleanOuterHTML(t),mutation:"remove",index:n})})),i}onNodesParagraphsMutation(t){const i=$t({mutations:t,container:Mt.state.ref}),e=Kt({mutations:t,paragraphIdentifier:xt.state.attributes.paragraphIdentifier});if(!(i.length>0||e.length>0))return[];if(this.undoUpdateParagraphs.length<=0)return[];const o=Ut({mutations:t,container:Mt.state.ref}),n=this.undoUpdateParagraphs.filter((({paragraph:t})=>t.isConnected&&void 0===o.find((i=>i.isEqualNode(t)))));return n.length<=0?(this.copySelectedParagraphs({filterEmptySelection:!0}),[]):(this.copySelectedParagraphs({filterEmptySelection:!0}),this.undoInputs=void 0,n)}cleanOuterHTML(t){const i=t.cloneNode(!0);return i.removeAttribute("placeholder"),i.outerHTML}onAttributesMutation(t){const i=Ft({mutations:Xt({mutations:t,excludeAttributes:xt.state.attributes.exclude}),container:Mt.state.ref});i.length<=0||this.undoUpdateParagraphs.length<=0||(ei({container:Mt.state.ref,addRemoveParagraphs:[],updateParagraphs:this.undoUpdateParagraphs,selection:this.undoSelection}),this.undoUpdateParagraphs=this.toUpdateParagraphs(i))}}const _i=class{constructor(t){o(this,t),this.contentEditable=!0,this.debounceSize=ot((()=>this.applySize()),250),this.undoRedoEvents=new Ti,this.enterEvents=new mi,this.placeHolderEvents=new zi,this.inputEvents=new Li,this.tabEvents=new Oi,this.dataEvents=new qt,this.pasteEvents=new Ri,this.mobile=Ot()}componentWillLoad(){this.init(),this.applyConfig()}componentDidLoad(){null===window||void 0===window||window.addEventListener("resize",this.debounceSize)}disconnectedCallback(){var t;null===window||void 0===window||window.removeEventListener("resize",this.debounceSize),this.destroy(),null===(t=this.attributesObserver)||void 0===t||t.disconnect()}onContainerRefChange(){this.destroy(),this.init()}onConfigChange(){this.destroy(),this.applyConfig(),this.initEvents()}applySize(){var t;this.mobile||(Mt.state.size=null===(t=this.containerRef)||void 0===t?void 0:t.getBoundingClientRect())}init(){Mt.state.ref=this.containerRef,this.containerRef&&((({rootNode:t})=>{let i=(t===document?document.head:t).querySelector("style[stylo-editor]");null===i&&(i=document.createElement("style"),i.setAttribute("stylo-editor",""),i.innerHTML="\n    .stylo-container > * {\n      white-space: pre-wrap;\n      position: relative;\n    }\n\n    .stylo-container > *:after {\n      content: attr(placeholder);\n      color: var(--stylo-placeholder-color, rgba(55, 53, 47, 0.5));\n      position: absolute;\n      top: 0;\n    }\n  ",t!==document?t.prepend(i):document.head.append(i))})({rootNode:this.containerRef.getRootNode()}),Mt.state.ref.classList.add("stylo-container"),this.containerRefEditable(),this.applySize(),this.initEvents())}containerRefEditable(){var t;null===(t=this.attributesObserver)||void 0===t||t.disconnect(),this.attributesObserver=new MutationObserver((t=>{t.find((({attributeName:t})=>["contenteditable"].includes(t.toLowerCase())))&&(this.contentEditable=this.isContentEditable(),this.contentEditable?this.initEvents():this.destroy())})),this.attributesObserver.observe(Mt.state.ref,{attributes:!0}),this.contentEditable=this.isContentEditable()}isContentEditable(){return["true",""].includes(this.containerRef.getAttribute("contenteditable"))}applyConfig(){var t,i;if(!this.config)return;const{plugins:e,toolbar:o,i18n:n,placeholders:r,textParagraphs:s,menus:a,attributes:l}=this.config;Rt.state.custom=null==n?void 0:n.custom,Rt.state.lang=(null==n?void 0:n.lang)||"en",xt.state.plugins=e||ft,xt.state.toolbar=o?Object.assign(Object.assign({},xt.state.toolbar),o):pt,xt.state.placeholders=r||vt,xt.state.textParagraphs=s||gt,xt.state.menus=a;const h=null!==(t=null==l?void 0:l.paragraphIdentifier)&&void 0!==t?t:"paragraph_id";xt.state.attributes={paragraphIdentifier:h,exclude:[...new Set([...null!==(i=null==l?void 0:l.exclude)&&void 0!==i?i:[],...bt,h])]}}destroy(){this.undoRedoEvents.destroy(),this.inputEvents.destroy(),this.enterEvents.destroy(),this.placeHolderEvents.destroy(),this.tabEvents.destroy(),this.dataEvents.destroy(),this.pasteEvents.destroy(),ti.state.undo=[],ti.state.redo=[]}initEvents(){this.contentEditable&&(this.inputEvents.init(),this.enterEvents.init(),this.placeHolderEvents.init({editorRef:this.el}),this.tabEvents.init(),this.dataEvents.init({editorRef:this.el}),this.undoRedoEvents.init(),this.pasteEvents.init())}render(){var t;if(this.contentEditable)return e(a,null,e("stylo-add",null),e("stylo-plugins",null),this.renderToolbar(),(null===(t=xt.state.menus)||void 0===t?void 0:t.length)&&e("stylo-menus",null))}renderToolbar(){if(!this.mobile)return e("stylo-toolbar",{containerRef:this.containerRef})}get el(){return s(this)}static get watchers(){return{containerRef:["onContainerRefChange"],config:["onConfigChange"]}}};_i.style=":host{display:block}";const Si=()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M160 368L32 256l128-112M352 368l128-112-128-112M304 96l-96 320"})),Ii=()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e("circle",{cx:"256",cy:"256",r:"48"}),e("circle",{cx:"416",cy:"256",r:"48"}),e("circle",{cx:"96",cy:"256",r:"48"})),Hi=()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"512",height:"512",viewBox:"0 0 512 512"},e("path",{d:"M432,112V96a48.14,48.14,0,0,0-48-48H64A48.14,48.14,0,0,0,16,96V352a48.14,48.14,0,0,0,48,48H80",style:{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"32px"}}),e("rect",{x:"96",y:"128",width:"400",height:"336",rx:"45.99",ry:"45.99",style:{fill:"none",stroke:"currentColor",strokeLinejoin:"round",strokeWidth:"32px"}}),e("ellipse",{cx:"372.92",cy:"219.64",rx:"30.77",ry:"30.55",style:{fill:"none",stroke:"currentColor",strokeMiterlimit:"10",strokeWidth:"32px"}}),e("path",{d:"M342.15,372.17,255,285.78a30.93,30.93,0,0,0-42.18-1.21L96,387.64",style:{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32px"}}),e("path",{d:"M265.23,464,383.82,346.27a31,31,0,0,1,41.46-1.87L496,402.91",style:{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32px"}})),Di=()=>e("svg",{width:"100%",height:"100%",viewBox:"0 0 512 512",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinejoin:"round",strokeMiterlimit:"1.41421"}},e("path",{d:"M432,240l-240.5,0c-8.8,0 -16,7.2 -16,16c0,8.8 7.2,16 16,16l240.5,0c8.8,0 16,-7.2 16,-16c0,-8.8 -7.2,-16 -16,-16Zm0,124l-240.5,0c-8.8,0 -16,7.2 -16,16c0,8.8 7.2,16 16,16l240.5,0c8.8,0 16,-7.2 16,-16c0,-8.8 -7.2,-16 -16,-16Zm-240.5,-216l240.5,0c8.8,0 16,-7.2 16,-16c0,-8.8 -7.2,-16 -16,-16l-240.5,0c-8.8,0 -16,7.2 -16,16c0,8.8 7.2,16 16,16Z",style:{fillRule:"nonzero",fill:"currentColor"}}),e("path",{d:"M80.784,159.32l14.784,0l0,-46.896c0,-1.408 0.048,-2.832 0.144,-4.272l-12.288,10.512c-0.32,0.256 -0.64,0.44 -0.96,0.552c-0.32,0.112 -0.624,0.168 -0.912,0.168c-0.48,0 -0.912,-0.104 -1.296,-0.312c-0.384,-0.208 -0.672,-0.456 -0.864,-0.744l-2.688,-3.696l20.448,-17.712l6.96,0l0,62.4l13.536,0l0,6.528l-36.864,0l0,-6.528Z",style:{fillRule:"nonzero",fill:"currentColor"}}),e("path",{d:"M95.856,221.296c2.912,0 5.632,0.432 8.16,1.296c2.528,0.864 4.712,2.12 6.552,3.768c1.84,1.648 3.288,3.656 4.344,6.024c1.056,2.368 1.584,5.056 1.584,8.064c0,2.56 -0.384,4.928 -1.152,7.104c-0.768,2.176 -1.808,4.264 -3.12,6.264c-1.312,2 -2.824,3.936 -4.536,5.808c-1.712,1.872 -3.528,3.784 -5.448,5.736l-18.096,18.528c1.28,-0.352 2.576,-0.632 3.888,-0.84c1.312,-0.208 2.576,-0.312 3.792,-0.312l23.04,0c0.928,0 1.664,0.272 2.208,0.816c0.544,0.544 0.816,1.248 0.816,2.112l0,5.184l-45.888,0l0,-2.928c0,-0.608 0.12,-1.232 0.36,-1.872c0.24,-0.64 0.632,-1.232 1.176,-1.776l22.032,-22.128c1.824,-1.856 3.488,-3.64 4.992,-5.352c1.504,-1.712 2.792,-3.432 3.864,-5.16c1.072,-1.728 1.896,-3.48 2.472,-5.256c0.576,-1.776 0.864,-3.672 0.864,-5.688c0,-2.016 -0.32,-3.784 -0.96,-5.304c-0.64,-1.52 -1.52,-2.776 -2.64,-3.768c-1.12,-0.992 -2.432,-1.736 -3.936,-2.232c-1.504,-0.496 -3.12,-0.744 -4.848,-0.744c-1.728,0 -3.328,0.256 -4.8,0.768c-1.472,0.512 -2.776,1.224 -3.912,2.136c-1.136,0.912 -2.096,1.992 -2.88,3.24c-0.784,1.248 -1.336,2.624 -1.656,4.128c-0.256,0.928 -0.64,1.6 -1.152,2.016c-0.512,0.416 -1.184,0.624 -2.016,0.624c-0.16,0 -0.328,-0.008 -0.504,-0.024c-0.176,-0.016 -0.376,-0.04 -0.6,-0.072l-4.464,-0.768c0.448,-3.136 1.312,-5.912 2.592,-8.328c1.28,-2.416 2.904,-4.44 4.872,-6.072c1.968,-1.632 4.224,-2.872 6.768,-3.72c2.544,-0.848 5.288,-1.272 8.232,-1.272Z",style:{fillRule:"nonzero",fill:"currentColor"}}),e("path",{d:"M96.768,345.296c2.912,0 5.6,0.416 8.064,1.248c2.464,0.832 4.584,2.016 6.36,3.552c1.776,1.536 3.16,3.392 4.152,5.568c0.992,2.176 1.488,4.592 1.488,7.248c0,2.176 -0.28,4.12 -0.84,5.832c-0.56,1.712 -1.36,3.216 -2.4,4.512c-1.04,1.296 -2.296,2.392 -3.768,3.288c-1.472,0.896 -3.12,1.616 -4.944,2.16c4.48,1.184 7.848,3.168 10.104,5.952c2.256,2.784 3.384,6.272 3.384,10.464c0,3.168 -0.6,6.016 -1.8,8.544c-1.2,2.528 -2.84,4.68 -4.92,6.456c-2.08,1.776 -4.504,3.136 -7.272,4.08c-2.768,0.944 -5.736,1.416 -8.904,1.416c-3.648,0 -6.768,-0.456 -9.36,-1.368c-2.592,-0.912 -4.784,-2.168 -6.576,-3.768c-1.792,-1.6 -3.264,-3.496 -4.416,-5.688c-1.152,-2.192 -2.128,-4.568 -2.928,-7.128l3.648,-1.536c0.672,-0.288 1.344,-0.432 2.016,-0.432c0.64,0 1.208,0.136 1.704,0.408c0.496,0.272 0.872,0.696 1.128,1.272c0.064,0.128 0.128,0.264 0.192,0.408c0.064,0.144 0.128,0.296 0.192,0.456c0.448,0.928 0.992,1.976 1.632,3.144c0.64,1.168 1.504,2.264 2.592,3.288c1.088,1.024 2.44,1.888 4.056,2.592c1.616,0.704 3.624,1.056 6.024,1.056c2.4,0 4.504,-0.392 6.312,-1.176c1.808,-0.784 3.312,-1.8 4.512,-3.048c1.2,-1.248 2.104,-2.64 2.712,-4.176c0.608,-1.536 0.912,-3.056 0.912,-4.56c0,-1.856 -0.248,-3.552 -0.744,-5.088c-0.496,-1.536 -1.392,-2.864 -2.688,-3.984c-1.296,-1.12 -3.088,-2 -5.376,-2.64c-2.288,-0.64 -5.224,-0.96 -8.808,-0.96l0,-6.192c2.912,-0.032 5.4,-0.352 7.464,-0.96c2.064,-0.608 3.752,-1.44 5.064,-2.496c1.312,-1.056 2.264,-2.32 2.856,-3.792c0.592,-1.472 0.888,-3.104 0.888,-4.896c0,-1.984 -0.312,-3.712 -0.936,-5.184c-0.624,-1.472 -1.48,-2.688 -2.568,-3.648c-1.088,-0.96 -2.376,-1.68 -3.864,-2.16c-1.488,-0.48 -3.096,-0.72 -4.824,-0.72c-1.728,0 -3.328,0.256 -4.8,0.768c-1.472,0.512 -2.776,1.224 -3.912,2.136c-1.136,0.912 -2.088,2 -2.856,3.264c-0.768,1.264 -1.344,2.632 -1.728,4.104c-0.256,0.928 -0.64,1.6 -1.152,2.016c-0.512,0.416 -1.168,0.624 -1.968,0.624c-0.16,0 -0.328,-0.008 -0.504,-0.024c-0.176,-0.016 -0.376,-0.04 -0.6,-0.072l-4.464,-0.768c0.448,-3.136 1.312,-5.912 2.592,-8.328c1.28,-2.416 2.904,-4.44 4.872,-6.072c1.968,-1.632 4.224,-2.872 6.768,-3.72c2.544,-0.848 5.288,-1.272 8.232,-1.272Z",style:{fillRule:"nonzero",fill:"currentColor"}})),Ni=()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e("circle",{cx:"92",cy:"256",r:"28",style:{fill:"currentColor"}}),e("circle",{cx:"92",cy:"132",r:"28",style:{fill:"currentColor"}}),e("circle",{cx:"92",cy:"380",r:"28",style:{fill:"currentColor"}}),e("path",{style:{fill:"currentColor"},d:"M432 240H191.5c-8.8 0-16 7.2-16 16s7.2 16 16 16H432c8.8 0 16-7.2 16-16s-7.2-16-16-16zM432 364H191.5c-8.8 0-16 7.2-16 16s7.2 16 16 16H432c8.8 0 16-7.2 16-16s-7.2-16-16-16zM191.5 148H432c8.8 0 16-7.2 16-16s-7.2-16-16-16H191.5c-8.8 0-16 7.2-16 16s7.2 16 16 16z"})),ji=t=>{switch(t){case"code":return e(Si,null);case"ul":return e(Ni,null);case"ol":return e(Di,null);case"hr":return e(Ii,null);case"img":return e(Hi,null);default:return}},Ei=class{constructor(t){o(this,t),this.applyPlugin=n(this,"applyPlugin",7),this.cancelPlugins=n(this,"cancelPlugins",7),this.display=!1,this.filter="",this.onKeyDown=t=>{const{code:i}=t;["Enter"].includes(i)||(t.preventDefault(),["Escape"].includes(i)?this.cancelPlugins.emit():["ArrowDown"].includes(i)?this.focusNext():["ArrowUp"].includes(i)?this.focusPrevious():this.filterPlugins(t))}}componentWillLoad(){this.plugins=[...xt.state.plugins]}componentDidUpdate(){this.focusOnUpdate()}focusOnUpdate(){const t=this.el.shadowRoot.querySelectorAll("button");1===t.length&&t[0].focus()}emitPlugin(t,i){t.stopPropagation(),this.applyPlugin.emit(i)}onDisplay(){this.display?document.addEventListener("keydown",this.onKeyDown):(document.removeEventListener("keydown",this.onKeyDown,!1),this.reset())}reset(){this.filter="",this.plugins=[...xt.state.plugins]}async focusFirstButton(){var t;this.focusButton=this.el.shadowRoot.querySelector("button"),null===(t=this.focusButton)||void 0===t||t.focus()}focusNext(){var t,i;this.focusButton=m(null===(t=this.focusButton||this.el.shadowRoot.firstElementChild)||void 0===t?void 0:t.nextElementSibling),null===(i=this.focusButton)||void 0===i||i.focus()}focusPrevious(){var t,i;this.focusButton=m(null===(t=this.focusButton||this.el.shadowRoot.lastElementChild)||void 0===t?void 0:t.previousElementSibling),null===(i=this.focusButton)||void 0===i||i.focus()}filterPlugins(t){const{code:i,metaKey:e,ctrlKey:o,key:n}=t;e||o||n.length>1&&!["Backspace"].includes(i)||(this.filter="Backspace"===i?this.filter.length>0?this.filter.slice(0,-1):this.filter:`${this.filter}${n}`,this.plugins=[...xt.state.plugins].filter((({text:t})=>{var i,e;return(null!==(e=null!==(i=Rt.state.plugins[t])&&void 0!==i?i:Rt.state.custom[t])&&void 0!==e?e:t).toLowerCase().indexOf(this.filter.toLowerCase())>-1})))}render(){return e(a,null,this.plugins.map(((t,i)=>this.renderPlugin(t,`plugin-${i}`))),this.renderEmpty())}renderEmpty(){if(!(this.plugins.length>0))return e("span",{class:"empty"},Rt.state.plugins.no_matches,": ",e("strong",null,this.filter))}renderPlugin(t,i){const{text:o,icon:n}=t,r=ji(n);return e("button",{key:i,onClick:i=>this.emitPlugin(i,t)},void 0===r&&e("div",Object.assign({class:"icon"},void 0===r&&{innerHTML:n})),r,this.renderText(o))}renderText(t){var i,o,n,r,s;const l=null!==(o=null!==(i=Rt.state.plugins[t])&&void 0!==i?i:Rt.state.custom[t])&&void 0!==o?o:t;if(this.filter.length>0){const t=new RegExp(this.filter+"(.*)","gi"),i=l.split(t),o=new RegExp(this.filter,"gi"),h=l.match(o);return e(a,null,null!==(n=i[0])&&void 0!==n?n:"",e("strong",null,null!==(r=h[0])&&void 0!==r?r:""),null!==(s=i[1])&&void 0!==s?s:"")}return l}get el(){return s(this)}static get watchers(){return{display:["onDisplay"]}}};Ei.style=":host{display:flex;flex-direction:column;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff;--background-active:var(--stylo-list-background-active, var(--light));--border-active:var(--stylo-list-border-active, 1px solid var(--background-active));--color-active:var(--stylo-list-color-active, var(--light-contrast))}button{display:flex;position:relative;isolation:isolate;overflow:hidden;background:transparent;border:none;outline:none;cursor:pointer;transition:color 0.25s ease-out, background 0.25s ease-out, transform 0.15s ease-out;justify-content:flex-start;align-items:center;font-size:1rem;color:var(--stylo-toolbar-button-color, black);white-space:pre}button:active{box-shadow:none;transform:translateX(1px) translateY(1px)}button:hover,button:focus{background:var(--background-active);color:var(--color-active)}svg,span.placeholder{width:1.4rem;height:1.4rem;border:var(--border-active);border-radius:var(--stylo-border, 4px);margin:4px 12px 4px 8px;background:var(--white)}svg{padding:8px}span.placeholder{padding:10px 8px 6px;font-size:0.8rem}span.placeholder::first-letter{font-size:125%}div.icon{display:flex}.empty{padding:10px 16px 6px}.empty strong{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block}";const Bi=class{constructor(t){o(this,t),this.menuActivated=n(this,"menuActivated",7),this.menu=void 0,this.onKeyDown=()=>{this.hide()}}componentDidLoad(){this.destroyListener=Mt.onChange("ref",(()=>{this.removeContainerListener(),this.addContainerListener()})),this.addContainerListener()}disconnectedCallback(){var t;this.removeContainerListener(),null===(t=this.destroyListener)||void 0===t||t.call(this)}addContainerListener(){var t;null===(t=Mt.state.ref)||void 0===t||t.addEventListener("keydown",this.onKeyDown,{passive:!0})}removeContainerListener(){var t;null===(t=Mt.state.ref)||void 0===t||t.removeEventListener("keydown",this.onKeyDown)}onResize(){this.hide()}onClick({target:t}){var i,e;const o=y({element:t,container:Mt.state.ref});this.paragraph=m(o),this.paragraph?(this.menuActivated.emit({paragraph:this.paragraph}),this.menu=null===(i=xt.state.menus)||void 0===i?void 0:i.find((({match:t})=>t({paragraph:this.paragraph}))),this.top=this.menu&&(null===(e=this.paragraph)||void 0===e?void 0:e.offsetTop)):this.hide()}async selectMenuAction({action:t}){this.paragraph?(await t({paragraph:this.paragraph}),this.hide()):this.hide()}hide(){this.paragraph=void 0,this.menu=void 0,this.top=void 0}render(){return e(r,{style:void 0===this.top?{display:"none"}:{"--menu-top":`${this.top}px`}},this.renderMenu(),e("stylo-toolbar-triangle",{style:{"--stylo-toolbar-triangle-start":"50%"}}))}renderMenu(){var t;return null===(t=this.menu)||void 0===t?void 0:t.actions.map((t=>this.renderAction(t)))}renderAction(t){var i,o;const{icon:n,text:r}=t,s=ji(n);return e("stylo-toolbar-button",{onAction:async()=>await this.selectMenuAction(t),label:null!==(o=null!==(i=Rt.state.menus[r])&&void 0!==i?i:Rt.state.custom[r])&&void 0!==o?o:r},s||e("div",{class:"icon",innerHTML:n}))}};Bi.style=":host{display:flex;justify-content:center;align-items:center;position:absolute;top:var(--menu-top);left:50%;transform:translate(-50%, calc(-100% - 16px));--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff;--box-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.12);box-shadow:var(--stylo-box-shadow, var(--box-shadow));border:var(--stylo-border);background:var(--stylo-background, var(--white));color:var(--stylo-color, var(--white-contrast));border-radius:var(--stylo-border, 4px);padding:var(--stylo-toolbar-padding, 0 8px);z-index:var(--stylo-toolbar-zindex, 1)}div.icon{display:flex;flex-direction:column}";const Wi=class{constructor(t){o(this,t),this.display=!1,this.position=void 0}componentWillLoad(){this.destroyListener=Mt.onChange("size",(()=>{Ot()||this.hide()}))}disconnectedCallback(){var t;null===(t=this.destroyListener)||void 0===t||t.call(this)}onClick(t){this.hide()}onHidePlugins(){this.hide()}hide(){this.display=!1,setTimeout((()=>this.position=void 0),150)}onListPlugins({detail:t}){if(!t)return void this.hide();const{height:i,top:e}=t.getBoundingClientRect(),o=e+220+16<(window.innerHeight||screen.height);this.position={top:t.offsetTop+(o?i:-1*i),left:t.offsetLeft,downward:o},this.paragraph=t,this.displayAndFocus()}displayAndFocus(){new MutationObserver((async(t,i)=>{var e;"visible"===this.el.style.visibility&&(i.disconnect(),await(null===(e=this.el.shadowRoot.querySelector("stylo-list"))||void 0===e?void 0:e.focusFirstButton()))})).observe(this.el,{attributes:!0,subtree:!0}),setTimeout((()=>this.display=!0),150)}onCancelPlugins(){this.hide(),k({paragraph:this.paragraph})}async onApplyPlugin(t){if(!Mt.state.ref||!this.paragraph)return;this.hide();const{files:i}=t;void 0===i?await this.transformParagraph({plugin:t}):this.openFilePicker(t)}async transformParagraph({plugin:t,files:i}){const{createParagraphs:e}=t;await e({paragraph:m(this.paragraph),container:Mt.state.ref,files:i})}openFilePicker(t){const i=this.filePicker(t);null==i||i.click()}async onFilePickerChange(t){const i=this.filePicker(t);!i||i.files.length<=0||(await this.transformParagraph({plugin:t,files:i.files}),i.value="")}filePicker({files:t}){const{accept:i}=t;return this.el.shadowRoot.querySelector(`input[accept="${i}"]`)}render(){const t=Object.assign(Object.assign({visibility:this.display?"visible":"hidden"},!this.display&&{height:"0px"}),void 0===this.position?{}:{"--actions-top":`${this.position.top}px`,"--actions-left":`${this.position.left}px`,"--actions-translate-y":this.position.downward?"0":"-100%"});return e(r,{style:t,class:this.display?"display":"hidden"},this.renderList(),this.renderInputs())}renderInputs(){return xt.state.plugins.filter((({files:t})=>void 0!==t)).map((t=>{const{accept:i,multiple:o}=t.files;return e("input",{type:"file",accept:i,multiple:o,onChange:async()=>await this.onFilePickerChange(t)})}))}renderList(){return e("stylo-list",{onApplyPlugin:async({detail:t})=>await this.onApplyPlugin(t),onCancelPlugins:()=>this.onCancelPlugins(),display:this.display})}get el(){return s(this)}};Wi.style=":host{display:flex;flex-direction:column;position:absolute;top:var(--actions-top);left:var(--actions-left);transform:translate(0, var(--actions-translate-y)) scale(0.95);opacity:0;margin:2px 0;width:220px;max-height:220px;overflow:auto;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff;background:var(--stylo-background, var(--white));color:var(--stylo-color, var(--white-contrast));border-radius:var(--stylo-border, 4px);--box-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.12);box-shadow:var(--stylo-box-shadow, var(--box-shadow));border:var(--stylo-border);pointer-events:none;transition-property:opacity, transform;transition-duration:0.15s, 0.15s;transition-timing-function:cubic-bezier(0.175, 0.885, 0.32, 1.275), cubic-bezier(0.175, 0.885, 0.32, 1.275)}:host(.display){opacity:1;transform:translate(0, var(--actions-translate-y)) scale(1);pointer-events:all}input{visibility:hidden;opacity:0}";const Ui={cmd:"style",detail:{style:"font-weight",value:"bold",initial:t=>t&&"bold"===t.style["font-weight"]}},$i={cmd:"style",detail:{style:"font-style",value:"italic",initial:t=>t&&"italic"===t.style["font-style"]}},Ki={cmd:"style",detail:{style:"text-decoration",value:"underline",initial:t=>t&&"underline"===t.style["text-decoration"]}},Vi={cmd:"style",detail:{style:"text-decoration",value:"line-through",initial:t=>t&&"line-through"===t.style["text-decoration"]}};function Fi(t,i=!0){t.hasChildNodes()&&i&&Array.from(t.childNodes).forEach((i=>{if(i.hasChildNodes()&&i.childNodes.length>1&&i.firstChild.nodeType!==Node.TEXT_NODE&&i.firstChild.nodeType!==Node.COMMENT_NODE){const e=document.createElement("span");e.append(...Array.from(i.childNodes)),t.parentElement.insertBefore(e,t)}else{const e=document.createTextNode(i.textContent);t.parentElement.insertBefore(e,t)}})),t.parentElement.removeChild(t)}const Zi=(t,i,e)=>{if("HTML"===t.nodeName.toUpperCase()||"BODY"===t.nodeName.toUpperCase())return null;if(!t.parentNode)return null;if(P({element:t,container:e}))return null;const{style:o}=m(t);return null!=o[i]&&""!==o[i]?t:Zi(t.parentNode,i,e)},Yi=(t,i)=>{if(!t)return!1;if(t.nodeName.toLowerCase()===i)return!0;if(t.hasChildNodes()){const e=t.getElementsByTagName(i);return e&&e.length>0}return!1};function Xi(t,i,e){const o=J(t);o&&(o&&o.innerText===t.toString()&&!P({element:o,container:e})&&void 0!==o.style[i.style]?qi(o,i,e):function(t,i,e,o){const n=e.getRangeAt(0);if(n.commonAncestorContainer&&["ol","ul","dl"].some((t=>t===n.commonAncestorContainer.nodeName.toLowerCase())))return void qi(n.commonAncestorContainer,i,o);const r=n.extractContents(),s=function(t,i,e){const o=document.createElement("span");return o.style[i.style]=Ji(t,i,e),o}(t,i,o);s.appendChild(r),Gi(i,s),Qi(i,s),n.insertNode(s),e.selectAllChildren(s)}(o,i,t,e))}function qi(t,i,e){t.style[i.style]=Ji(e,i,e),Gi(i,t)}function Gi(t,i){if(!i.hasChildNodes())return;const e=Array.from(i.children).filter((i=>void 0!==i.style[t.style]&&""!==i.style[t.style]));e&&e.length>0&&e.forEach((i=>{i.style[t.style]="",""!==i.getAttribute("style")&&null!==i.style||i.removeAttribute("style")})),Array.from(i.children).forEach((i=>Gi(t,i)))}function Ji(t,i,e){if(!t)return i.value;if(i.initial(t))return"initial";const o=Zi(t,i.style,e);return i.initial(o)?"initial":i.value}function Qi(t,i){if(!i.hasChildNodes())return;const e=Array.from(i.children).filter((t=>{const i=t.getAttribute("style");return!i||""===i}));e&&e.length>0?e.forEach((t=>{const i=t.querySelectorAll("[style]");if(!i||0===i.length){const i=document.createTextNode(t.textContent);t.parentElement.replaceChild(i,t)}})):Array.from(i.children).forEach((i=>Qi(t,i)))}const te=()=>e("svg",{width:"100%",height:"100%",viewBox:"0 0 512 512",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round"}},e("path",{d:"M176,331l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),e("path",{d:"M176,185l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),e("path",{d:"M96,258l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),e("path",{d:"M96,112l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),e("path",{d:"M96,400l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}})),ie=()=>e("svg",{width:"100%",height:"100%",viewBox:"0 0 512 512",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round"}},e("path",{d:"M96,331l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),e("path",{d:"M96,185l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),e("path",{d:"M96,258l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),e("path",{d:"M96,112l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),e("path",{d:"M96,400l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}})),ee=()=>e("svg",{width:"100%",height:"100%",viewBox:"0 0 512 512",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round"}},e("path",{d:"M256,331l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),e("path",{d:"M256,185l160,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"25.3px"}}),e("path",{d:"M96,258l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),e("path",{d:"M96,112l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}}),e("path",{d:"M96,400l320,0",style:{fill:"none",fillRule:"nonzero",stroke:"currentColor",strokeWidth:"32px"}})),oe=()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e("path",{d:"M419.1 337.45a3.94 3.94 0 00-6.1 0c-10.5 12.4-45 46.55-45 77.66 0 27 21.5 48.89 48 48.89h0c26.5 0 48-22 48-48.89 0-31.11-34.3-65.26-44.9-77.66zM387 287.9L155.61 58.36a36 36 0 00-51 0l-5.15 5.15a36 36 0 000 51l52.89 52.89 57-57L56.33 263.2a28 28 0 00.3 40l131.2 126a28.05 28.05 0 0038.9-.1c37.8-36.6 118.3-114.5 126.7-122.9 5.8-5.8 18.2-7.1 28.7-7.1h.3a6.53 6.53 0 004.57-11.2z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"})),ne=()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e("path",{d:"M208 352h-64a96 96 0 010-192h64M304 160h64a96 96 0 010 192h-64M163.29 256h187.42",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"})),re=()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},e("path",{d:"M430.11 347.9c-6.6-6.1-16.3-7.6-24.6-9-11.5-1.9-15.9-4-22.6-10-14.3-12.7-14.3-31.1 0-43.8l30.3-26.9c46.4-41 46.4-108.2 0-149.2-34.2-30.1-80.1-45-127.8-45-55.7 0-113.9 20.3-158.8 60.1-83.5 73.8-83.5 194.7 0 268.5 41.5 36.7 97.5 55 152.9 55.4h1.7c55.4 0 110-17.9 148.8-52.4 14.4-12.7 11.99-36.6.1-47.7z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"}),e("circle",{cx:"144",cy:"208",r:"32",fill:"currentColor"}),e("circle",{cx:"152",cy:"311",r:"32",fill:"currentColor"}),e("circle",{cx:"224",cy:"144",r:"32",fill:"currentColor"}),e("circle",{cx:"256",cy:"367",r:"48",fill:"currentColor"}),e("circle",{cx:"328",cy:"144",r:"32",fill:"currentColor"})),se=({align:t,list:i,switchToolbarActions:o,disabledTitle:n,bold:r,italic:s,strikethrough:l,underline:h,link:c,onExecCommand:d,toggleLink:u})=>{const f=()=>e("stylo-toolbar-separator",null);return e(a,null,e("stylo-toolbar-text",{disabledTitle:n,bold:"bold"===r,italic:"italic"===s,underline:"underline"===h,strikethrough:"strikethrough"===l,onExecCommand:t=>d(t)}),f(),(()=>{if(xt.state.toolbar.style.fontSize)return e(a,null,e("stylo-toolbar-button",{onAction:()=>o(Q.FONT_SIZE),label:Rt.state.toolbar.style_font_size},e("span",null,"A",e("small",null,"A"))),f())})(),(()=>{const t=[e("stylo-toolbar-button",{onAction:()=>o(Q.COLOR),label:Rt.state.toolbar.style_color},e(re,null))];return xt.state.toolbar.style.backgroundColor&&t.push(e("stylo-toolbar-button",{onAction:()=>o(Q.BACKGROUND_COLOR),label:Rt.state.toolbar.style_background},e(oe,null))),t})(),f(),(()=>{if(xt.state.toolbar.style.align)return e("stylo-toolbar-button",{onAction:()=>o(Q.ALIGNMENT),label:Rt.state.toolbar.style_align},e(t===q.LEFT?ie:t===q.CENTER?te:ee,null))})(),e("stylo-toolbar-button",{onAction:()=>o(Q.LIST),label:Rt.state.toolbar.style_list},e(i===G.UNORDERED?Ni:Di,null)),(()=>{if(i||t)return f()})(),e("stylo-toolbar-button",{onAction:u,cssClass:c?"active":void 0,label:Rt.state.toolbar.link},e(ne,null)))},ae=class{constructor(t){o(this,t),this.toolbarActivated=n(this,"toolbarActivated",7),this.linkCreated=n(this,"linkCreated",7),this.styleDidChange=n(this,"styleDidChange",7),this.bold=void 0,this.italic=void 0,this.underline=void 0,this.strikethrough=void 0,this.list=void 0,this.fontSize=void 0,this.disabledTitle=!1,this.toolsActivated=!1,this.displayToolsActivated=!1,this.debounceDisplayToolsActivated=ot((()=>{this.displayToolsActivated=!0,this.toolbarActivated.emit(!0)})),this.selection=null,this.selectionParagraph=void 0,this.anchorLink=null,this.link=!1,this.toolbarActions=Q.STYLE,this.rtl=at(),this.onKeyDown=t=>{const{code:i}=t;["Escape"].includes(i)?this.reset(!1):this.styleKeyboardShortcuts(t)},this.startSelection=t=>{this.anchorEvent={$event:t,composedPath:t.composedPath()}},this.toggleLink=()=>{this.link?((t=>{const{range:i,selection:e}=Ht(t);if(!i)return;if(st())return void(t=>{const i=m(t.anchorNode);i&&"a"===i.nodeName.toLowerCase()&&(i.parentElement.insertBefore(document.createTextNode(i.textContent),i),i.parentElement.removeChild(i))})(e);const o=m(e.anchorNode),n=i.extractContents();o.parentElement.replaceChild(n,o)})(this.containerRef),this.reset(!0)):this.openLink()},this.switchToolbarActions=t=>this.toolbarActions=t,this.onExecCommand=t=>{this.execCommand(t.detail)},this.onSelectionChange=this.onSelectionChange.bind(this)}componentWillLoad(){this.initDefaultContentAlign(),this.applyStandaloneConfig()}connectedCallback(){this.addListener()}disconnectedCallback(){this.removeListener()}onContainerRef(){this.containerRef&&(this.removeListener(),this.addListener())}onConfigChange(){this.applyStandaloneConfig()}applyStandaloneConfig(){this.config&&(xt.state.toolbar=Object.assign(Object.assign({},xt.state.toolbar),this.config))}styleKeyboardShortcuts(t){const{metaKey:i,ctrlKey:e,key:o}=t;if((i||e)&&["b","i","u","k"].includes(o))switch(t.preventDefault(),t.stopPropagation(),o){case"b":this.execCommand(Ui);break;case"i":this.execCommand($i);break;case"u":this.execCommand(Ki);break;case"k":this.openLink()}}onContextMenu(){this.reset(!1)}onSelectionChange(){[Q.COLOR,Q.BACKGROUND_COLOR,Q.LINK].includes(this.toolbarActions)||this.displayTools()}onResize(){Ot()||this.reset(!0)}onContainerClick(t){[Q.COLOR,Q.BACKGROUND_COLOR,Q.LINK].includes(this.toolbarActions)||t.preventDefault()}addListener(){const t=this.containerRef||document;null==t||t.addEventListener("mousedown",this.startSelection,{passive:!0}),null==t||t.addEventListener("touchstart",this.startSelection,{passive:!0}),null==t||t.addEventListener("keydown",this.onKeyDown)}removeListener(){const t=this.containerRef||document;null==t||t.removeEventListener("mousedown",this.startSelection),null==t||t.removeEventListener("touchstart",this.startSelection),null==t||t.removeEventListener("keydown",this.onKeyDown)}displayTools(){let t=Tt(this.containerRef);if(!this.anchorEvent)return void this.reset(!1);const{$event:i,composedPath:e}=this.anchorEvent;if(this.containerRef&&!this.containerRef.contains(i.target)&&!this.containerRef.contains(e[0]))return void this.reset(!1);if(!t||!t.toString()||t.toString().trim().length<=0)return void this.reset(!1);const o=this.activateToolbar(t);if(this.setToolsActivated(o),this.toolsActivated&&(this.selection=t,this.selectionParagraph=y({element:this.selection?this.selection.anchorNode:document.activeElement,container:this.containerRef}),t.rangeCount>0)){const i=t.getRangeAt(0);this.anchorLink={range:i.cloneRange()},this.setToolbarAnchorPosition()}}setToolbarAnchorPosition(){if(!this.tools)return;const{$event:t}=this.anchorEvent,i=et(t).clientX,e=et(t).clientY,{range:o}=Ht(this.containerRef),n=null==o?void 0:o.getBoundingClientRect(),r=n?n.x+n.width/2:i,s=n?n.y:e,{x:a,y:l}=this.el.shadowRoot.host.getBoundingClientRect(),h=r-a,c=s-l,d=e>100?"above":"under",{innerWidth:u}=window,f=this.tools.offsetWidth/2+32>h,p=u>0&&((null==n?void 0:n.left)||i)-40>u-(this.tools.offsetWidth/2+32);this.toolsPosition={top:"above"===d?c-16:c+((null==n?void 0:n.height)||0)+8,left:p?u-a-this.tools.offsetWidth-32+"px":f?"32px":`${h}px`,right:"auto",position:d,align:p?"end":f?"start":"center",anchorLeft:f?h-32:p?h-(u-32-this.tools.offsetWidth):this.tools.offsetWidth/2}}activateToolbar(t){const i=t&&t.toString()&&t.toString().length>0;return i&&(this.initStyle(t),this.initLink(t)),i}initStyle(t){if(!t||t.rangeCount<=0)return;const i=J(t);i&&this.initStyleForNode(i)}initStyleForNode(t){this.bold=void 0,this.italic=void 0,this.underline=void 0,this.strikethrough=void 0,this.list=void 0,this.fontSize=void 0,this.initDefaultContentAlign(),this.findStyle(t)}initDefaultContentAlign(){this.align=this.rtl?q.RIGHT:q.LEFT}findStyle(t){if(t&&!(t instanceof ShadowRoot)&&"HTML"!==t.nodeName.toUpperCase()&&"BODY"!==t.nodeName.toUpperCase()){var i;if(void 0===this.bold&&(this.bold=(i=m(t),Yi(i,"b")||Yi(i,"strong")||"bold"===i.style.fontWeight?"bold":"initial"===i.style.fontWeight?"initial":void 0)),void 0===this.italic&&(this.italic=(t=>{if(Yi(t,"i"))return"italic";if(Yi(t,"em"))return"italic";if("italic"===t.style.fontStyle)return"italic";if("initial"===t.style.fontStyle)return"initial";if(!t.hasChildNodes())return;const i=t.children;if(i&&i.length>0){const t=Array.from(i).find((t=>"italic"===t.style.fontStyle||"initial"===t.style.fontStyle));if(t)return"italic"===t.style.fontStyle?"italic":"initial"}})(m(t))),void 0===this.underline&&(this.underline=(t=>{var i,e,o,n,r;if(Yi(t,"u"))return"underline";if((null===(i=t.style.textDecoration)||void 0===i?void 0:i.indexOf("underline"))>-1||(null===(e=t.style.textDecorationLine)||void 0===e?void 0:e.indexOf("underline"))>-1)return"underline";if((null===(o=t.style.textDecoration)||void 0===o?void 0:o.indexOf("initial"))>-1||(null===(n=t.style.textDecorationLine)||void 0===n?void 0:n.indexOf("initial"))>-1)return"initial";if(!t.hasChildNodes())return;const s=t.children;if(s&&s.length>0){const t=Array.from(s).find((t=>{var i,e,o;return(null===(i=t.style.textDecoration)||void 0===i?void 0:i.indexOf("underline"))>-1||(null===(e=t.style.textDecorationLine)||void 0===e?void 0:e.indexOf("underline"))>-1||(null===(o=t.style.textDecorationLine)||void 0===o?void 0:o.indexOf("initial"))>-1}));if(t)return(null===(r=t.style.fontStyle)||void 0===r?void 0:r.indexOf("underline"))>-1?"underline":"initial"}})(m(t))),void 0===this.strikethrough&&(this.strikethrough=(t=>{var i,e,o,n,r;if(Yi(t,"strike"))return"strikethrough";if((null===(i=t.style.textDecoration)||void 0===i?void 0:i.indexOf("line-through"))>-1||(null===(e=t.style.textDecorationLine)||void 0===e?void 0:e.indexOf("line-through"))>-1)return"strikethrough";if((null===(o=t.style.textDecoration)||void 0===o?void 0:o.indexOf("initial"))>-1||(null===(n=t.style.textDecorationLine)||void 0===n?void 0:n.indexOf("initial"))>-1)return"initial";if(!t.hasChildNodes())return;const s=t.children;if(s&&s.length>0){const t=Array.from(s).find((t=>{var i,e,o;return(null===(i=t.style.textDecoration)||void 0===i?void 0:i.indexOf("line-through"))>-1||(null===(e=t.style.textDecorationLine)||void 0===e?void 0:e.indexOf("line-through"))>-1||(null===(o=t.style.textDecorationLine)||void 0===o?void 0:o.indexOf("initial"))>-1}));if(t)return(null===(r=t.style.fontStyle)||void 0===r?void 0:r.indexOf("line-through"))>-1?"strikethrough":"initial"}})(m(t))),void 0===this.list&&(this.list=(t=>{if(t)return t.nodeName&&"li"===t.nodeName.toLowerCase()&&t.parentElement&&t.parentElement.nodeName?"ol"===t.parentElement.nodeName.toLowerCase()?G.ORDERED:"ul"===t.parentElement.nodeName.toLowerCase()?G.UNORDERED:void 0:void 0})(m(t))),void 0===this.fontSize&&(this.fontSize=(t=>{if(t)return t.hasAttribute("size")?t.getAttribute("size"):""!==t.style.fontSize?X[t.style.fontSize.replace("-","_").toUpperCase()]:void 0})(m(t))),P({element:t,container:this.containerRef})){const i=t.nodeName.toUpperCase();return this.disabledTitle="H1"===i||"H2"===i||"H3"===i||"H4"===i||"H5"===i||"H6"===i,void(this.align=(t=>{const i=window.getComputedStyle(t);return"center"===i.textAlign?q.CENTER:"right"===i.textAlign?q.RIGHT:"left"===i.textAlign?q.LEFT:at()?q.RIGHT:q.LEFT})(m(t)))}this.findStyle(t.parentNode)}}initLink(t){if(!t)return;let i=t.anchorNode;i&&(3===i.nodeType&&(i=i.parentElement),this.link=i.nodeName&&"a"===i.nodeName.toLowerCase())}reset(t,i){t&&tt(),this.setToolsActivated(!1),t&&this.toolbarActivated.emit(!1),this.selection=null,this.selectionParagraph=null,this.toolbarActions=Q.STYLE,this.anchorLink=null,this.link=!1,i&&document.activeElement&&document.activeElement instanceof HTMLElement&&document.activeElement.blur()}openLink(){this.toolbarActions=Q.LINK}setToolsActivated(t){this.toolsActivated=t,t?this.debounceDisplayToolsActivated():this.displayToolsActivated=!1}execCommand(t){this.onAttributesChangesInitStyle(),"native"===xt.state.toolbar.command?(t=>{"style"===t.cmd?(t=>{const i=t.detail;switch(document.execCommand("styleWithCSS",!1,!0),i.style){case"color":document.execCommand("foreColor",!1,i.value);break;case"background-color":document.execCommand("backColor",!1,i.value);break;case"font-size":document.execCommand("fontSize",!1,X[i.value.replace("-","_").toUpperCase()]);break;case"font-weight":document.execCommand("bold",!1,null);break;case"font-style":document.execCommand("italic",!1,null);break;case"text-decoration":document.execCommand("line-through"===i.value?"strikeThrough":"underline",!1,null)}})(t):"list"===t.cmd&&(t=>{switch(t.detail.type){case"ol":document.execCommand("insertOrderedList",!1,null);break;case"ul":document.execCommand("insertUnorderedList",!1,null)}})(t)})(t):function(t,i,e){document&&t&&("style"===i.cmd?Xi(t,i.detail,e):"list"===i.cmd&&function(t,i,e){const o=t.anchorNode;if(!o)return;const n=m(y({element:o,container:e}));n&&(n.nodeName.toLowerCase()!==i.type?["ol","ul","dl"].includes(n.nodeName.toLowerCase())?(function(t,i,e){const o=document.createElement(e);o.append(...Array.from(t.childNodes)),Array.from(t.attributes).forEach((t=>o.setAttribute(t.nodeName,t.nodeValue))),t.parentElement.insertBefore(o,t),i.selectAllChildren(o)}(n,t,i.type),Fi(n,!1)):function(t,i,e){const o=i.getRangeAt(0),n=o.extractContents(),r=document.createElement(e),s=document.createElement("li");s.style.cssText=t.style.cssText,s.appendChild(n),r.appendChild(s),o.insertNode(r),i.selectAllChildren(r)}(n,t,i.type):Fi(n))}(t,i.detail,e))}(this.selection,t,this.containerRef);const{cmd:i}=t;("list"===i||rt())&&this.reset(!0),this.selectionParagraph&&this.styleDidChange.emit(m(this.selectionParagraph))}onAttributesChangesInitStyle(){const t=J(this.selection);if(!t)return;const i=new MutationObserver((()=>{i.disconnect(),this.initStyleForNode(t)}));i.observe(t,{attributes:!0})}render(){var t,i;const o=(null===(t=this.toolsPosition)||void 0===t?void 0:t.position)||"above";return e("div",{class:this.displayToolsActivated?"tools tools-activated":"tools",ref:t=>this.tools=t,style:this.toolsPosition?{"--actions-top":`${this.toolsPosition.top}px`,"--actions-left":this.toolsPosition.left,"--actions-right":this.toolsPosition.right,"--actions-translate-x":"center"===this.toolsPosition.align?"-50%":"0","--actions-translate-y":"above"===this.toolsPosition.position?"-100%":"0"}:void 0,onClick:t=>t.stopPropagation(),onMouseDown:t=>this.onContainerClick(t),onTouchStart:t=>this.onContainerClick(t)},e("stylo-toolbar-triangle",{class:"above"===o?"bottom":"top",style:{"--stylo-toolbar-triangle-start":`${null===(i=this.toolsPosition)||void 0===i?void 0:i.anchorLeft}px`}}),this.renderActions())}renderActions(){return this.toolbarActions===Q.LINK?e("stylo-toolbar-link",{containerRef:this.containerRef,toolbarActions:this.toolbarActions,anchorLink:this.anchorLink,linkCreated:this.linkCreated,onLinkModified:t=>this.reset(t.detail),onClose:()=>this.reset(!1)}):this.toolbarActions===Q.COLOR||this.toolbarActions===Q.BACKGROUND_COLOR?e("stylo-toolbar-color",{containerRef:this.containerRef,action:this.toolbarActions===Q.BACKGROUND_COLOR?"background-color":"color",onExecCommand:this.onExecCommand,onClose:()=>this.reset(!1)}):this.toolbarActions===Q.ALIGNMENT?e("stylo-toolbar-align",{containerRef:this.containerRef,anchorEvent:this.anchorEvent.$event,align:this.align,onAlignModified:()=>this.reset(!0)}):this.toolbarActions===Q.LIST?e("stylo-toolbar-list",{list:this.list,onExecCommand:this.onExecCommand}):this.toolbarActions===Q.FONT_SIZE?e("stylo-toolbar-font-size",{fontSize:this.fontSize,onExecCommand:this.onExecCommand}):e(se,{align:this.align,list:this.list,switchToolbarActions:this.switchToolbarActions,bold:this.bold,disabledTitle:this.disabledTitle,italic:this.italic,strikethrough:this.strikethrough,underline:this.underline,link:this.link,onExecCommand:this.onExecCommand,toggleLink:this.toggleLink})}get el(){return s(this)}static get watchers(){return{containerRef:["onContainerRef"],config:["onConfigChange"]}}};ae.style=":host{direction:ltr;position:absolute;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}div.tools{display:flex;justify-content:center;align-items:center;visibility:hidden;opacity:0;height:0;-webkit-animation:0s ease 0s 1 normal none running none;animation:0s ease 0s 1 normal none running none;transition:opacity 0.1s ease-out;position:absolute;top:var(--actions-top);left:var(--actions-left);right:var(--actions-right);transform:translate(var(--actions-translate-x), var(--actions-translate-y));z-index:var(--stylo-toolbar-zindex, 2);--box-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.12);box-shadow:var(--stylo-box-shadow, var(--box-shadow));border:var(--stylo-border);background:var(--stylo-background, var(--white));color:var(--stylo-color, var(--white-contrast));border-radius:var(--stylo-border, 4px);padding:var(--stylo-toolbar-padding, 0 8px);min-width:var(--stylo-toolbar-min-width, 280px)}div.tools.tools-activated{visibility:visible;opacity:1;height:unset;min-height:var(--stylo-toolbar-min-height, 44px)}";const le=class{constructor(t){o(this,t),this.alignModified=n(this,"alignModified",7)}justifyContent(t,i){t.stopPropagation(),"native"===xt.state.toolbar.command?(t=>{switch(t){case q.CENTER:document.execCommand("justifyCenter",!1,null);break;case q.RIGHT:document.execCommand("justifyRight",!1,null);break;default:document.execCommand("justifyLeft",!1,null)}})(i):((t,i,e)=>{const o=m(this.anchorEvent.target),n=m(y({element:o,container:i}));n&&(n.style.textAlign=(null==n?void 0:n.style.textAlign)===e?"":e)})(0,this.containerRef,i),this.alignModified.emit()}render(){return e(r,null,e("stylo-toolbar-button",{label:Rt.state.toolbar.align_left,onAction:t=>this.justifyContent(t.detail,q.LEFT),class:this.align===q.LEFT?"active":void 0},e(ie,null)),e("stylo-toolbar-button",{label:Rt.state.toolbar.align_center,onAction:t=>this.justifyContent(t.detail,q.CENTER),class:this.align===q.CENTER?"active":void 0},e(te,null)),e("stylo-toolbar-button",{label:Rt.state.toolbar.align_right,onAction:t=>this.justifyContent(t.detail,q.RIGHT),class:this.align===q.RIGHT?"active":void 0},e(ee,null)))}};le.style=":host{display:flex;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}stylo-toolbar-button.active{--stylo-toolbar-button-color:var(--stylo-toolbar-button-color-active, var(--highlight))}";const he=class{constructor(t){o(this,t),this.action=n(this,"action",7),this.disableAction=!1}render(){return e("button",{onMouseDown:t=>t.stopPropagation(),onTouchStart:t=>t.stopPropagation(),onClick:t=>{t.stopPropagation(),this.action.emit(t)},disabled:this.disableAction,class:this.cssClass,"aria-label":this.label},e("slot",null))}};he.style=".host{--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}button{pointer-events:initial;cursor:pointer;margin:0;padding:4px 6px 6px;height:40px;z-index:var(--stylo-toolbar-button-zindex, 2);display:flex;justify-content:center;align-items:center;border:0;color:var(--stylo-toolbar-button-color, black);transition:0.1s background-color, 0.1s border-color, 0.1s fill;background:transparent;font-size:var(--stylo-toolbar-button-font-size, 1.4rem);font-family:var(--stylo-toolbar-button-font-family, inherit);-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;outline:0}button.active{color:var(--stylo-toolbar-button-color-active, var(--highlight))}button[disabled]{color:var(--stylo-toolbar-button-color-disabled, var(--light));display:var(--stylo-toolbar-button-display-disabled, none)}button.active>div{background-color:var(--stylo-toolbar-button-color-active, var(--highlight))}button[disabled]>div{background-color:var(--stylo-toolbar-button-color-disabled, var(--light))}::slotted(*){pointer-events:none}::slotted(svg){width:20px;height:20px;padding-bottom:2px}";const ce=class{constructor(t){o(this,t),this.execCommand=n(this,"execCommand",7),this.close=n(this,"close",7),this.closeToolbar=()=>{this.close.emit()}}componentWillLoad(){this.initColor()}connectedCallback(){this.addListener()}disconnectedCallback(){this.removeListener()}addListener(){const t=this.containerRef||document;null==t||t.addEventListener("click",this.closeToolbar,{passive:!0})}removeListener(){const t=this.containerRef||document;null==t||t.removeEventListener("click",this.closeToolbar)}initColor(){const{range:t,selection:i}=Ht(this.containerRef);this.range=t;const e=J(i);if(!e)return;const o=Zi(e,"color"===this.action?"color":"background-color",this.containerRef);if(!o)return;const n=null===window||void 0===window?void 0:window.getComputedStyle(m(o));this.colorRgb=("color"===this.action?n.color:n.backgroundColor).replace("rgb(","").replace(")","")}selectColor(t){const i=Tt(this.containerRef);if(!i||!t||!t.detail)return;if(!this.action)return;null==i||i.removeAllRanges(),null==i||i.addRange(this.range);const e=new MutationObserver((()=>{e.disconnect(),this.range=null==i?void 0:i.getRangeAt(0)})),o=J(i);o&&(e.observe(o,{childList:!0}),this.execCommand.emit({cmd:"style",detail:{style:this.action,value:t.detail.hex,initial:i=>{const e=it(t.detail.hex);return i&&(i.style[this.action]===t.detail.hex||i.style[this.action]===`rgb(${e})`)}}}))}render(){return e("stylo-color",{"color-rgb":this.colorRgb,onColorChange:t=>this.selectColor(t),palette:xt.state.toolbar.palette})}};ce.style=":host{padding:4px 0}:host stylo-color{pointer-events:all}";const de=class{constructor(t){o(this,t),this.execCommand=n(this,"execCommand",7)}modifyFontSize(t,i){t.stopPropagation();const e=Object.keys(X).find((t=>X[t]===i));this.execCommand.emit({cmd:"style",detail:{style:"font-size",value:e.toLowerCase().replace("_","-"),initial:t=>t&&t.style["font-size"]===e.toLowerCase().replace("_","-")}}),this.fontSize=i}render(){return e(r,null,this.renderAction(X.X_SMALL),this.renderAction(X.SMALL),this.renderAction(X.MEDIUM),this.renderAction(X.LARGE),this.renderAction(X.X_LARGE),this.renderAction(X.XX_LARGE),this.renderAction(X.XXX_LARGE))}renderAction(t){return e("stylo-toolbar-button",{label:`${Rt.state.toolbar.font_size} ${t}`,onAction:i=>this.modifyFontSize(i.detail,t),class:this.fontSize===t?"active":void 0},e("span",null,t.toString()))}};de.style=":host{--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff;display:flex}stylo-toolbar-button.active{--stylo-toolbar-button-color:var(--stylo-toolbar-button-color-active, var(--highlight))}stylo-toolbar-button:first-of-type{--stylo-toolbar-button-font-size:0.8rem}stylo-toolbar-button:nth-of-type(2){--stylo-toolbar-button-font-size:1rem}stylo-toolbar-button:nth-of-type(3){--stylo-toolbar-button-font-size:1.2rem}stylo-toolbar-button:nth-of-type(5){--stylo-toolbar-button-font-size:1.6rem}stylo-toolbar-button:nth-of-type(6){--stylo-toolbar-button-font-size:1.8rem}stylo-toolbar-button:nth-of-type(7){--stylo-toolbar-button-font-size:2rem}";const ue=class{constructor(t){o(this,t),this.linkModified=n(this,"linkModified",7),this.close=n(this,"close",7),this.closeToolbar=()=>{this.close.emit()}}componentDidLoad(){setTimeout((()=>{var t;return null===(t=this.input)||void 0===t?void 0:t.focus()}),250)}connectedCallback(){this.addListener()}disconnectedCallback(){this.removeListener()}addListener(){const t=this.containerRef||document;null==t||t.addEventListener("click",this.closeToolbar,{passive:!0})}removeListener(){const t=this.containerRef||document;null==t||t.removeEventListener("click",this.closeToolbar)}handleLinkInput(t){this.linkUrl=t.target.value}createLink(){if(!this.anchorLink)return;const{range:t}=this.anchorLink;if(!t)return;if(!this.linkUrl||this.linkUrl.length<=0)return;(({range:t,linkUrl:i})=>{const e=(({fragment:t,linkUrl:i})=>{const e=Ai({linkUrl:i});return e.appendChild(t),e})({fragment:t.extractContents(),linkUrl:i});t.insertNode(e)})({range:t,linkUrl:this.linkUrl});const i=y({element:t.commonAncestorContainer,container:this.containerRef});i&&this.linkCreated.emit(m(i))}handleLinkEnter(t){t&&(this.toolbarActions!==Q.STYLE||"backspace"!==t.key.toLowerCase()&&"delete"!==t.key.toLowerCase()?this.toolbarActions===Q.LINK&&"enter"===t.key.toLowerCase()&&(this.createLink(),this.linkModified.emit(!0)):this.linkModified.emit(!1))}render(){return e(r,null,e("input",{ref:t=>this.input=t,placeholder:"Add a link...",onInput:t=>this.handleLinkInput(t),onKeyUp:t=>this.handleLinkEnter(t)}))}};ue.style=":host{width:100%;height:100%;z-index:var(--stylo-toolbar-link-zindex, 2)}:host input{pointer-events:visible;background:transparent;width:97%;height:100%;color:var(--stylo-toolbar-link-color, black);border:none;outline:0;font-size:16px}:host input::-moz-placeholder{color:var(--stylo-toolbar-link-placeholder-color, black)}:host input::placeholder{color:var(--stylo-toolbar-link-placeholder-color, black)}";const fe=class{constructor(t){o(this,t),this.execCommand=n(this,"execCommand",7)}toggleList(t,i){t.stopPropagation(),this.execCommand.emit({cmd:"list",detail:{type:i}})}render(){return e(r,null,e("stylo-toolbar-button",{label:Rt.state.toolbar.list_ol,onAction:t=>this.toggleList(t.detail,"ol"),class:this.list===G.ORDERED?"active":void 0},e(Di,null)),e("stylo-toolbar-button",{label:Rt.state.toolbar.list_ul,onAction:t=>this.toggleList(t.detail,"ul"),class:this.list===G.UNORDERED?"active":void 0},e(Ni,null)))}};fe.style=":host{display:flex;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}stylo-toolbar-button.active{--stylo-toolbar-button-color:var(--stylo-toolbar-button-color-active, var(--highlight))}";const pe=class{constructor(t){o(this,t)}render(){return e("div",{class:"separator"})}};pe.style=":host{--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}div.separator{display:inline-block;vertical-align:middle;width:1px;min-width:1px;margin:0 6px;height:24px;background:var(--stylo-toolbar-separator-background, var(--light))}";const ve=class{constructor(t){o(this,t),this.execCommand=n(this,"execCommand",7),this.disabledTitle=!1}styleBold(t){t.stopPropagation(),this.execCommand.emit(Ui)}styleItalic(t){t.stopPropagation(),this.execCommand.emit($i)}styleUnderline(t){t.stopPropagation(),this.execCommand.emit(Ki)}styleStrikeThrough(t){t.stopPropagation(),this.execCommand.emit(Vi)}render(){return e(r,null,e("stylo-toolbar-button",{label:Rt.state.toolbar.bold,onAction:t=>this.styleBold(t.detail),disableAction:this.disabledTitle,cssClass:this.bold?"active":void 0,class:"bold"},e("span",null,"B")),e("stylo-toolbar-button",{label:Rt.state.toolbar.italic,onAction:t=>this.styleItalic(t.detail),cssClass:this.italic?"active":void 0,class:"italic"},e("span",null,"I")),e("stylo-toolbar-button",{label:Rt.state.toolbar.underline,onAction:t=>this.styleUnderline(t.detail),cssClass:this.underline?"active":void 0,class:this.underline?"active underline":"underline"},e("span",null,"U")),e("stylo-toolbar-button",{label:Rt.state.toolbar.strikethrough,onAction:t=>this.styleStrikeThrough(t.detail),cssClass:this.strikethrough?"active":void 0,class:"strikethrough"},e("span",{style:{"text-decoration":"line-through"}},"S")))}};ve.style=":host{display:inline-flex;--light:#f4f5f8;--light-contrast:#000000;--medium:#6e6d6f;--medium-contrast:#000000;--black:#000000;--black-contrast:#ffffff;--white:#ffffff;--white-contrast:#000000;--highlight:#3880ff;--highlight-rgb:56, 128, 255;--highlight-contrast:#ffffff}stylo-toolbar-button{margin:0 2px}stylo-toolbar-button.italic span{font-style:italic}stylo-toolbar-button.underline.active span{border-bottom:1px solid var(--stylo-toolbar-button-color-active, var(--highlight))}stylo-toolbar-button.underline span{border-bottom:1px solid var(--stylo-toolbar-button-color, black)}";const ge=class{constructor(t){o(this,t)}render(){if(!this.mobile)return e("div",{class:"triangle"})}};ge.style=':host(.top) div.triangle{bottom:unset;top:-34px;transform:scale(0.7) translate(50%, 0)}div.triangle{z-index:1;position:absolute;bottom:-34px;left:var(--stylo-toolbar-triangle-start);width:40px;height:40px;overflow:hidden;transform:scale(0.7) rotate(180deg) translate(50%, 0)}div.triangle:after{content:"";position:absolute;width:24px;height:24px;background:white;transform:rotate(45deg);top:28px;left:8px;--box-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.12);box-shadow:var(--stylo-box-shadow, var(--box-shadow));border:var(--stylo-border)}';export{jt as stylo_add,Et as stylo_color,Bt as stylo_color_input,_i as stylo_editor,Ei as stylo_list,Bi as stylo_menus,Wi as stylo_plugins,ae as stylo_toolbar,le as stylo_toolbar_align,he as stylo_toolbar_button,ce as stylo_toolbar_color,de as stylo_toolbar_font_size,ue as stylo_toolbar_link,fe as stylo_toolbar_list,pe as stylo_toolbar_separator,ve as stylo_toolbar_text,ge as stylo_toolbar_triangle}