export const html = function html(strings, ...values) {
  const template = document.createElement('template');
  template.innerHTML = strings.raw[0];
  return template;
};
export const css = function html(strings, ...values) {
  const cssStyleSheet = new CSSStyleSheet(); //@ts-ignore

  cssStyleSheet.replaceSync(strings.raw[0]);
  return cssStyleSheet;
};
export class BaseCustomWebComponent extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({
      mode: 'open'
    }); //@ts-ignore

    if (this.constructor.template) {
      //@ts-ignore
      this._rootDocumentFragment = this.constructor.template.content.cloneNode(true);
    } //@ts-ignore


    if (this.constructor.style) {
      //@ts-ignore
      this.shadowRoot.adoptedStyleSheets = [this.constructor.style];
    }

    queueMicrotask(() => {
      if (this._rootDocumentFragment) this.shadowRoot.appendChild(this._rootDocumentFragment); //@ts-ignore

      if (this.ready) //@ts-ignore
        this.ready();
    });
  }

  _getDomElement(id) {
    if (this.shadowRoot.children.length > 0) return this.shadowRoot.getElementById(id);
    return this._rootDocumentFragment.getElementById(id);
  }

  _getDomElements(selector) {
    if (this.shadowRoot.children.length > 0) return this.shadowRoot.querySelectorAll(selector);
    return this._rootDocumentFragment.querySelectorAll(selector);
  }

  _parseAttributesToProperties() {
    //@ts-ignore
    if (!this.constructor._propertiesDictionary) {
      //@ts-ignore
      this.constructor._propertiesDictionary = new Map(); //@ts-ignore

      for (let i in this.constructor.properties) {
        //@ts-ignore
        this.constructor._propertiesDictionary.set(i.replace(/([A-Z])/g, g => `-${g[0].toLowerCase()}`), [i, this.constructor.properties[i]]);
      }
    }

    for (const a of this.attributes) {
      //@ts-ignore
      let pair = this.constructor._propertiesDictionary.get(a.name);

      if (pair) {
        if (pair[1] === Boolean) this[pair[0]] = true;else this[pair[0]] = a.value;
      }
    }
  }

}